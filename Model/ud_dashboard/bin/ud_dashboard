#!/usr/bin/env python

import sys
sys.path.insert(0, "/vagrant/scratch/Ud_dashboard/lib/python")
import re
from user_dataset_dashboard.dashboard import Dashboard
from user_dataset_dashboard.dataset import Dataset
from user_dataset_dashboard.workspace import Workspace
import argparse


def main():

    dashboard = Dashboard()

    parser = argparse.ArgumentParser(description='User Dataset Dignostics')
    subparsers = parser.add_subparsers(help='diagnostic subcommand')

    parser_dataset_report = subparsers.add_parser('dataset_report', help='report on a user dataset identified by its id')
    parser_dataset_report.add_argument('dataset_id', type=str, help='irods id for irods user dataset collection')
    parser_dataset_report.set_defaults(func=dashboard.dataset_report)

    parser_user_report = subparsers.add_parser('user_report', help='report on a user identified by his/her email address')
    parser_user_report.add_argument('user_email', type=str, help='email address user uses to log into wdk')
    parser_user_report.set_defaults(func=dashboard.user_report)

    parser_all_datasets_report = subparsers.add_parser('all_datasets_report', help='report on all user dataset collections in the irods workspace')
    parser_all_datasets_report.set_defaults(func=dashboard.all_datasets_report)

    args = parser.parse_args()
    args.func(args)


if __name__ == "__main__":
    sys.exit(main())