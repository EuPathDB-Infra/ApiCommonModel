<wdkModel>

  <paramSet name="stepAnalysisParams">

    <stringParam name="answerIdSql" number="false" isSql="true" visible="false" />
    
    <flatVocabParam name="organism"
                    queryRef="stepAnalysisParamQueries.organismsInAnswer"
                    prompt="Organism"
                    quote="false"
                    multiPick="false"
		    dependedParamRef="stepAnalysisParams.answerIdSql">
      <help>Choose an organism to run the enrichment analysis on.   To see all organisms, select 'All results' filter above.</help>
    </flatVocabParam>

    <flatVocabParam name="goAssociationsOntologies"
                    queryRef="stepAnalysisParamQueries.ontologiesInAnswer"
                    prompt="Ontology"
                    quote="false"
                    displayType="checkBox"
                    multiPick="false"
		    dependedParamRef="stepAnalysisParams.answerIdSql" >
      <help>
	Choose the Ontology that you are interested in analyzing. Only terms from this ontology will be considered during the enrichment analysis.
The ontologies are three structured, controlled vocabularies that describe gene products in terms of their related biological processes, cellular components and molecular functions. For statistical reasons, only one ontology may be analyzed at once. If you are interested in more than one, run separate GO enrichment analyses.
      </help>

    </flatVocabParam>


    <enumParam name="goEvidenceCodes"
               prompt="Evidence" quote="false" displayType="checkBox" multiPick="true" >
      <help>
	A GO Evidence Code of IEA is assigned to a computationally assigned association.All others have some degree of curation
      </help>
      <enumList>   
        <enumValue default="true">
          <term>Computed</term>
          <internal>Computed</internal>
        </enumValue>
        <enumValue default="true">
          <term>Curated</term>
          <internal>Curated</internal>
        </enumValue>
      </enumList>   
    </enumParam>

    <enumParam name="pathwaysSources"
               prompt="Pathway Sources" quote="false" displayType="checkBox" multiPick="true" >
      <enumList>   
        <enumValue default="true">
          <term>KEGG</term>
          <internal>KEGG</internal>
        </enumValue>
        <enumValue default="true">
          <term>MetaCyc</term>
          <internal>MetaCyc</internal>
        </enumValue>
      </enumList>   
    </enumParam>

    <enumParam name="goSubset"
               prompt="Limit to GO Slim terms" quote="false" displayType="checkBox" >
      <help>
	Choose Yes to limit enrichment analysis based on terms that are in the GO Slim generic subset. This will limit both the background and the gene list of interest.
      </help>
      <enumList>   
        <enumValue default="true">
          <term>No</term>
          <internal>No</internal>
        </enumValue>
        <enumValue>
          <term>Yes</term>
          <internal>Yes</internal>
        </enumValue>
      </enumList>   
    </enumParam>

    <numberParam name="pValueCutoff"
		 prompt="P-Value cutoff"
		 min="0" max="1.0" default="0.05" >
    </numberParam>

    <enumParam name="brcParam" prompt="Database">
      <help>
        Choose which database to search
      </help>
      <enumList>
        <enumValue>
          <term>eupathSearchServerName</term>
          <internal>eupathSearchServerName</internal>
        </enumValue>
        <enumValue>
          <term>eupathSearchPortalName</term>
          <internal>eupathSearchPortalName</internal>
        </enumValue>
      </enumList>
    </enumParam>

    <enumParam name="thresholdTypeParam" prompt="(Fold Change) Cutoff Type">
      <help>
        Fold_change cutoff for creating gene sets"
      </help>
      <enumList>
        <enumValue default="true">
          <term>Fold Change</term>
          <internal>fc</internal>
        </enumValue>
      </enumList>
    </enumParam>

    <numberParam
      name="thresholdParam"
		  prompt="Fold Change (Cutoff) Value"
		  min="0"
      max="1000"
      default="1.5"
    >
      <help>
        This number is used as a cutoff when finding studies from a gene list
      </help>
    </numberParam>

    <enumParam name="useOrthologyParam" prompt="Use orthology?">
      <help>
        Should we extend the search to consider genes orthologous to ones in the input list?
      </help>
      <enumList>
        <enumValue default="true">
          <term>Yes</term>
          <internal>true</internal>
        </enumValue>
        <enumValue>
          <term>No</term>
          <internal>false</internal>
        </enumValue>
      </enumList>
    </enumParam>

  </paramSet>

  <querySet name="stepAnalysisParamQueries" queryType="vocab" isCacheable="false">
    <sqlQuery name="organismsInAnswer" doNotTest="1">
      <paramRef ref="stepAnalysisParams.answerIdSql"/>
      <column name="term" />
      <column name="display" />
      <column name="internal"/>
      <sql>
        <![CDATA[

select organism as term, organism as display, organism as internal
from (SELECT distinct ga.organism
FROM ApidbTuning.GeneAttributes ga,
($$answerIdSql$$) r
where ga.source_id = r.gene_source_id
order by ga.organism asc) q
        ]]>
      </sql>
    </sqlQuery>
    
    <sqlQuery name="ontologiesInAnswer" doNotTest="1" isCacheable="false">
      <paramRef ref="stepAnalysisParams.answerIdSql"/>
      <column name="term" />
      <column name="display" />
      <column name="internal"/>
      <sql>
        <![CDATA[
		 select ontology as term, ontology as display, ontology as internal
		 from (
		  select distinct gts.ontology
		 from apidbtuning.GoTermSummary gts,
		 ($$answerIdSql$$) r
		 where gts.gene_source_id = r.gene_source_id and 
		 gts.ontology is not null
		 ) q
        ]]>
      </sql>
    </sqlQuery>
    
  </querySet>
</wdkModel>
