<wdkModel>

  <querySet name="SnpsBy" queryType="id" isCacheable="false" includeProjects="PlasmoDB,ToxoDB,EuPathDB,CryptoDB,AmoebaDB,TriTrypDB,FungiDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- NGS SNP ID -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
      <sqlQuery name="NgsSnpBySourceId" doNotTest="true" includeProjects="PlasmoDB,ToxoDB,CryptoDB,AmoebaDB,PiroplasmaDB,GiardiaDB,TriTrypDB,FungiDB"  isCacheable="true">
          <paramRef ref="snpParams.ngs_snp_id"/>
	  <column name="source_id"/>
	  <column name="project_id"/>
        <sql>
	    <![CDATA[
	      SELECT distinct s.source_id AS source_id, '@PROJECT_ID@' as project_id
	      FROM apidb.snp s, ($$ngs_snp_id$$) ds
	      WHERE s.source_id = ds.source_id
	    ]]>
        </sql>
      </sqlQuery>

     <processQuery name="NgsSnpBySourceId" includeProjects="EuPathDB" 
              doNotTest="true" 
              processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
          <paramRef ref="snpParams.ngs_snp_id" noTranslation="true" />
          <paramRef ref="sharedParams.wdk_user_signature" noTranslation="true"/>
	  <wsColumn name="source_id" width="50" wsName="source_id"/>
          <wsColumn name="project_id" width="32" wsName="project_id"/>
      </processQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- NGS SNP by Isolate Group -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <processQuery name="NgsSnpsByIsolateGroup" includeProjects="PlasmoDB,ToxoDB,PiroplasmaDB,GiardiaDB,TriTrypDB,CryptoDB,AmoebaDB,EuPathDB,FungiDB"  
             processName="org.apidb.apicomplexa.wsfplugin.highspeedsnpsearch.FindPolymorphismsPlugin">

      <!-- need to have quote=true so that dependent param query works.  the wsf plugin remove the for its use -->
      <paramRef ref="organismParams.organism" prompt="Organism" displayType="listBox" multiPick="false" quote="true" queryRef="organismVQ.withNgsSNPs" groupRef="snpParamGroupSet.org_isolates" >
        <help>Select the organism you wish to search.  Note: this is the genome to which the isolate resequencing reads were aligned.</help>
        <!-- visibleHelp>The organism you choose will determine the genome to which the SNPs have been mapped.  That will also restrict the set of isolates you may choose as SNPs are identified by aligning the reads from those isolates to this genome.</visibleHelp -->
      </paramRef>
      <paramRef ref="sharedParams.ngsSnp_strain_meta" quote="false" groupRef="snpParamGroupSet.org_isolates" />
      <paramRef ref="snpParams.WebServicesPath"/>
      <paramRef ref="snpParams.ReadFrequencyPercent" groupRef="snpParamGroupSet.read_freq" />
      <paramRef ref="snpParams.MinPercentMinorAlleles" groupRef="snpParamGroupSet.between_isolates"/>
      <paramRef ref="snpParams.MinPercentIsolateCalls" groupRef="snpParamGroupSet.between_isolates"/>
      <wsColumn name="source_id" width="60" wsName="SourceId"/>
      <wsColumn name="project_id" width="20" wsName="ProjectId"/>
      <wsColumn name="PercentMinorAlleles" width="8" columnType="float"/> <!-- need width 8 for oracle to give us xx.x precision in the display -->
      <wsColumn name="PercentIsolateCalls" width="8" columnType="float"/>
      <wsColumn name="Phenotype" width="15"/>
    </processQuery>

    <processQuery name="NgsSnpsByLocation" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB"  
             processName="org.apidb.apicomplexa.wsfplugin.highspeedsnpsearch.FindPolymorphismsWithSeqFilterPlugin">

      <!-- need to have quote=true so that dependent param query works.  the wsf plugin remove the for its use -->
      <paramRef ref="organismParams.organism" prompt="Organism" displayType="listBox" multiPick="false" quote="true" queryRef="organismVQ.withNgsSNPs">
        <help>Select the organism you wish to search.  Note: this is the genome to which the isolate resequencing reads were aligned.</help>
      </paramRef>
      <paramRef ref="sharedParams.chromosomeOptionalForNgsSnps" multiPick="false"/>
      <paramRef ref="sharedParams.sequenceId"/>
      <paramRef ref="sharedParams.start_point"/>
      <paramRef ref="sharedParams.end_point"/>
      <paramRef ref="sharedParams.ngsSnp_strain_meta" quote="false" />
      <paramRef ref="snpParams.WebServicesPath"/>
      <paramRef ref="snpParams.ReadFrequencyPercent"  groupRef="snpParamGroupSet.read_freq"/>
      <paramRef ref="snpParams.MinPercentMinorAlleles" groupRef="snpParamGroupSet.between_isolates"/>
      <paramRef ref="snpParams.MinPercentIsolateCalls" groupRef="snpParamGroupSet.between_isolates"/>
      <wsColumn name="source_id" width="60" wsName="SourceId"/>
      <wsColumn name="project_id" width="20" wsName="ProjectId"/>
      <wsColumn name="PercentMinorAlleles" width="8" columnType="float"/>
      <wsColumn name="PercentIsolateCalls" width="8" columnType="float"/>
      <wsColumn name="Phenotype" width="15"/>
    </processQuery>

    <processQuery name="NgsSnpsByGeneIds" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB"  
             processName="org.apidb.apicomplexa.wsfplugin.highspeedsnpsearch.FindSnpsByGeneIdsPlugin">

      <!-- need to have quote=true so that dependent param query works.  the wsf plugin remove the for its use -->
      <paramRef ref="organismParams.organism" prompt="Organism" displayType="listBox" multiPick="false" quote="true" queryRef="organismVQ.withNgsSNPs">
        <help>Select the organism you wish to search.  Note: this is the genome to which the isolate resequencing reads were aligned.</help>
      </paramRef>
      <paramRef ref="sharedParams.ds_gene_ids" default="EHI_012330" includeProjects="AmoebaDB"/>
      <paramRef ref="sharedParams.ds_gene_ids" default="TGME49_039250, TGGT1_075470" includeProjects="ToxoDB"/>
      <paramRef ref="sharedParams.ds_gene_ids" default="TcCLB.403869.10" includeProjects="TriTrypDB"/>
      <paramRef ref="sharedParams.ds_gene_ids" default="PF3D7_1133400" includeProjects="PlasmoDB"/>
      <paramRef ref="sharedParams.ds_gene_ids" default="cgd3_510" includeProjects="CryptoDB"/>
      <paramRef ref="sharedParams.ds_gene_ids" default="Afu2g00910" includeProjects="FungiDB"/>
      <paramRef ref="sharedParams.ngsSnp_strain_meta" quote="false" />
      <paramRef ref="snpParams.WebServicesPath"/>
      <paramRef ref="snpParams.ReadFrequencyPercent" />
      <paramRef ref="snpParams.MinPercentMinorAlleles"/>
      <paramRef ref="snpParams.MinPercentIsolateCalls"/>
      <wsColumn name="source_id" width="60" wsName="SourceId"/>
      <wsColumn name="project_id" width="20" wsName="ProjectId"/>
      <wsColumn name="PercentMinorAlleles" width="8" columnType="float"/>
      <wsColumn name="PercentIsolateCalls" width="8" columnType="float"/>
      <wsColumn name="Phenotype" width="15"/>
    </processQuery>

    <processQuery name="NgsSnpsByTwoIsolateGroups" includeProjects="PlasmoDB,ToxoDB,PiroplasmaDB,GiardiaDB,TriTrypDB,CryptoDB,AmoebaDB,FungiDB" 
             processName="org.apidb.apicomplexa.wsfplugin.highspeedsnpsearch.FindMajorAllelesPlugin">

      <!-- need to have quote=true so that dependent param query works.  the wsf plugin removes them for its use -->
      <paramRef ref="organismParams.organism" prompt="Organism" displayType="listBox" multiPick="false" quote="true" queryRef="organismVQ.withNgsSNPs">
        <help>Select the organism you wish to search.  Note: this is the genome to which the isolate resequencing reads were aligned.</help>
      </paramRef>
      <paramRef ref="sharedParams.ngsSnp_strain_meta_a" prompt="Set A Isolates" quote="false" />
      <paramRef ref="snpParams.WebServicesPath"/>
      <paramRef ref="snpParams.ReadFrequencyPercent"  prompt="Set A read frequency threshold &gt;= "/>
      <paramRef ref="snpParams.MinPercentMajorAlleles" prompt="Set A major allele frequency &gt;= "/>
      <paramRef ref="snpParams.MinPercentIsolateCalls" prompt="Set A percent isolates with base call &gt;= "/>
      <paramRef ref="sharedParams.ngsSnp_strain_meta_m" prompt="Set B Isolates" quote="false" />
      <paramRef ref="snpParams.ReadFrequencyPercentTwo"  prompt="Set B read frequency threshold &gt;= "/>
      <paramRef ref="snpParams.MinPercentMajorAllelesTwo" prompt="Set B major allele frequency &gt;= "/>
      <paramRef ref="snpParams.MinPercentIsolateCallsTwo" prompt="Set B percent isolates with base call &gt;= "/>
      <wsColumn name="source_id" width="60" wsName="SourceId"/>
      <wsColumn name="project_id" width="20" wsName="ProjectId"/>
      <wsColumn name="MajorAlleleA" width="3"/>
      <wsColumn name="MajorAllelePctA" width="8" columnType="float"/>
      <wsColumn name="IsTriallelicA" width="3"/>
      <wsColumn name="MajorProductA" width="3"/>
      <wsColumn name="MajorProductIsVariableA" width="3"/>
      <wsColumn name="MajorAlleleB" width="3"/>
      <wsColumn name="MajorAllelePctB" width="8" columnType="float"/>
      <wsColumn name="IsTriallelicB" width="3"/>
      <wsColumn name="MajorProductB" width="3"/>
      <wsColumn name="MajorProductIsVariableB" width="3"/>
    </processQuery>




    <!-- ===================================================================== -->
    <!-- ===================================================================== -->
    <!-- ====== QUERIES BELOW HERE MIGHT NEED RETIRING.  PLEASE REVIEW ======= -->
    <!-- ===================================================================== -->
    <!-- ===================================================================== -->


    <sqlQuery name="ByWeightFilter" isCacheable="true" doNotTest="true">
        <paramRef ref="snpParams.snp_result"/>
        <paramRef ref="sharedParams.min_weight" default="0"/>
        <paramRef ref="sharedParams.max_weight" default="100"/>
        <column name="project_id"/>
        <column name="source_id"/>
        <column name="wdk_weight" />
        <sql>
            <![CDATA[
            SELECT a.source_id, a.project_id, a.wdk_weight
            FROM $$snp_result$$ a
            WHERE a.wdk_weight >= $$min_weight$$
              AND a.wdk_weight <= $$max_weight$$
            ]]>
       </sql>
    </sqlQuery>




  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
  <!-- Dont Care - fake query for internal use -->
  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="DontCare" doNotTest="true" isCacheable="true">
        <column name="project_id"/>
        <column name="source_id"/>
        <sql>
            select source_id, project_id
            from ApidbTuning.snpattributes
            where source_id = 'life_is_sweet' 
        </sql>
    </sqlQuery>
    
  </querySet>

</wdkModel>
