<wdkModel>

  <querySet name="RflpIsolateIds" queryType="id" isCacheable="false" includeProjects="ToxoDB,EuPathDB">

   
    <!-- ************************************************************ -->
    <!-- Isolate ID -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="ByIsolateId" doNotTest="true" excludeProjects="EuPathDB"
              displayName="ID" isCacheable="true">
        <paramRef ref="rflpIsolateParams.isolate_id"/>
        <column name="name"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT sa.name
            FROM ApidbTuning.SampleAttributes sa, ApidbTuning.RflpGenotypes rg,
                 ($$isolate_id$$) ds
            WHERE lower(sa.name) LIKE REGEXP_REPLACE(REPLACE(LOWER(ds.name),
                                                       '*', '%'), '[[:space:]]', '')
              AND sa.protocol_app_node_id = rg.protocol_app_node_id
          ]]>
        </sql>

    </sqlQuery>

    <processQuery name="ByIsolateId" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB" doNotTest="true">
      <paramRef ref="rflpIsolateParams.isolate_id" noTranslation="true"/>
       <paramRef ref="sharedParams.wdk_user_signature"  noTranslation="true"/>    
       <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- by Genotype Number -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="ByGenotypeNumber" excludeProjects="EuPathDB" isCacheable="true">
        <paramRef ref="rflpIsolateParams.genotype" quote="true"/>
        <column name="name"/>
        <sql >
          <![CDATA[
            SELECT sa.name
            FROM ApidbTuning.SampleAttributes sa, ApidbTuning.SampleDownstream sd
            WHERE sa.protocol_app_node_id = sd.protocol_app_node_id
              AND sd.output_protocol_app_node_id
                  IN (
                      SELECT protocol_app_node_id
                      FROM apidb.RflpGenotypeNumber
                      WHERE genotype_number in ($$genotype$$)
         )
          ]]>
         </sql>
    </sqlQuery>

    <processQuery name="ByGenotypeNumber" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="rflpIsolateParams.genotype"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
      <wsColumn name="gene_type" width="100"/>
      <wsColumn name="genotype_num" width="100"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- by RFLP Genotype -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="ByRFLPGenotype" excludeProjects="EuPathDB" isCacheable="true">
        <paramRef ref="rflpIsolateParams.rflp_protein_SAG1" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_53_SAG2" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_alt_SAG2" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_SAG3" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_CS3" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_BTUB" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_GRA6" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_c22-8" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_c29-2" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_L358" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_PK1" quote="true"/>
        <paramRef ref="rflpIsolateParams.rflp_protein_Apico" quote="true"/>
        <column name="name"/>
        <sql >
          <![CDATA[
   SELECT sa.name
   FROM ApidbTuning.SampleAttributes sa, ApidbTuning.SampleDownstream sd
    WHERE sa.protocol_app_node_id = sd.protocol_app_node_id
      AND sd.output_protocol_app_node_id
        IN (
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'SAG1'
              AND (genotype = $$rflp_protein_SAG1$$ OR $$rflp_protein_SAG1$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = '5''+3'' SAG2'
              AND (genotype = $$rflp_protein_53_SAG2$$ OR $$rflp_protein_53_SAG2$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'alt. SAG2'
              AND (genotype = $$rflp_protein_alt_SAG2$$ OR $$rflp_protein_alt_SAG2$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'SAG3'
              AND (genotype = $$rflp_protein_SAG3$$ OR $$rflp_protein_SAG3$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'BTUB'
              AND (genotype = $$rflp_protein_BTUB$$ OR $$rflp_protein_BTUB$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'GRA6'
              AND (genotype = $$rflp_protein_GRA6$$ OR $$rflp_protein_GRA6$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'c22-8'
              AND (genotype = $$rflp_protein_c22-8$$ OR $$rflp_protein_c22-8$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'c29-2'
              AND (genotype = $$rflp_protein_c29-2$$ OR $$rflp_protein_c29-2$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'L358'
              AND (genotype = $$rflp_protein_L358$$ OR $$rflp_protein_L358$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'PK1'
              AND (genotype = $$rflp_protein_PK1$$ OR $$rflp_protein_PK1$$ = 'all')
            INTERSECT
              SELECT protocol_app_node_id
              FROM apidb.RflpGenotype
              WHERE locus_tag = 'Apico'
              AND (genotype = $$rflp_protein_Apico$$ OR $$rflp_protein_Apico$$ = 'all')
            INTERSECT
              ( -- not all datasets have this locus tag
                SELECT protocol_app_node_id
                FROM apidb.RflpGenotype
                WHERE locus_tag = 'CS3'
                AND (genotype = $$rflp_protein_CS3$$ OR $$rflp_protein_CS3$$ = 'all')
              UNION
                (
                   SELECT protocol_app_node_id
                   FROM apidb.RflpGenotype
                 MINUS
                   SELECT protocol_app_node_id
                   FROM apidb.RflpGenotype
                   WHERE locus_tag = 'CS3'
                )
              )
           )
   ORDER BY sa.name
          ]]>
         </sql>
    </sqlQuery>

    <processQuery name="ByRFLPGenotype" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="rflpIsolateParams.rflp_protein_SAG1"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_53_SAG2"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_alt_SAG2"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_SAG3"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_BTUB"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_GRA6"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_c22-8"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_c29-2"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_L358"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_PK1"/>
      <paramRef ref="rflpIsolateParams.rflp_protein_Apico"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
      <wsColumn name="data_type"  width="32"/>
      <wsColumn name="gene_type" width="100"/>
    </processQuery>

  </querySet>

</wdkModel>
