<wdkModel>
  <querySet name="CompoundIds" queryType="id"
	    includeProjects="PlasmoDB,EuPathDB">

    <!-- ************************************************************ -->
    <!-- Compound Id -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="CompoundsByCompoundID" doNotTest="true"  excludeProjects="EuPathDB"
              displayName="ID" isCacheable="true">
        <paramRef ref="compoundParams.pubchem_compound_id"/>
        <column name="project_id"/>
        <column name="source_id"/>
        <sql>
            <![CDATA[
	      SELECT source_id, '@PROJECT_ID@' as project_id
              FROM ApidbTuning.CompoundAttributes
	      WHERE compound_id LIKE REGEXP_REPLACE(REPLACE( $$pubchem_compound_id$$, '*', '%'), '[[:space:]]', '')

               ]]>
        </sql>
    </sqlQuery>

    <processQuery name="CompoundsByCompoundID" includeProjects="EuPathDB"
          isCacheable='true' doNotTest="true"
          processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin"> 
        <paramRef ref="compoundParams.pubchem_compound_id" noTranslation="true"/>
        <wsColumn name="source_id" width="50" wsName="source_id"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>   



    <!-- ************************************************************ -->
    <!-- Compound By Gene ID -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="CompoundsByPathwayReaction" doNotTest="true"  excludeProjects="EuPathDB"
              displayName="ID by gene" isCacheable="true">

      <!--paramRef ref="estParams.single_gene_id"/ -->
      <paramRef ref="compoundParams.enzymeOrReaction" />
      <paramRef ref="compoundParams.compound_type" noTranslation="true"/>
      <column name="project_id"/>
      <column name="source_id"/>
      <column name="compound"/>
      <column name="ec_number"/>
      <column name="reaction"/>
      <sql>
	<![CDATA[
       SELECT DISTINCT pc.compound_source_id as source_id, compound, 
                apidb.tab_to_string(set(CAST(COLLECT(pc.enzyme) AS apidb.varchartab)),', ') AS ec_number,
		apidb.tab_to_string(set(CAST(COLLECT(pc.reaction) AS apidb.varchartab)),', ') AS reaction,
		'@PROJECT_ID@' as project_id
         FROM apidbtuning.PathwayCompounds pc
        WHERE pc.compound_type = $$compound_type$$
	  AND (pc.reaction = $$enzymeOrReaction$$ OR pc.enzyme=$$enzymeOrReaction$$ )
	  GROUP BY pc.compound_source_id, compound
	]]>
        </sql>
    </sqlQuery>

    <processQuery name="CompoundsByPathwayReaction" includeProjects="EuPathDB"
		  isCacheable='true' doNotTest="true"
		  processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin"> 
      <paramRef ref="pathwayParams.metabolic_pathway_id" noTranslation="true"/>
      <wsColumn name="source_id" width="50" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
      <wsColumn name="compound" width="32"/>   
      <wsColumn name="enzyme" width="32"/>   
    </processQuery>   


    <sqlQuery name="CompoundsByPathway" doNotTest="true"  excludeProjects="EuPathDB"
              displayName="compounds by pathway" isCacheable="true">

      <paramRef ref="pathwayParams.metabolic_pathway_id"/>
      <column name="project_id"/>
      <column name="source_id"/>
      <column name="compound"/>
      <sql>
	<![CDATA[
            SELECT DISTINCT compound_source_id as source_id,
                   compound, '@PROJECT_ID@' as project_id
	    FROM apidbtuning.PathwayCompounds
            WHERE network_id in ($$metabolic_pathway_id$$)                                               
	    ]]>
        </sql>
    </sqlQuery>

    <processQuery name="CompoundsByPathway" includeProjects="EuPathDB"
		  isCacheable='true' doNotTest="true"
		  processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin"> 
      <paramRef ref="estParams.single_gene_id" noTranslation="true"/>
      <wsColumn name="source_id" width="50" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
      <wsColumn name="compound" width="32"/>   
    </processQuery>   


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Molecular Weight -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="CompoundsByMolecularWeight" excludeProjects="EuPathDB"
              isCacheable="true">
        <paramRef ref="compoundParams.min_molecular_weight"/>
        <paramRef ref="compoundParams.max_molecular_weight"/>
        <column name="project_id"/>
        <column name="source_id"/>
	<column name="molecular_wt"/>
        <sql>
            <![CDATA[
            SELECT source_id, mol_wt as molecular_wt, '@PROJECT_ID@' as project_id
	    FROM ApidbTuning.CompoundAttributes
	    WHERE mol_wt <= $$max_molecular_weight$$
                  AND mol_wt >= $$min_molecular_weight$$
           ]]>
       </sql>
    </sqlQuery>

    <processQuery name="CompoundsByMolecularWeight" includeProjects="EuPathDB"
		  isCacheable='true'
		  processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
      <paramRef ref="compoundParams.min_molecular_weight"/>
      <paramRef ref="compoundParams.max_molecular_weight"/>
      <wsColumn name="source_id" width="50" wsName="source_id"/>
      <wsColumn name="project_id" width="20" wsName="project_id"/>
      <wsColumn name="molecular_wt" width="32"/>   
    </processQuery>


   </querySet>

</wdkModel>
