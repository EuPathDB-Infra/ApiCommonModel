<wdkModel>

  <!-- notes

  -->

  <querySet name="DataSourceIds" queryType="id" includeProjects="PlasmoDB,InitDB,PiroplasmaDB,CryptoDB,MicrosporidiaDB,FungiDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="AllDataSources"
         isCacheable="true">
        <column name="data_source_name"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, p.name as project_id
            FROM   ApiDB.DataSource ds, apidbtuning.datasourceattribution dsi, core.projectinfo p
            WHERE ds.row_project_id = p.project_id
              and p.name = '@PROJECT_ID@'
              AND dsi.data_source_id = ds.data_source_id
              AND dsi.display_category != 'ignore'
          ]]>
       </sql>
    </sqlQuery>

    <sqlQuery name="ByReferenceName"
         isCacheable="true">
        <testParamValues>
          <paramValue name="reference_name">SNPs</paramValue>
        </testParamValues>
        <paramRef ref="dataSourceParams.reference_name"/>

        <column name="data_source_name"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, p.name as project_id
            FROM   ApiDB.DataSource ds, apidbtuning.datasourceattribution dsi,
                    core.projectinfo p, ApiDBTuning.DataSourceWdkReference dsw
            WHERE ds.row_project_id = p.project_id
              and p.name = '@PROJECT_ID@'
              AND dsi.data_source_id = ds.data_source_id
              AND ds.data_source_id = dsw.data_source_id
              AND dsi.display_category != 'ignore'
              AND dsw.target_name = $$reference_name$$
          ]]>
       </sql>
    </sqlQuery>

    
    <sqlQuery name="ByDatasetNames"
         isCacheable="true">
        <testParamValues>
          <paramValue name="data_source_name">pfal3D7_microarrayExpression_Derisi_3D7_TimeSeries_RSRC</paramValue>
        </testParamValues>
        <paramRef ref="dataSourceParams.data_source_name"/>

        <column name="data_source_name"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, p.name as project_id
            FROM   ApiDB.DataSource ds, core.projectinfo p
            WHERE ds.row_project_id = p.project_id
              and p.name = '@PROJECT_ID@'
              AND ds.name IN ($$data_source_name$$)
          ]]>
       </sql>
    </sqlQuery>


    <sqlQuery name="ByQuestionName"
         isCacheable="true">
        <testParamValues>
          <paramValue name="question_name">GeneQuestions.GenesByTextSearch</paramValue>
        </testParamValues>

        <paramRef ref="dataSourceParams.question_name"/>
        <column name="data_source_name"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
           SELECT DISTINCT ds.name as data_source_name, p.name as project_id
            FROM   ApiDB.DataSource ds, apidbtuning.DataSourceAttribution dsi, 
                   ApiDBtuning.DataSourceWdkReference dsr, Core.ProjectInfo p
            WHERE dsr.target_type = 'question'
              AND dsr.target_name = $$question_name$$
              AND dsr.data_source_id = ds.data_source_id
              AND ds.data_source_id = dsi.data_source_id
              AND p.name = '@PROJECT_ID@'
              and p.project_id = ds.row_project_id
              AND dsi.display_category != 'ignore'
          ]]>
       </sql>
    </sqlQuery>

    <sqlQuery name="ByRecordClass"
         isCacheable="true">
        <testParamValues>
          <paramValue name="record_class">GeneRecordClasses.GeneRecordClass</paramValue>
        </testParamValues>

        <paramRef ref="dataSourceParams.record_class"/>
        <column name="data_source_name"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
          SELECT DISTINCT ds.name as data_source_name, p.name as project_id
            FROM   ApiDB.DataSource ds, apidbtuning.DataSourceattribution dsi, 
                   ApiDBtuning.DataSourceWdkReference dsr, COre.projectinfo p                                                              
            WHERE dsr.target_type IN ('table', 'attribute','profile_graph')
              AND dsr.record_type = $$record_class$$
              AND ds.data_source_id = dsr.data_source_id
              AND ds.data_source_id = dsi.data_source_id
              AND p.name = '@PROJECT_ID@'
              and p.project_id = ds.row_project_id
              AND dsi.display_category != 'ignore'
          ]]>
       </sql>
    </sqlQuery>


  </querySet>
</wdkModel>
