<wdkModel>

  <questionSet name="SnpQuestions" displayName="Search for SNPs" includeProjects="PlasmoDB,ToxoDB,CryptoDB,EuPathDB,AmoebaDB,TriTrypDB,FungiDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- NGS SNP by SNP ID -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
     <question name="NgsSnpBySourceId" includeProjects="PlasmoDB,ToxoDB,CryptoDB,AmoebaDB,PiroplasmaDB,GiardiaDB,TriTrypDB,FungiDB"
               displayName="SNP ID(s)"
               shortDisplayName="SNP ID(s)"
               queryRef="SnpsBy.NgsSnpBySourceId"
	             recordClassRef="SnpRecordClasses.SnpRecordClass"
               noSummaryOnSingleRecord="true">

        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein"
        />  

          <summary>
            Find SNPs by ID.
          </summary>
	 
	   <description>
	        <![CDATA[ 
              Find SNPs by SNP ID. Either enter the ID list manually, or upload a file that contains the list. 
             IDs can be delimited by a comma, a semi colon, or any white spaces. 
						 <br>
             <!-- See the Data Sets link below for experimental details.-->
            ]]> 
	  </description>

      </question>


      <question name="NgsSnpBySourceId" includeProjects="EuPathDB"
               displayName="ID"
               shortDisplayName="ID"
               queryRef="SnpsBy.NgsSnpBySourceId"
	       recordClassRef="SnpRecordClasses.SnpRecordClass"
               noSummaryOnSingleRecord="false">

        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein"
        />  

          <summary>
            Find SNPs by ID
          </summary>

 <description>
        Find SNPs by ID. Either enter the ID list manually, 
           or upload a file that contains the list. IDs can be delimited by a comma, 
           a semi colon, or any white spaces. Also, the list may contain SNP IDs from any of the EuPathDB organisms in PlasmoDB, CryptoDB and ToxoDB.  For example, a list can be in the
           following form: "chr3-2_66329, NGS_SNP.Pf3D7_11_v3.1293957, SNP_Ia_17864"
      </description>


      </question>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- One set of isolates  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <question name="NgsSnpsByIsolateGroup" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB" newBuild="21"
              searchCategory="Strain"
              displayName="Differences Within a Group of Isolates"
              shortDisplayName="One Group"
              queryRef="SnpsBy.NgsSnpsByIsolateGroup"
              recordClassRef="SnpRecordClasses.SnpRecordClass">
        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein, PercentMinorAlleles, PercentIsolateCalls, Phenotype"
        />
        <summary>
            <![CDATA[
            Find SNPs that differ within a group of isolates allowing restriction by minor allele frequency. 
          ]]>
        </summary>
<!-- 
        <description>
            <![CDATA[
            This search analyzes a group of isolates to find SNPs relative to the group.  
            Choose a group of isolates by specifying meta data that describes isolates 
            you are interested in.  A SNP is returned for this group of isolates if it 
            has a minor allele frequency that is greater or equal to the percent you 
            specify.  The minor allele frequency is computed as the percent of 
            <i>qualifying</i> alleles that are not the major allele. 
            <p>
            An allele for an isolate at a SNP location is qualifying if that allele has 
            an above-threshold number of supporting reads at the SNP location.  The read 
            frequency parameter controls this.  For example, if an isolate has 10 reads 
            at a location, 6 A's and 4 C's, the allele will be called as an A and will 
            qualify if you specify a read frequency of 60% or less.</p>
            
            <p>A SNP is only considered if it has an above-threshold percent of alleles 
            called.  For example, if you choose 20 isolates and a 'Min percent of isolates 
            with calls' of 75%, then the SNP will be ignored if there are less than 15 
            isolates that have a qualifying allele.</p>
          ]]>
        </description>
 -->
        <description>
            <![CDATA[
            This search analyzes whole genome sequencing data from a group of isolates to find SNPs
            associated with the group.

            
            <b>Isolates:</b> choosing the isolate group<br>
            Isolate sequences are accompanied by information about the sequencing data set - metadata 
            such as the clinical phenotype of the host or the location collected. By default, the isolate group 
            includes all isolates from the Organism you chose. You have the option to limit the 
            group of isolates based on metadata characteristics. 
            For example, you can find SNPs for isolates collected from a certain geographic location. 
            To do this, click a metadata category on the left and choose your desired 
            metadata characteristic on the right. Multiple metadata categories and characteristics 
            can be chosen when defining your group. Not all isolate data sets have the same 
            metadata. A running total of your selections is displayed above the 
            metadata filter.</p>
          
            
            <p>
            <b>Read Frequency Threshold:</b> should we make a base call at this nucleotide position?<br>
            Each isolate's sequencing reads are aligned to a reference genome and then each nucleotide position 
            is examined. For nucleotide positions with 5 or more aligned reads, a base call is made if the aligned 
            reads meet your Read Frequency Threshold. For example, Isolate X has 10 aligned reads at 
            nucleotide position 1600. If 7 reads are G and 3 reads are A, the read frequency is 70%. Running this
            search with the Read Frequency Threshold set to 80% will prevent a base call and subsequently 
            exclude this Isolate X when determining SNPs at nucleotide position 1600. The parameter lets you 
            control the stringency of the sequencing data and is particularly important when dealing with 
            diploid (or aneuploid) organisms since a read frequency of ~50% is expected for heterozygous SNPs. 
            
            
            </p>
            <img src="images/ReadFreq.jpg"  height="263px" width="500px" alt="Read Frequency Threshold">
            <p>
            
            <b>Percent isolates with a base call:</b> determining SNPs within the Isolate Group<br>
            The consensus isolate sequences are aligned and the unlike-reference base calls are tallied 
            for the locations with a qualifying Read frequency (see above).  A SNP is called and returned by the 
            search for locations where the percent isolates with base call exceeds the threshold.</p>
            
            <img src="images/PIBC_MinorAllFreq.jpg"  height="263px" width="500px" alt="Percent Isolates with Base Call">
            
                           ]]>
        </description>     
        <dynamicAttributes>
	     <columnAttribute name="PercentMinorAlleles" displayName="% Minor Alleles" align="center" sortable="false" help="Percent of minor alleles for this group of isolates at this SNP location (where 'minor allele' means any allele that is not the major allele)."/>
	     <columnAttribute name="PercentIsolateCalls" displayName="% Calls" align="center" sortable="false" help="Percent of the isolates at this SNP location from the specified group that have read calls (over the threshold specified in the search)"/>
	     <columnAttribute name="Phenotype"  align="center" sortable="false" help="1 = this SNP is within a gene and there is at least one sample in this set that has an allele with product that is non-synonomous with the most popular allele"/>
	</dynamicAttributes>
 
    </question>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- By Genomic Location -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <question name="NgsSnpsByLocation" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB" newBuild="21"
              searchCategory="Strain"
              displayName="Genomic Location"
              shortDisplayName="Location"
              queryRef="SnpsBy.NgsSnpsByLocation"
              recordClassRef="SnpRecordClasses.SnpRecordClass">
        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein, PercentMinorAlleles, PercentIsolateCalls, Phenotype"
        />
        <summary>
            <![CDATA[
            Find SNPs that differ within a group of isolates allowing restriction by minor allele frequency and genomic location. 
          ]]>
        </summary>

        <description>
            <![CDATA[
            This search analyzes a group of isolates to find SNPs relative to the group, and returns SNPs found at a specified genomic location.  Choose a group of isolates by specifying meta data that describes isolates you are interested in.  A SNP is returned for this group of isolates if it has a minor allele frequency that is greater or equal to the percent you specify.  The minor allele frequency is computed as the percent of <i>qualifying</i> alleles that are not the major allele. 
<p>
An allele for an isolate at a SNP location is qualifying if that allele has an above-threshold number of supporting reads at the SNP location.  The read frequency parameter controls this.  For example, if an isolate has 10 reads at a location, 6 A's and 4 C's, the allele will be called as an A and will qualify if you specify a read frequency of 60% or less.</p>
<p>A SNP is only considered if it has an above-threshold percent of alleles called.  For example, if you choose 20 isolates and a 'Min percent of isolates with calls' of 75%, then the SNP will be ignored if there are less than 15 isolates that have a qualifying allele.</p>
          ]]>
        </description>

        <dynamicAttributes>
	     <columnAttribute name="PercentMinorAlleles" displayName="% Minor Alleles" align="center" sortable="false" help="Percent of minor alleles for this group of isolates at this SNP location (where 'minor allele' means any allele that is not the major allele)."/>
	     <columnAttribute name="PercentIsolateCalls" displayName="% Calls" align="center" sortable="false" help="Percent of the isolates at this SNP location from the specified group that have read calls (over the threshold specified in the search)"/>
	     <columnAttribute name="Phenotype" align="center" sortable="false" help="1 = this SNP is within a gene and there is at least one sample in this set that has an allele with product that is non-synonomous with the most popular allele"/>
	</dynamicAttributes>
 
    </question>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- By Gene IDs                                    -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <question name="NgsSnpsByGeneIds" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB" newBuild="21"
              searchCategory="Strain"
              displayName="Gene IDs"
              shortDisplayName="Gene IDs"
              queryRef="SnpsBy.NgsSnpsByGeneIds"
              recordClassRef="SnpRecordClasses.SnpRecordClass">
        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein, PercentMinorAlleles, PercentIsolateCalls, Phenotype"
        />
        <summary>
            <![CDATA[
            Find SNPs that differ within a group of isolates allowing restriction by minor allele frequency that are contained within a set of genes. 
          ]]>
        </summary>

        <description>
            <![CDATA[
            This search analyzes a group of isolates to find SNPs relative to the group, and returns SNPs found within a provided set of genes.  Choose a group of isolates by specifying meta data that describes isolates you are interested in.  A SNP is returned for this group of isolates if it has a minor allele frequency that is greater or equal to the percent you specify.  The minor allele frequency is computed as the percent of <i>qualifying</i> alleles that are not the major allele. 
<p>
An allele for an isolate at a SNP location is qualifying if that allele has an above-threshold number of supporting reads at the SNP location.  The read frequency parameter controls this.  For example, if an isolate has 10 reads at a location, 6 A's and 4 C's, the allele will be called as an A and will qualify if you specify a read frequency of 60% or less.</p>
<p>A SNP is only considered if it has an above-threshold percent of alleles called.  For example, if you choose 20 isolates and a 'Min percent of isolates with calls' of 75%, then the SNP will be ignored if there are less than 15 isolates that have a qualifying allele.</p>
          ]]>
        </description>

        <dynamicAttributes>
	     <columnAttribute name="PercentMinorAlleles" displayName="% Minor Alleles" align="center" sortable="false" help="Percent of minor alleles for this group of isolates at this SNP location (where 'minor allele' means any allele that is not the major allele)."/>
	     <columnAttribute name="PercentIsolateCalls" displayName="% Calls" align="center" sortable="false" help="Percent of the isolates at this SNP location from the specified group that have read calls (over the threshold specified in the search)"/>
	     <columnAttribute name="Phenotype" align="center" sortable="false" help="1 = this SNP is within a gene and there is at least one sample in this set that has an allele with product that is non-synonomous with the most popular allele"/>
	</dynamicAttributes>
    </question>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Two sets of isolates  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <question name="NgsSnpsByTwoIsolateGroups" includeProjects="PlasmoDB,ToxoDB,TriTrypDB,CryptoDB,PiroplasmaDB,GiardiaDB,AmoebaDB,FungiDB" newBuild="21"
              searchCategory="Strain"
              displayName="Differences Between Two Groups of Isolates"
              shortDisplayName="Two Groups"
              queryRef="SnpsBy.NgsSnpsByTwoIsolateGroups"
              recordClassRef="SnpRecordClasses.SnpRecordClass">
        <attributesList
              summary="snp_location,linkedGeneId,position_in_protein, MajorAlleleA, MajorAllelePctA, IsTriallelicA, MajorProductA, MajorProductIsVariableA, MajorAlleleB, MajorAllelePctB, IsTriallelicB, MajorProductB, MajorProductIsVariableB"
        />
        <summary>
            <![CDATA[
      Identify SNPs that distinguish between two groups of isolates based on the user supplied major allele threshold for each group.
          ]]>
        </summary>

        <description>
            <![CDATA[
            This search analyzes a group of isolates to find SNPs relative to the group.  Choose a group of isolates by specifying meta data that describes isolates you are interested in.  A SNP is returned for this group of isolates if it has a minor allele frequency that is greater or equal to the percent you specify.  The minor allele frequency is computed as the percent of <i>qualifying</i> alleles that are not the major allele. 
<p>
An allele for an isolate at a SNP location is qualifying if that allele has an above-threshold number of supporting reads at the SNP location.  The read frequency parameter controls this.  For example, if an isolate has 10 reads at a location, 6 A's and 4 C's, the allele will be called as an A and will qualify if you specify a read frequency of 60% or less.</p>
<p>A SNP is only considered if it has an above-threshold percent of alleles called.  For example, if you choose 20 isolates and a 'Min percent of isolates with calls' of 75%, then the SNP will be ignored if there are less than 15 isolates that have a qualifying allele.</p>
          ]]>
        </description>

        <dynamicAttributes>
	     <columnAttribute name="MajorAlleleA" displayName="Set A Major Allele" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorAllelePctA" displayName="Set A Major Allele Pct" align="center" sortable="false" help=""/>
	     <columnAttribute name="IsTriallelicA" displayName="Set A Is Triallelic" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorProductA" displayName="Set A Major Product" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorProductIsVariableA" displayName="Set A Mjr Prod Is Variable" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorAlleleB" displayName="Set B Major Allele" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorAllelePctB" displayName="Set B Major Allele Pct" align="center" sortable="false" help=""/>
	     <columnAttribute name="IsTriallelicB" displayName="Set B Is Triallelic" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorProductB" displayName="Set B Major Product" align="center" sortable="false" help=""/>
	     <columnAttribute name="MajorProductIsVariableB" displayName="Set B Mjr Prod Is Variable" align="center" sortable="false" help=""/>
	</dynamicAttributes>
    </question>

  </questionSet>

</wdkModel>
