<wdkModel>

  
  <paramSet name="genomicSimilarityParams">

       <flatVocabParam name="motif_organism"
                      queryRef="SimilarityVQ.GenomicMotifFiles"
                      displayType="treeBox"
                      suppressNode="true"  
                      prompt="Organism"
                      multiPick="true">
      <noTranslation value="true" includeProjects="EuPathDB" />
      <noTranslation value="false" excludeProjects="EuPathDB" />

         <help>
             Choose one or more organisms to search with the given motif
         </help>
       </flatVocabParam>

  </paramSet>

  <paramSet name="orfSimilarityParams">

       <flatVocabParam name="motif_organism"
                      queryRef="SimilarityVQ.OrfMotifFiles"
                      displayType="treeBox"  
                      suppressNode="true"
                      prompt="Organism"
                      multiPick="true">
      <noTranslation value="true" includeProjects="EuPathDB" />
      <noTranslation value="false" excludeProjects="EuPathDB" />

         <help>
             Choose one or more organisms to search with the given motif
         </help>
       </flatVocabParam>


  </paramSet>
  

  <paramSet name="geneSimilarityParams">
  

       <flatVocabParam name="motif_organism"
                      queryRef="SimilarityVQ.AnnotatedProteinMotifFiles"
                      displayType="treeBox"
                      suppressNode="true" 
                      prompt="Organism"
                      multiPick="true">
      <noTranslation value="true" includeProjects="EuPathDB" />
      <noTranslation value="false" excludeProjects="EuPathDB" />

         <help>
             Choose one or more organisms to search with the given motif
         </help>
       </flatVocabParam>
     
  </paramSet>

  <querySet name="SimilarityVQ" queryType="vocab">


        <sqlQuery name="OrfMotifFiles">
            <column name="internal" />
            <column name="parentTerm"/>
            <column name="term" />
            <sql>
                <![CDATA[ 
                WITH orgs as (select distinct organism, project_id
                      from ApidbTuning.SequenceAttributes
  UNION
  -- GiardiaDB uses species for everything  
  select distinct species, project_id
  from ApidbTuning.GeneAttributes
  where project_id = 'GiardiaDB'
  UNION
    -- ToxoDB Apicoplast for GENES and GENOMES
  select 'Toxoplasma gondii apicoplast' as organism, 'ToxoDB' as project_id
  from dual
  UNION
  -- Mitochondrial GENES and GENOME
  select distinct organism || ' mitochondrial', project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0000819'
  UNION
  -- Plastid GENES and GENOME
  select distinct organism || ' plastid' as organism, project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0001259'
  UNION
   -- CryptoDB has ESTORFs
  select 'Cryptosporidium parvum EST' as organism,  'CryptoDB' as project_id from dual
  UNION 
  select 'Cryptosporidium muris EST' as organism,  'CryptoDB' as project_id from dual
  )   
     select distinct nvl(ot.term, files.term) as term,
       case when ot.organism is null then files.parentterm else ot.parentterm end as parentterm,
       case when (ot.organism is null or ( ot.organism is not null and ot.term = files.term)) 
            then sf.mirror || sf.path || files.abbreviation  || 'ORFs_@PROJECT_ID@'  || '.fasta' 
       else '-1'
       end as internal
from apidbtuning.organismtree ot,
    (select abbrev.organism as term,
            abbrev.parent as parentTerm,
            abbrev.abbreviation 
     from orgs, apidbtuning.organismabbreviationws abbrev
     where orgs.organism = abbrev.organism
      and (orgs.project_id = '@PROJECT_ID@' OR 'EuPathDB' = '@PROJECT_ID@')
     ) files,
     ( SELECT CASE WHEN '@SITE_FILE_MIRROR@' IS NULL OR '@SITE_FILE_MIRROR@' = '@' || 'SITE_FILE_MIRROR' || '@'
              THEN '/var/www/Common/apiSiteFilesMirror'
              ELSE '@SITE_FILE_MIRROR@' END AS mirror,
              '/webServices/@PROJECT_ID@/release-%%releaseVersion%%/motif/' AS path
       FROM dual 
      ) sf
where files.term = ot.organism (+)
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="GenomicMotifFiles">
            <column name="internal" />
            <column name="parentTerm" />
            <column name="term" />
            <sql>
                <![CDATA[ 
                with orgs as  (select distinct organism, project_id
                      from ApidbTuning.SequenceAttributes
  UNION
  -- GiardiaDB Scaffolds
  select 'Giardia Assemblage A isolate WB (scaffolds)' as organism, 'GiardiaDB' as project_id
  from dual
  UNION
  select distinct species, project_id
  from ApidbTuning.GeneAttributes
  where project_id = 'GiardiaDB'
  UNION
    -- ToxoDB Apicoplast for GENES and GENOMES
  select 'Toxoplasma gondii apicoplast' as organism, 'ToxoDB' as project_id
  from dual
  UNION
  -- Mitochondrial GENES and GENOME
  select distinct organism || ' mitochondrial', project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0000819'
  UNION
  -- Plastid GENES and GENOME
  select distinct organism || ' plastid' as organism, project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0001259'
                      )
     select distinct nvl(ot.term, files.term) as term,
       case when ot.organism is null 
            then files.parentterm else ot.parentterm end as parentterm,
       case when (ot.organism is null or ( ot.organism is not null and ot.term = files.term)) 
            then sf.mirror || sf.path || files.abbreviation  || 'Genomic_@PROJECT_ID@'  || '.fasta' 
       else '-1'
       end as internal
from apidbtuning.organismtree ot,
    (select abbrev.organism as term,
            abbrev.parent as parentTerm,
            abbrev.abbreviation 
     from orgs, apidbtuning.organismabbreviationws abbrev
     where orgs.organism = abbrev.organism
      and (orgs.project_id = '@PROJECT_ID@' OR 'EuPathDB' = '@PROJECT_ID@')
     ) files,
     ( SELECT CASE WHEN '@SITE_FILE_MIRROR@' IS NULL OR '@SITE_FILE_MIRROR@' = '@' || 'SITE_FILE_MIRROR' || '@'
              THEN '/var/www/Common/apiSiteFilesMirror'
              ELSE '@SITE_FILE_MIRROR@' END AS mirror,
              '/webServices/@PROJECT_ID@/release-%%releaseVersion%%/motif/' AS path
       FROM dual 
      ) sf
where files.term = ot.organism (+)
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="AnnotatedProteinMotifFiles">
            <column name="internal" />
            <column name="parentTerm" />
            <column name="term" />
            <sql>
                <![CDATA[ 
with orgs as (
  select distinct organism, project_id
  from ApidbTuning.GeneAttributes 
  where ( gene_type = 'protein coding' and organism not in ('Toxoplasma gondii RH') )
  UNION
  -- TrichDB Repeat Genes
  select distinct organism || ' (Repeated Genes)', project_id
  from ApidbTuning.GeneAttributes
  where project_id = 'TrichDB'
  UNION
  -- GiardiaDB uses species for everything  
  select distinct species, project_id
  from ApidbTuning.GeneAttributes
  where project_id = 'GiardiaDB'
  UNION
  -- GiardiaDB Deprecated Genes
  select 'Giardia Assemblage A isolate WB (deprecated)' as organism, 'GiardiaDB' as project_id
  from dual
  UNION
    -- ToxoDB Apicoplast for GENES and GENOMES
  select 'Toxoplasma gondii apicoplast' as organism, 'ToxoDB' as project_id
  from dual
  UNION  
  -- Mitochondrial GENES
  select distinct organism || ' mitochondrial', project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0000819'
  UNION
  -- Plastid GENES
  select distinct organism || ' plastid' as organism, project_id
  from ApidbTuning.SequenceAttributes
  where so_id = 'SO:0001259'
                      )
     select distinct nvl(ot.term, files.term) as term,
       case when ot.organism is null then files.parentterm else ot.parentterm end as parentterm,
       case when (ot.organism is null or ( ot.organism is not null and ot.term = files.term)) 
            then sf.mirror || sf.path || files.abbreviation  || 'AnnotatedProteins_@PROJECT_ID@'  || '.fasta' 
       else '-1'
       end as internal
from apidbtuning.organismtree ot,
    (select abbrev.organism as term,
            abbrev.parent as parentTerm,
            abbrev.abbreviation 
     from orgs, apidbtuning.organismabbreviationws abbrev
     where orgs.organism = abbrev.organism
      and (orgs.project_id = '@PROJECT_ID@' OR 'EuPathDB' = '@PROJECT_ID@')
     ) files,
     ( SELECT CASE WHEN '@SITE_FILE_MIRROR@' IS NULL OR '@SITE_FILE_MIRROR@' = '@' || 'SITE_FILE_MIRROR' || '@'
              THEN '/var/www/Common/apiSiteFilesMirror'
              ELSE '@SITE_FILE_MIRROR@' END AS mirror,
              '/webServices/@PROJECT_ID@/release-%%releaseVersion%%/motif/' AS path
       FROM dual 
      ) sf
where files.term = ot.organism (+)
                ]]>
            </sql>
        </sqlQuery>
       
       
 </querySet>


</wdkModel>

