<wdkModel>

  <!-- notes

     - should ms_assay param be a controlled vocab pulled from the database?

  -->

  <paramSet name="isolateParams" includeProjects="CryptoDB,GiardiaDB,MicrosporidiaDB,PiroplasmaDB,PlasmoDB,ToxoDB,EuPathDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- ID -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
        <datasetParam name="isolate_id" prompt="Isolate ID" 
                      recordClassRef="IsolateRecordClasses.IsolateRecordClass" >
            <help>Input a comma delimited set of  Isolate IDs, or upload a file. Wildcards (*) are allowed.</help>
            <suggest includeProjects="CryptoDB"
                     sample="AF527841, DQ1145002, DQ115*"
                     default="AF527841"/>
            <suggest includeProjects="GiardiaDB"
                     sample="EU815931, AF176672"
                     default="EU815931, AF176672"/>
            <suggest includeProjects="MicrosporidiaDB"
                     sample="AB472273,EU123526"
                     default="AB472273,EU123526"/>
            <suggest includeProjects="PiroplasmaDB"
                     sample="EU362993,EU711062"
                     default="EU362993,EU711062"/>
            <suggest includeProjects="PlasmoDB"
                     sample="FJ490884, AB430787"
                     default="FJ490884, AB430787"/>
            <suggest includeProjects="ToxoDB"
                     sample="EF639858,AF378312"
                     default="EF639858,AF378312"/>
           <suggest includeProjects="EuPathDB" 
                     sample="AF527841, DQ1145002, DQ115*"
                     default="AF527841"/>
         </datasetParam>

        <stringParam name="gene_id" prompt="Gene Name" number="false">
            <help>Enter an Gene Name.  Wildcards (*) are allowed.</help>
            <suggest includeProjects="CryptoDB,PlasmoDB,EuPathDB,ToxoDB"
                     sample="cgd5_3160, cgd5_31*, *"
                     default="cgd5_3160"/>
        </stringParam>

        <stringParam name="author" prompt="Author/Submitter" number="false">
            <help>Enter an Author name.  Wildcards (*) are allowed.</help> 
            <suggest sample="Xiao" default="Xiao"/> 
        </stringParam>

        <flatVocabParam name="specific_host"
             queryRef="hostVQ.withIsolates"
             default="Mammals - Human"
             prompt="Host"
             multiPick="true"
             quote="false"
             displayType="treeBox">
        </flatVocabParam>

        <flatVocabParam name="isolation_source"
             queryRef="isolationSourceVQ.withIsolates"
             prompt="Isolation Source"
             multiPick="true"
             quote="false">
        </flatVocabParam>

        <flatVocabParam name="product"
            queryRef="productVQ.withIsolates"
            prompt="Locus Sequence Name"
            quote="false"
            displayType="typeAhead">
        </flatVocabParam>

        <flatVocabParam name="genotype" includeProjects="ToxoDB,EuPathDB"
            queryRef="genotypeVQ.withIsolates"
            prompt="Genotype #"
            multiPick="true"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_SAG1" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.SAG1"
            prompt="Protein SAG1"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_53_SAG2" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III-nd"
            prompt="5'+3' SAG2"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_alt_SAG2" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III-nd"
            prompt="alt. SAG2"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_SAG3" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III"
            prompt="SAG3"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_BTUB" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III"
            prompt="BTUB"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_GRA6" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III"
            prompt="GRA6"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_c22-8" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.c22-8"
            prompt="c22-8"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_c29-2" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.c29-2"
            prompt="c29-2"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="rflp_protein_L358" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III"
            prompt="L358"
            multiPick="false"
            quote="false">
        </flatVocabParam> 

        <flatVocabParam name="rflp_protein_PK1" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.PK1"
            prompt="PK1"
            multiPick="false"
            quote="false">
        </flatVocabParam> 

        <flatVocabParam name="rflp_protein_Apico" includeProjects="ToxoDB,EuPathDB"
            queryRef="rflpGenotypeVQ.I-II-III-nd"
            prompt="Apico"
            multiPick="false"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="study" 
            queryRef="studyVQ.withIsolates"
            prompt="Study Name"
            multiPick="true"
            quote="false">
        </flatVocabParam>

        <flatVocabParam name="country" 
            queryRef="countryVQ.withIsolates"
            prompt="Geographic Locations"
            default="Unknown"
            multiPick="true"
            quote="false"
            displayType="treeBox">
            <suggest selectMode="all" />
        </flatVocabParam>

        <flatVocabParam name="continent" includeProjects="CryptoDB,PlasmoDB,EuPathDB"
            queryRef="continentVQ.withIsolates"
            prompt="Continent Name"
            default="--None--"
            multiPick="true"
            quote="false">
        </flatVocabParam> 

        <flatVocabParam name="strain" 
            queryRef="strainVQ.withIsolates"
            prompt="Species/Strain Name"
            multiPick="true"
            quote="false"
            displayType="treeBox">
                  <help>
                         Species Name (and strain if appropriate)
                        </help>
            <suggest selectMode="all" />
       </flatVocabParam>

       <flatVocabParam name="type" 
            queryRef="typeVQ.withIsolates"
            prompt="Isolate assay type"
            multiPick="true"
            quote="true"> 
        <help>
          Choose the isolate type you want to query
            </help>
        <suggest selectMode="all" />
       </flatVocabParam>

       <flatVocabParam name="snp_assay_type" includeProjects="PlasmoDB,EuPathDB"
            queryRef="typeVQ.snps_only"
            prompt="Isolate assay type"
            multiPick="true"
            quote="true"> 
        <help>
          Choose the isolate type you want to query
            </help>
       </flatVocabParam>


       <enumParam name="text_fields"
                  prompt="Fields"
                  multiPick="true">
        <noTranslation value="true" includeProjects="EuPathDB" />
	 <noTranslation value="false" excludeProjects="EuPathDB" />
         <help>
             Choose which text fields to search.
         </help>
         <suggest selectMode="all" />
         <enumList>
           <enumValue>
             <term>Organism</term>
             <internal>organism</internal>
           </enumValue>
           <enumValue>
             <term>Description</term>
             <internal>description</internal>
           </enumValue>
           <enumValue>
             <term>Strain</term>
             <internal>strain</internal>
           </enumValue>
           <enumValue>
             <term>Host</term>
             <internal>host</internal>
           </enumValue>
           <enumValue>
             <term>Note</term>
             <internal>note</internal>
           </enumValue>
           <enumValue>
             <term>Isolation Source</term>
             <internal>isolation_source</internal>
           </enumValue>
           <enumValue>
             <term>Geographic Location</term>
             <internal>geographic_location</internal>
           </enumValue>
           <enumValue>
             <term>Reference</term>
             <internal>Reference</internal>
           </enumValue>
           <enumValue>
             <term>Overlapping gene (ID or product)</term>
             <internal>GeneOverlap</internal>
           </enumValue>
         </enumList>
       </enumParam>

    <answerParam name="isolate_result"
                  prompt="Input Result Set"
                  readonly="true"
                  visible="false">
        <recordClass ref="IsolateRecordClasses.IsolateRecordClass" />
    </answerParam>

    </paramSet>


  <querySet name="hostVQ" queryType="vocab">
    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
    <column name="internal"/>
    <column name="term"/>
    <column name="parentTerm"/>
    <sql>
    <![CDATA[
 select distinct initcap(v.term) as term, initcap(v.term) as internal, initcap(v.parent) as parentTerm
 from   apidb.isolatevocabulary v, apidb.isolatemapping m
 where  v.type = 'specific_host'
 and   v.isolate_vocabulary_id = m.isolate_vocabulary_id
 union
 select distinct initcap(v.parent) as term, initcap(v.parent) as internal, ''  as parentterm 
 from   apidb.isolatevocabulary v, apidb.isolatemapping m
 where  v.type = 'specific_host' 
 and    v.isolate_vocabulary_id = m.isolate_vocabulary_id
 and v.parent is not null 
 union
 select 'Unknown' as term, 'Unknown' as internal, '' as parentTerm from dual
]]>
    </sql>
    </sqlQuery>

    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
      <wsColumn name="parentTerm" width="200" wsName="parentTerm"/>
    </processQuery>

    </querySet>

  <querySet name="isolationSourceVQ" queryType="vocab">
    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
    <column name="term"/>
    <column name="internal"/>
    <sql>
    <![CDATA[
select distinct initcap(v.term) as term, v.term as internal
from apidb.isolatevocabulary v, apidb.isolatemapping m 
where v.type = 'isolation_source'
and   v.isolate_vocabulary_id = m.isolate_vocabulary_id
order by v.term asc
    ]]>
    </sql>
    </sqlQuery>

    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </processQuery>

    </querySet>

  <querySet name="productVQ" queryType="vocab">
    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
    <column name="display"/>
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
     SELECT product AS display, replace(product, ',', '') as term, product as internal from (
        SELECT distinct ga.product 
          FROM apidbtuning.GeneIsolateOverlap gio, apidbtuning.GeneAttributes ga
         WHERE gio.gene_source_id = ga.source_id
           AND min_pvalue_exp<-5)
       ORDER BY product
    ]]>
    </sql>
    </sqlQuery>

    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
      <wsColumn name="parentTerm" width="200" wsName="parentTerm"/>
    </processQuery>

     </querySet>

  <querySet name="genotypeVQ" queryType="vocab">
    <sqlQuery name="withIsolates" includeProjects="ToxoDB">
    <column name="display"/>
    <column name="internal"/>
    <column name="term"/>
    <column name="parentTerm"/>
    <sql>
    <![CDATA[
select distinct 'Genotype #' || v.prediction_number as display, 
      v.prediction_number as term, v.prediction_number as internal, '' as parentTerm
from dots.isolatefeature v 
where name = 'RFLP'
order by v.prediction_number
    ]]>
    </sql>
    </sqlQuery>

    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
      <wsColumn name="parentTerm" width="200" wsName="parentTerm"/>
    </processQuery>

  </querySet>

  <querySet name="rflpGenotypeVQ" queryType="vocab">

    <sqlQuery name="I-II-III" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'BTUB'
    ]]>
    </sql>
    </sqlQuery>
		
    <sqlQuery name="I-II-III-nd" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'Apico'
    ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="c29-2" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'c29-2'
    ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="c22-8" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'c22-8'
    ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="PK1" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'PK1'
    ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="SAG1" includeProjects="ToxoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
select 'Don''t Care' as term, 'all' as internal
from dual 
union
select distinct v.gene_type as term, v.gene_type as internal
from dots.isolatefeature v 
where v.name = 'RFLP'
and v.product = 'SAG1'
    ]]>
    </sql>
    </sqlQuery>

    <processQuery name="I-II-III" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>

    <processQuery name="I-II-III-nd" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>

    <processQuery name="c29-2" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>
		
    <processQuery name="c22-8" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>

    <processQuery name="PK1" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>

    <processQuery name="SAG1" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </processQuery>


  </querySet> 

  <querySet name="studyVQ" queryType="vocab">
    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
    select distinct apidb.alphanumeric_str(r.title) as term,
                    r.title as internal
    from ApidbTuning.IsolateAttributes ia, dots.nasequenceref sr, sres.reference r
    where ia.na_sequence_id = sr.na_sequence_id
    and r.reference_id = sr.reference_id
    and r.title is not null
    ]]>
    </sql>
    </sqlQuery>

    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </processQuery>

  </querySet>

  <querySet name="countryVQ" queryType="vocab">

    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
      <column name="internal"/>
      <column name="term"/>
      <column name="parentTerm"/>

      <sql>
      <![CDATA[
 select distinct replace(initcap(v.term), '''', ' ') as term, initcap(v.term) as internal, initcap(v.parent) as parentTerm
 from   apidb.isolatevocabulary v, apidb.isolatemapping m
 where  v.type = 'geographic_location'
 and    v.isolate_vocabulary_id = m.isolate_vocabulary_id
 union
 select distinct replace(initcap(v.parent), '''', ' ') as term, initcap(v.parent) as internal, '' as parentterm 
 from   apidb.isolatevocabulary v, apidb.isolatemapping m
 where  v.type = 'geographic_location' 
 and    v.isolate_vocabulary_id = m.isolate_vocabulary_id
 and    parent is not null
 union
 select 'Unknown' as term, 'Unknown' as internal, '' as parentTerm from dual
      ]]>
      </sql>
    </sqlQuery>

 
    <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
      <wsColumn name="parentTerm" width="200" wsName="parentTerm"/>
    </processQuery>

  </querySet>

  <querySet name="continentVQ" queryType="vocab">

     <sqlQuery name="withIsolates" includeProjects="CryptoDB, PlasmoDB">
        <column name="internal"/>
        <column name="term"/>
        <sql>
        <![CDATA[
        SELECT distinct initcap(src.continent) AS term,
               src.continent AS internal
        FROM   ApiDB.Continents src
        WHERE  src.continent is not null
        UNION
        SELECT '--None--' AS term,
               '0' AS internal
        FROM   dual
        ]]> 
     </sql> 
  </sqlQuery>

  <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB"> 
      <wsColumn name="internal" width="200" wsName="internal"/> 
      <wsColumn name="term" width="200" wsName="term"/> 
  </processQuery> 
  </querySet>


  <querySet name="typeVQ" queryType="vocab">
    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
      <![CDATA[
      SELECT distinct src.data_type AS term,
             src.data_type AS internal
      FROM   ApidbTuning.IsolateAttributes src
      ORDER BY src.data_type
      ]]>
      </sql>
    </sqlQuery>

 <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </processQuery>

    <sqlQuery name="snps_only" includeProjects="PlasmoDB,EuPathDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
      <![CDATA[
      SELECT distinct src.data_type AS term,
             src.data_type AS internal
      FROM   ApidbTuning.IsolateAttributes src
      WHERE  src.data_type != 'Sequencing Typed'
      AND    src.data_type != 'RFLP Typed'
      ORDER BY src.data_type
      ]]>
      </sql>
    </sqlQuery>

  </querySet>

  <querySet name="strainVQ" queryType="vocab">

    <sqlQuery name="withIsolates" excludeProjects="EuPathDB">
      <column name="internal"/>
      <column name="term"/>
      <column name="parentTerm"/>


<sql>
      <![CDATA[
select term,internal,parentTerm from (
select distinct i.organism as term, 
tn.name as internal, regexp_replace(p.name, ' \(.+\)', '', 1, 1, 'n') as parentTerm,
i.project_id
from ApidbTuning.IsolateAttributes i, sres.taxonname tn, 
     sres.taxon t, sres.TaxonName p
where i.organism = tn.name
and tn.taxon_id = t.taxon_id
and tn.name_class = 'scientific name'
and t.parent_id = p.taxon_id
and p.name_class =  'scientific name'
union
select distinct ot.term, ot.term as internal, ot.parentTerm, ia.project_id 
from apidbtuning.organismtree ot, apidbtuning.isolateattributes ia
where ot.organism = ia.organism and ot.parentterm is not null
union
select 'environmental samples' as term, 'environmental samples' as internal, 'Cryptosporidium' as parentTerm, 'CryptoDB' as project_id from dual
union
select 'unclassified Cryptosporidium' as term, 'unclassified Cryptosporidium' as internal, 'Cryptosporidium' as parentTerm, 'CryptoDB' as project_id from dual
union
select 'Plasmodium - Not Annotated' as term, 'Unknown' as internal, 'Plasmodium' as parentTerm, 'PlasmoDB' as project_id from dual
union
select 'Cryptosporidium - Not Annotated' as term, 'Unknown' as internal, 'Cryptosporidium' as parentTerm, 'CryptoDB' as project_id from dual
union
select 'Cryptosporidium parvum Iowa II' as term, 'Cryptosporidium parvum Iowa II' as internal, 'Cryptosporidium parvum' as parentTerm, 'CryptoDB' as project_id from dual
union
select 'Toxoplasma' as term, 'Toxoplasma' as internal, 'Apicomplexa' as parentTerm, 'ToxoDB' as project_id from dual
) where project_id = '@PROJECT_ID@'
order by term
     ]]>
      </sql>

    </sqlQuery>


 <processQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
      <wsColumn name="parentTerm" width="200" wsName="parentTerm"/>
    </processQuery>

  </querySet>


</wdkModel>
