<wdkModel>

  <paramSet name="pathwayParams">

        <flatVocabParam name="pathways_source" 
                     queryRef="PathwayVQ.PathwaysSource"
                     prompt="Pathway Source"
                     quote="true">
            <help>Select a Pathway Source.</help>
            <suggest selectMode="none" />
        </flatVocabParam>

        <flatVocabParam name="metabolic_pathway_id" 
                     queryRef="PathwayVQ.MetbPathwaysList"
                     prompt="Pathway Name or ID"
                     quote="true"
                     displayType="typeAhead">
            <help>Enter a Pathway ID (e.g. "ec00061") or Pathway name (e.g. "Fatty acid biosynthesis").</help>
            <suggest selectMode="none" />
        </flatVocabParam>

        <flatVocabParam name="metabolic_pathway_id_with_compounds" 
                     excludeProjects="EuPathDB"
                     queryRef="PathwayVQ.MetbPathwaysWithCompoundsList"
                     prompt="Pathway Name or ID"
                     quote="true"
                     displayType="typeAhead">
            <help>Enter a Pathway ID (e.g. "ec00061") or Pathway name (e.g. "Fatty acid biosynthesis").</help>
            <suggest selectMode="none" />
        </flatVocabParam>

        <flatVocabParam name="metabolic_pathway_id_with_genes" 
                     queryRef="PathwayVQ.MetbPathwaysWithGenesList"
                     prompt="Pathway Name or ID"
                     quote="true"
                     displayType="typeAhead">
            <help>Enter a Pathway ID (e.g. "ec00061") or Pathway name (e.g. "Fatty acid biosynthesis").</help>
            <suggest selectMode="none" />
        </flatVocabParam>

        <stringParam name="pathway_wildcard"
		     prompt="Pathway wildcard search" number="false">
	  <suggest default="N/A"/>
	  <help>Asterisks can be used as wildcard characters in a Pathway (e.g. "ec001* or glyco*")</help>
        </stringParam>

        <stringParam name="single_identifier_id"
                     prompt="Identifier (pathway/compound/enzyme/reaction)"
                     number="false">
            <help><![CDATA[Enter any pathway or compound or enzyme or reaction ID (or its name). ]]></help>
            <regex>
                <![CDATA[
                   ^[^\\]*$
                ]]>
            </regex>
        </stringParam>


    <answerParam name="pathway_result"
                  excludeProjects="EuPathDB"
                  prompt="Input Result Set"
                  readonly="true"
                  visible="false">
        <recordClass ref="PathwayRecordClasses.PathwayRecordClass" />
    </answerParam>
  </paramSet>

    <querySet name="PathwayVQ" queryType="vocab" isCacheable="true">

        <sqlQuery name="PathwaysSource"  doNotTest="1" excludeProjects="EuPathDB">
            <column name="internal" />
            <column name="term" />
            <column name="display" />
            <sql>
	    SELECT distinct  replace(replace(ed.name, 'Pathways_',''), '_RSRC','') as display, 
	      replace(replace(ed.name, 'Pathways_',''), '_RSRC','') as term,
	      edr.external_database_release_id as internal
	    FROM sres.pathway p, sres.externalDatabase ed, sres.externalDatabaseRelease edr
	    WHERE p.external_database_release_id=edr.external_database_release_id
	    AND edr.external_database_id = ed.external_database_id
	    UNION
	    SELECT 'Any' AS display, 'Any' AS term, 1 AS internal
	    FROM dual
            </sql>
        </sqlQuery>

        <sqlQuery name="MetbPathwaysList"  doNotTest="1" excludeProjects="EuPathDB">
            <column name="internal" />
            <column name="term" />
            <column name="display" />
            <sql>
            SELECT name ||' ('|| source_id||')' as display,
                            name ||' ('|| source_id||')' as term,
                            pathway_id as internal
            FROM sres.pathway
            WHERE source_id NOT IN ('ec01100','ec01110','ec01120')
	    UNION
	    SELECT 'N/A' AS display, 'N/A' AS term, 0 AS internal
	    FROM dual
            </sql>
        </sqlQuery>

        <processQuery name="MetbPathwaysList" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB" doNotTest="1">
            <wsColumn name="internal" width="100" wsName="internal"/>
            <wsColumn name="term" width="200" wsName="term"/>
            <wsColumn name="display" width="100" wsName="display"/>
        </processQuery>


        <sqlQuery name="MetbPathwaysWithCompoundsList"  doNotTest="1" excludeProjects="EuPathDB">
            <column name="internal" />
            <column name="term" />
            <column name="display" />
            <sql>
            SELECT name ||' ('|| source_id ||')' as display,
                            name ||' ('|| source_id ||')' as term,
                            pathway_id as internal
            FROM sres.pathway
	    UNION
	    SELECT 'N/A' AS display, 'N/A' AS term, 0 AS internal
	    FROM dual
            </sql>
        </sqlQuery>

        <processQuery name="MetbPathwaysWithCompoundsList" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB" doNotTest="1">
            <wsColumn name="internal" width="100" wsName="internal"/>
            <wsColumn name="term" width="200" wsName="term"/>
            <wsColumn name="display" width="100" wsName="display"/>
        </processQuery>


        <sqlQuery name="MetbPathwaysWithGenesList"  doNotTest="1" excludeProjects="EuPathDB">
            <column name="internal" />
            <column name="term" />
            <column name="display" />
            <sql>
            SELECT DISTINCT p.name ||' ('|| p.source_id||')' AS display,
                            p.NAME ||' ('|| p.source_id||')'  AS term,
                            p.pathway_id as internal
            FROM  sres.enzymeClass ec, dots.aaSequenceEnzymeClass asec, ApidbTuning.TranscriptAttributes ga, 
               ApidbTuning.pathwayCompounds pc, sres.pathway p
            WHERE ga.aa_sequence_id = asec.aa_sequence_id
            AND asec.enzyme_class_id = ec.enzyme_class_id
            AND pc.enzyme = ec.ec_number
            AND p.pathway_id = pc.pathway_id
	    UNION
	    SELECT 'N/A' AS display, 'N/A' AS term, 0 AS internal
	    FROM dual
            </sql>
        </sqlQuery>

        <processQuery name="MetbPathwaysWithGenesList" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB" doNotTest="1">
            <wsColumn name="internal" width="100" wsName="internal"/>
            <wsColumn name="term" width="200" wsName="term"/>
            <wsColumn name="display" width="100" wsName="display"/>
        </processQuery>


        <sqlQuery name="MetbPathwayIDsWithGenesList"  doNotTest="1" excludeProjects="EuPathDB">
            <column name="internal" />
            <column name="term" />
            <column name="display" />
            <sql>
            SELECT DISTINCT n.description ||' ('|| n.name||')' as display,
                            n.name as term,
                            n.network_context_id as internal
            FROM apidb.NetworkContext n, dots.Transcript t,  dots.translatedAaFeature taf,  
               sres.enzymeClass ec, dots.aaSequenceEnzymeClass asec, ApidbTuning.GeneAttributes ga, 
               apidb.networkrelationship nr, apidb.networkrelationshiptype nrt, ApiDB.NetworkRelContext nrc, 
               ApiDB.NetworkRelContextLink nrl, apidb.networknode nn
            WHERE ga.na_feature_id  = t.parent_id
            AND t.na_feature_id = taf.na_feature_id
            AND taf.aa_sequence_id = asec.aa_sequence_id
            AND asec.enzyme_class_id = ec.enzyme_class_id
            AND nn.display_label = ec.ec_number
            AND nr.associated_node_id = nn.network_node_id
            AND nrc.network_relationship_id = nr.network_relationship_id
            AND nrt.network_relationship_type_id = nrc.network_relationship_type_id
            AND nrl.network_rel_context_id = nrc.network_rel_context_id
            AND nrc.network_context_id = n.network_context_id
            </sql>
        </sqlQuery>


     </querySet>


</wdkModel>

