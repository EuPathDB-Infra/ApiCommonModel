<wdkModel>
    <recordClassSet name="SageTagRecordClasses" includeProjects="PlasmoDB,GiardiaDB,TriTrypDB,ToxoDB,EuPathDB">

      <recordClass name="SageTagRecordClass" displayName="SAGE Tag Alignment" shortDisplayName="Sage Tag">

             <testParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">Pf3D7_11_v3-1295356-1295370.0</paramValue>
               <paramValue name="project_id">PlasmoDB</paramValue>
            </testParamValues>

            <testParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrII-1012006-1012020.0</paramValue>
               <paramValue name="project_id">ToxoDB</paramValue>
            </testParamValues>

            <testParamValues includeProjects="GiardiaDB">
               <paramValue name="source_id">CH991831-1318-1333.0</paramValue>
               <paramValue name="project_id">GiardiaDB</paramValue>
            </testParamValues>

            <testParamValues includeProjects="TriTrypDB">
               <paramValue name="source_id">Tb927_01_v4-1002961-1002982.0</paramValue>
               <paramValue name="project_id">TriTrypDB</paramValue>
            </testParamValues>

            <!-- primary key definition -->
            <primaryKeyAttribute name="primary_key"
                                 displayName="Tag">
                <columnRef>source_id</columnRef>
                <columnRef>project_id</columnRef>
                <text>
                    <![CDATA[
                    $$source_id$$
                    ]]>
                </text>                
            </primaryKeyAttribute>


      <!-- =============================================================== -->
      <!--   Reporters -->
      <!-- =============================================================== -->

      <reporter name="tabular" displayName="Tab delimited (Excel): choose from columns"
                implementation="org.gusdb.wdk.model.report.TabularReporter" />

      <reporter name="fullRecord" displayName="Text: choose from columns and/or tables" excludeProjects="EuPathDB" 
                  implementation="org.gusdb.wdk.model.report.FullRecordReporter" />
        <reporter name="xml" displayName="XML: choose from columns and/or tables"  excludeProjects="EuPathDB" 
                    implementation="org.gusdb.wdk.model.report.XMLReporter" />
          <reporter name="json" displayName="json: choose from columns and/or tables"  excludeProjects="EuPathDB" 
                    implementation="org.gusdb.wdk.model.report.JSONReporter" />

      <!-- =============================================================== -->
      <!--   Filters -->
      <!-- =============================================================== -->


     <answerFilterLayout name="eupath_project" visible="true"
                             fileName="eupath_project_filter.jsp" 
                            displayName="Filter results by component website" includeProjects="EuPathDB">
            <instanceRef ref="all_results" />
            <instanceRef ref="crypto_sagetags" />
            <instanceRef ref="giardia_sagetags" />
            <instanceRef ref="plasmo_sagetags" />
            <instanceRef ref="toxo_sagetags" />
            <instanceRef ref="trich_sagetags" />
            <instanceRef ref="tritryp_sagetags" />
            <instanceRef ref="amoeba_sagetags" />
            <instanceRef ref="micro_sagetags" />
      </answerFilterLayout>



      <answerFilter queryRef="SageTagTables.AllResults"   includeProjects="EuPathDB">
                  <instance name="all_results" displayName="All Results" default="true">
                    <description>
                        <![CDATA[
                            All results
                        ]]>
                    </description>
                </instance>

      </answerFilter>


      <answerFilter queryRef="SageTagTables.ApiProjectSageTags"
                          includeProjects="EuPathDB">

               <instance name="crypto_sagetags" displayName="CryptoDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in CryptoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">CryptoDB</paramValue>
                </instance>
               <instance name="giardia_sagetags" displayName="GiardiaDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in GiardiaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">GiardiaDB</paramValue>
                </instance>
               <instance name="tritryp_sagetags" displayName="TriTrypDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in TriTrypDB.
                        ]]>
                    </description>
                    <paramValue name="Project">TriTrypDB</paramValue>
                </instance>
               <instance name="plasmo_sagetags" displayName="PlasmoDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in PlasmoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">PlasmoDB</paramValue>
                </instance>
               <instance name="toxo_sagetags" displayName="ToxoDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in ToxoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">ToxoDB</paramValue>
                </instance>
               <instance name="trich_sagetags" displayName="TrichDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in TrichDB.
                        ]]>
                    </description>
                    <paramValue name="Project">TrichDB</paramValue>
                </instance>
               <instance name="amoeba_sagetags" displayName="AmoebaDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in AmoebaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">AmoebaDB</paramValue>
                </instance>
               <instance name="micro_sagetags" displayName="MicrosporidiaDB" >
                    <description>
                        <![CDATA[
                            Number of SAGE Tags in MicrosporidiaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">MicrosporidiaDB</paramValue>
                </instance>
      </answerFilter>



      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag attributes -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

      <attributeQueryRef ref="SageTagAttributes.Attrs">
         <columnAttribute name="source_id" internal="true" inReportMaker="false"/>
         <columnAttribute name="tag_sequence" displayName="Tag Sequence" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="sequence_id" displayName="Sequence Id" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="start_min" displayName="Tag Start" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="end_max" displayName="Tag End" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="strand" displayName="Strand" internal="true" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="context_start" displayName="Genomic Context Start" internal="true" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="context_end" displayName="Genomic Context End" internal="true" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="organism" displayName="Organism" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="rad_source_id" displayName="External Identifier" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="project_id" displayName="Project Id" internal="true" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="gene_source_id" displayName="Gene" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="gene_product" displayName="Gene Product" internal="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>
         <columnAttribute name="feature_source_id" displayName="Feature source id" internal="true" includeProjects="EuPathDB,ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB"/>

         <textAttribute name="location_text" displayName="Genomic Location">
           <text>
               <![CDATA[
               $$sequence_id$$: $$start_min$$ - $$end_max$$ ($$strand$$)
               ]]>
           </text>
         </textAttribute>
      </attributeQueryRef>

      <attributeQueryRef ref="SageTagAttributes.AlignmentCount" includeProjects="ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB">
         <columnAttribute name="total_alignments" displayName="Number of Genomic Alignments" internal="true" />
      </attributeQueryRef>

      <attributeQueryRef ref="SageTagAttributes.GeneAlignmentCount" includeProjects="ToxoDB,GiardiaDB,TriTrypDB,PlasmoDB">
         <columnAttribute name="total_gene_alignments" displayName="Gene Count (ALL)" internal="true"/>
         <columnAttribute name="local_gene_alignments" displayName="Gene Count (Alignment)" internal="true"/>
      </attributeQueryRef>


      <textAttribute name="overview" displayName="Overview" inReportMaker="false" internal="true" excludeProjects="EuPathDB">
        <text>
             <![CDATA[
             Tag Sequence: $$tag_sequence$$<br>
             External Identifier: $$rad_source_id$$<br>
             Sequence Id: $$sequence_id$$<br>
             Tag Start: $$start_min$$<br>
             Tag End: $$end_max$$<br>
             Total Number of Genomic Alignments:  $$total_alignments$$<br>
             Total Number of Genes which align to this sequence:  $$total_gene_alignments$$<br>
             Number of Genes which align at this genomic location:  $$local_gene_alignments$$
             ]]>
        </text>
      </textAttribute>

      <textAttribute name="gbrowseTracks" inReportMaker="false" internal="true"
                     includeProjects="GiardiaDB,TriTrypDB,PlasmoDB,ToxoDB">
        <text includeProjects="GiardiaDB">
             <![CDATA[
              SAGEtags+Gene+DeprecatedGene
             ]]>
        </text>
        <text includeProjects="PlasmoDB,TriTrypDB,ToxoDB">
             <![CDATA[
              SAGEtags+Gene
             ]]>
        </text>
      </textAttribute>


      <!-- Need to add a text attribute for the genomic context -->


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag Tables -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    
      <table name="Locations" includeProjects="GiardiaDB,TriTrypDB,PlasmoDB,ToxoDB"
                 displayName="Genomic Locations"
                 queryRef="SageTagTables.Locations">
            <columnAttribute displayName= "Is Top Level" name="is_top_level" internal="true" inReportMaker="false"/>
            <columnAttribute displayName= "Sequence Type" name="term_name" internal="false"/>
            <columnAttribute displayName= "Genomic Sequence" name="sequence_source_id" internal="false"/>
            <textAttribute inReportMaker="true" name="location" displayName="Location">
                  <text>
                    <![CDATA[
                      $$start_min$$ - $$end_max$$ ($$is_reversed$$)
                    ]]>
                  </text>
            </textAttribute>
 
            <linkAttribute displayName="Genome Browser" name="view_link" inReportMaker="false" internal="false" >
                 <displayText>
                    <![CDATA[ View ]]>
                 </displayText>
                   <url includeProjects="GiardiaDB">
                    <![CDATA[
                      /cgi-bin/gbrowse/giardiadb/?name=$$sequence_source_id$$%3A$$start_context$$-$$end_context$$;label=SAGEtags;label=Gene;label=DeprecatedGene;h_feat=$$feature_source_id$$
                        ]]>
                   </url>
                   <url includeProjects="TriTrypDB">
                    <![CDATA[
                      /cgi-bin/gbrowse/tritrypdb/?name=$$sequence_source_id$$%3A$$start_context$$-$$end_context$$;label=SAGEtags;label=Gene;h_feat=$$feature_source_id$$
                        ]]>
                   </url>
                   <url includeProjects="PlasmoDB">
                    <![CDATA[
                    /cgi-bin/gbrowse/plasmodb/?name=$$sequence_source_id$$%3A$$start_context$$-$$end_context$$;label=SAGEtags;label=Gene;h_feat=$$feature_source_id$$
                        ]]>
                   </url> 
                   <url includeProjects="ToxoDB">
                    <![CDATA[
                    /cgi-bin/gbrowse/toxodb/?name=$$sequence_source_id$$%3A$$start_context$$-$$end_context$$;label=SAGEtags;label=Gene;h_feat=$$feature_source_id$$
                        ]]>
                   </url> 
           </linkAttribute>
            <columnAttribute displayName= "start" name="start_min" internal="true"/>
            <columnAttribute displayName= "end" name="end_max" internal="true"/>
            <columnAttribute displayName= "is_reversed" name="is_reversed" internal="true"/>
            <columnAttribute displayName= "start_context" name="start_context" internal="true"/>
            <columnAttribute displayName= "end_context" name="end_context" internal="true"/>
            <columnAttribute displayName= "Feature ID" name="feature_source_id" internal="true"/>
          </table>

      <table name="AllCounts" includeProjects="ToxoDB,PlasmoDB,GiardiaDB,TriTrypDB"
            displayName="Raw and Normalized Data"
            queryRef="SageTagTables.Experiments">
         <columnAttribute displayName="Library" name="experiment"/>
         <columnAttribute displayName="Raw Count" name="raw_count"/>
         <columnAttribute displayName="Raw Total" name="total_raw_count"/>
         <columnAttribute displayName="Normalized Count" name="norm_count"/>
         <columnAttribute displayName="Normalized Total" name="total_norm_count"/>
         <columnAttribute displayName="Percent Within Library" name="norm_percent"/>
     </table>

     <table name="Genes" includeProjects="ToxoDB,PlasmoDB,GiardiaDB,TriTrypDB"
            displayName="Gene Alignments of this Sage Tag"
            queryRef="SageTagTables.AlignedGenes">
         <columnAttribute  name="source_id" internal="true" displayName="SAGE Tag Alignment"/>
         <columnAttribute  name="gene_source_id" internal="true" displayName="Gene Source Id"/>
           <linkAttribute inReportMaker="false" displayName="SAGE Tag Alignment"
                          name="linkedSourceId">
                 <displayText>
                    <![CDATA[ $$source_id$$ ]]>
                 </displayText>
             <url><![CDATA[
                     showRecord.do?name=SageTagRecordClasses.SageTagRecordClass&project_id=@PROJECT_ID@&source_id=$$source_id$$
                    ]]>
             </url>
           </linkAttribute>
           <linkAttribute inReportMaker="false" displayName="Gene Source Id"
                          name="linkedGeneSourceId">
                 <displayText>
                    <![CDATA[ $$gene_source_id$$ ]]>
                 </displayText>
             <url><![CDATA[
                     showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=@PROJECT_ID@&source_id=$$gene_source_id$$
                    ]]>
             </url>
           </linkAttribute>
         <columnAttribute  name="gene_product" displayName="Gene Product" internal="false"/>
         <columnAttribute  name="gene_location" displayName="Gene Location" internal="false"/>
         <columnAttribute displayName="Strand" name="gene_strand"/>
         <columnAttribute displayName="Distance (bp) from gene" name="bp_from_gene"/>

     </table>

    </recordClass>

    </recordClassSet>
</wdkModel>
