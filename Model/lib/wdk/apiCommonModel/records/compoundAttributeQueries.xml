<wdkModel>
  <querySet name="CompoundAttributes" queryType="attribute" isCacheable="false" includeProjects="PlasmoDB">

      <defaultTestParamValues includeProjects="PlasmoDB">
          <paramValue name="source_id">CID:93072</paramValue>
          <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

       <testRowCountSql>
	 SELECT count(*) FROM ApidbTuning.CompoundAttributes
       </testRowCountSql>

        <sqlQuery name="Bfmv">
            <column name="project_id"/>
            <column name="source_id"  />
	    <column name="name"/>
            <column name="compound_id"  />
            <column name="compound_link"  />
            <column name="substance_id"  />
            <column name="substance_link"  />
           <sql>
            <![CDATA[
	         SELECT '@PROJECT_ID@' AS project_id, compound_id, source_id, name, substance_id,
		    CASE WHEN compound_id IS NULL THEN '-' 
	            ELSE '<a href="http://pubchem.ncbi.nlm.nih.gov/summary/summary.cgi?cid=' || compound_id || '">' ||  source_id || '</a>' 
	            END AS compound_link,
                    '<a href="http://ncbi.nlm.nih.gov/pcsubstance?term=' || replace(substance_id, ' ', '+') || '">' ||  substance_id || '</a>'  as substance_link
                FROM ApidbTuning.CompoundAttributes
	    ]]>
           </sql>
	</sqlQuery>

	<sqlQuery name="Synonyms">
	  <column name="project_id"/>
	  <column name="source_id"/>
	  <column name="synonyms"/>
	  <sql>
	    <![CDATA[
	       SELECT ca.source_id, '@PROJECT_ID@' as project_id, 
	           apidb.tab_to_string(set(CAST(COLLECT(comp.value) AS apidb.varchartab)),', ') as synonyms
	       FROM apidb.PubChemCompound comp, ApidbTuning.CompoundAttributes ca
	       WHERE ca.compound_id = comp.compound_id
	       AND comp.property = 'Synonym'
	       GROUP BY ca.source_id
	    ]]>
	  </sql>
	</sqlQuery>
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- Number of associated metabolic pathways -->
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <sqlQuery name="PathwaysCount" doNotTest="true">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="pathway_count"/>
            <sql>
            <![CDATA[
        SELECT  count (distinct pc.network_id) as pathway_count, '@PROJECT_ID@' as project_id, pc.compound_source_id as source_id
        from   ApiDBTuning.PathwayCompounds pc 
        group by pc.compound_source_id
            ]]>
            </sql>
        </sqlQuery>

  </querySet>
</wdkModel>
