<wdkModel>
    <querySet name="GeneSummaries" queryType="summary">

     <!-- notes

       - all projects need a gene alias query (or, we have to break that out of the 
         <recordClass> element

     -->

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- Gene strains summary-->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="AllResults" isCacheable="false" includeProjects="EuPathDB,ToxoDB,GiardiaDB,CryptoDB,TriTrypDB,PlasmoDB,AmoebaDB,MicrosporidiaDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT source_id, project_id, wdk_weight
                    FROM $$gene_answer$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DeprecatedGenes" isCacheable="false" includeProjects="GiardiaDB,EuPathDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="AssemblageGenes" isCacheable="false" includeProjects="GiardiaDB">
            <paramRef ref="recordParams.assemblage_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.organism = $$assemblage_genes$$
                    and ga.is_deprecated = 0 
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="AssemblageGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.assemblage_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.organism = $$assemblage_genes$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="Genes" isCacheable="false" includeProjects="GiardiaDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>


<!--    deprecated....now using a subset of filters provided in comp sites for easier maintenance
        ....  still needed for those componet sites that do not hvave filters       -->

 <sqlQuery name="ApiGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>


       <sqlQuery name="ApiProjectGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.Project"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id
                    and ga.project_id = $$Project$$
                ]]>
            </sql>
        </sqlQuery>




 <sqlQuery name="ApiGiardiaGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga
                    where ga.source_id = c.source_id 
                    and c.project_id = 'GiardiaDB' 
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="BooleanExpansion" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT gb.source_id, gb.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = c.source_id
                    AND gb.gene_id = ga.gene_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="CryptoGenes" isCacheable="false" includeProjects="CryptoDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="wdk_weight"/>
            <column name="project_id"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="TriTrypGenes" isCacheable="false" includeProjects="TriTrypDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <paramRef ref="recordParams.sequenceId"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                      AND ga.sequence_id like $$sequenceId$$
                ]]>
            </sql>
        </sqlQuery>





        <sqlQuery name="PlasmoGenes" isCacheable="false" includeProjects="PlasmoDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="AmoebaGenes" isCacheable="false" includeProjects="AmoebaDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="MicroGenes" isCacheable="false" includeProjects="MicrosporidiaDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>


<!-- These are the organism names in apidb.geneattributes -->
<!-- This cannot be used until all component sites have the orthomcl group info in apidb.geneattributes -->
<!-- I think grouping by project_id works for a component site but does not work for the portal -->

 <sqlQuery name="PortalDistinctGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
              SELECT orthoreps.source_id,ga2.project_id, orthoreps.wdk_weight
              FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 
                                                'Plasmodium falciparum 3D7',           1, 
                                                'Plasmodium berghei strain ANKA',      2, 
                                                'Plasmodium chabaudi chabaudi',        3,
                                                'Plasmodium knowlesi strain H',        4,
                                                'Plasmodium vivax SaI-1',              5,  
                                                'Plasmodium yoelii yoelii str. 17XNL', 6, 

                                                'Trypanosoma brucei TREU927',         11, 
                                                'Leishmania braziliensis',            12,
                                                'Leishmania infantum',                13,
                                                'Leishmania major strain Friedlin',                   14,
                                                'Trypanosoma cruzi strain CL Brener', 15,

                                                'Cryptosporidium parvum Iowa II', 21, 
                                                'Cryptosporidium hominis',        22,
                                                'Cryptosporidium muris',          23,
                                                'Cryptosporidium parvum',         24,

                                                'Toxoplasma gondii GT1',  31, 
                                                'Toxoplasma gondii RH',   32, 
                                                'Toxoplasma gondii ME49', 33, 
                                                'Toxoplasma gondii VEG',  34, 
                                                'Neospora caninum',       35, 

                                                'Giardia lamblia ATCC 50803', 41, 

                                                'Trichomonas vaginalis G3',   51
                                  )
                                                    ) AS source_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga 
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name  ) orthoreps, apidb.geneattributes ga2

               WHERE orthoreps.source_id = ga2.source_id
          ) t
                ]]>
            </sql>
        </sqlQuery>



        <sqlQuery name="CryptoDistinctGenes" isCacheable="false" includeProjects="EuPathDB,CryptoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                     SELECT MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Cryptosporidium parvum Iowa II', 1, 
                                                'Cryptosporidium hominis', 2,
                                                'Cryptosporidium muris', 3,
                                                'Cryptosporidium parvum', 4)) AS source_id,
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name, ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="TriTrypDistinctGenes" isCacheable="false" includeProjects="EuPathDB,TriTrypDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Trypanosoma brucei TREU927', 1, 
                                                'Leishmania braziliensis', 2,
                                                'Leishmania infantum', 3,
                                                'Leishmania major strain Friedlin', 4,
                                                'Trypanosoma cruzi strain CL Brener', 5)) AS source_id,
                      ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="PlasmoOrthologGroups" isCacheable="false" includeProjects="EuPathDB,PlasmoDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Plasmodium falciparum 3D7', 1, 
                                                'Plasmodium vivax SaI-1', 2,
                                                'Plasmodium yoelii yoelii str. 17XNL', 3,
                                                'Plasmodium berghei str. ANKA', 4,
                                                'Plasmodium chabaudi chabaudi', 5,
                                                'Plasmodium knowlesi strain H', 6)) AS source_id,
                      ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name,ga.project_id 
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="TCruziDistinctGenes" isCacheable="false" includeProjects="EuPathDB,TriTrypDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(sa.database_name, 'Tcruzi Esmeraldo-like Chromosome Map - Rick Tarleton', 1, 
                                                'Tcruzi NonEsmeraldo-like Chromosome Map - Rick Tarleton', 2,
                                                'T.cruzi contigs and annotations', 3)) AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga, apidb.sequenceattributes sa
                      WHERE ga.source_id = ca.source_id
                      AND sa.na_sequence_id = ga.na_sequence_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.gene_id,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="GiardDistinctGenes" isCacheable="false" includeProjects="GiardiaDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(sa.database_name, 'Giardia lamblia ATCC 50803', 1, 
                                                'Giardia intestinalis ATCC 50581', 2,
                                                'Giardia lamblia P15', 3)) AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga, apidb.sequenceattributes sa
                      WHERE ga.source_id = ca.source_id
                      AND sa.na_sequence_id = ga.na_sequence_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.orthomcl_name,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="AmoebDistinctGenes" isCacheable="false" includeProjects="AmoebaDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(sa.database_name, 'Entamoeba histolytica HM-1:IMSS', 1, 
                                                'Entamoeba dispar SAW760', 2,
                                                'Entamoeba invadens IP1', 3)) AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga, apidb.sequenceattributes sa
                      WHERE ga.source_id = ca.source_id
                      AND sa.na_sequence_id = ga.na_sequence_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.orthomcl_name,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="MicroDistinctGenes" isCacheable="false" includeProjects="MicrosporidiaDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
            SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(sa.database_name, 'Encephalitozoon intestinalis', 1, 
                                                   'Encephalitozoon cuniculi GB-M1', 2,
                                                   'Enterocytozoon bieneusi H348',3)) AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga, apidb.sequenceattributes sa
                      WHERE ga.source_id = ca.source_id
                      AND sa.na_sequence_id = ga.na_sequence_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.orthomcl_name,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="ToxoGenes" isCacheable="false" includeProjects="EuPathDB,ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.gene_id,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="NeosporaGenes" isCacheable="false" includeProjects="EuPathDB,ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism = $$organism$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="AllTgResults" isCacheable="false" includeProjects="ToxoDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="OneToOneToOneTgGenes" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
select /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
from 
(SELECT  MAX(i.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(i.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id
                      FROM 
                      (select gb.gene_id,gb.project_id,gb.organism,min(gb.source_id) as source_id
from  $$gene_answer$$ c, apidb.GENEATTRIBUTES ga, apidb.GENEATTRIBUTES gb
where c.source_id = ga.SOURCE_ID
and ga.ORGANISM = 'Toxoplasma gondii ME49'
and ga.gene_id = gb.gene_id
and gb.organism = 'Toxoplasma gondii ME49'
group by gb.gene_id,gb.PROJECT_ID,gb.organism having count(*) = 1
UNION
select gb.gene_id,gb.project_id,gb.organism,min(gb.source_id) as source_id
from  $$gene_answer$$ c, apidb.GENEATTRIBUTES ga, apidb.GENEATTRIBUTES gb
where c.source_id = ga.SOURCE_ID
and ga.ORGANISM = 'Toxoplasma gondii GT1'
and ga.gene_id = gb.gene_id
and gb.organism = 'Toxoplasma gondii GT1'
group by gb.gene_id,gb.PROJECT_ID,gb.organism having count(*) = 1
UNION
select gb.gene_id,gb.project_id,gb.organism,min(gb.source_id) as source_id
from  $$gene_answer$$ c, apidb.GENEATTRIBUTES ga, apidb.GENEATTRIBUTES gb
where c.source_id = ga.SOURCE_ID
and ga.ORGANISM = 'Toxoplasma gondii VEG'
and ga.gene_id = gb.gene_id
and gb.organism = 'Toxoplasma gondii VEG'
group by gb.gene_id,gb.PROJECT_ID,gb.organism having count(*) = 1) i
                      GROUP BY i.gene_id having count(*) = 3) t, 
      ($$gene_answer$$) ca
WHERE t.source_id = ca.source_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="StrainInstances" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                    FROM $$gene_answer$$ ca, apidb.geneattributes ga
                    WHERE ga.source_id = ca.source_id
                    AND ga.organism = $$strain_a$$
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="TgStrainGenes" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3,
                                                'Toxoplasma gondii RH', 4)) AS source_id,
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, apidb.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$strain_a$$
                      GROUP BY ga.gene_id,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgStrainIntersect" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.strain_b"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                  SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(c.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id
                  FROM 
                    (SELECT gb.source_id, gb.project_id, ga.organism,ga.gene_id
                    FROM $$gene_answer$$ cb, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism = $$strain_a$$
                    AND gb.gene_id = ga.gene_id
                      INTERSECT
                    SELECT gb.source_id, gb.project_id, gb.organism,gb.gene_id
                    FROM $$gene_answer$$ cc, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$strain_b$$
                    AND gb.gene_id = ga.gene_id ) c
                  group by c.gene_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgStrainMinus" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.strain_b"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                  SELECT  MAX(d.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(d.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            d.project_id as project_id
                      FROM 
                  (SELECT c.source_id, c.project_id,c.organism, c.gene_id
                  FROM  (
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cb, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism = $$strain_a$$
                    AND gb.gene_id = ga.gene_id
                     MINUS
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cc, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$strain_b$$
                    AND gb.gene_id = ga.gene_id ) c
                  WHERE c.organism = $$strain_a$$) d
                  GROUP BY d.gene_id,d.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgAllMinus" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                    SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(c.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            c.project_id
                      FROM 
                      ( SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cb, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism like 'Toxoplasma%'
                    AND gb.gene_id = ga.gene_id
                     MINUS
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cc, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$strain_a$$
                    AND gb.gene_id = ga.gene_id ) c
                    group by c.gene_id,c.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgAllIntersect" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.strain_a"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                    SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            c.project_id
                      FROM ( SELECT gb.source_id, gb.project_id, gb.organism
                    FROM $$gene_answer$$ cb, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cb.source_id
                    AND gb.gene_id = ga.gene_id
                     INTERSECT
                    SELECT gb.source_id, gb.project_id, gb.organism
                    FROM $$gene_answer$$ cc, apidb.geneattributes ga, apidb.geneattributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$strain_a$$
                    AND gb.gene_id = ga.gene_id ) c
                    group by c.gene_id,c.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>


        <!-- this is not a filter query, it is the query used for basket function -->
        <sqlQuery name="AllGeneRecords" isCacheable="false">
            <column name="source_id"/>
            <column name="project_id"/>
            <sql>
                <![CDATA[ 
                SELECT ga.source_id, ga.project_id
                FROM apidb.geneattributes ga
                ]]>
            </sql>
        </sqlQuery>

    </querySet>

</wdkModel>
