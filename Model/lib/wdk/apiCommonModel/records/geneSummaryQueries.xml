<wdkModel>
    <querySet name="GeneSummaries" queryType="summary" isCacheable="false">

     <!-- notes

       - all projects need a gene alias query (or, we have to break that out of the 
         <recordClass> element

     -->

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- Gene strains summary-->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="AllResults" isCacheable="false" >
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT source_id, project_id, wdk_weight
                    FROM $$gene_answer$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="AllOrthologGroups" isCacheable="false" >
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, '%%primaryOrthoOrganism%%', -1, 
                                                '%%secondaryOrthoOrganism%%', 0
                                                )) AS source_id,
                      ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name,ga.project_id 
		) t
		]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="DistinctGenes" isCacheable="false" includeProjects="MicrosporidiaDB,PlasmoDB,ToxoDB,TriTrypDB,EuPathDB">
            <paramRef ref="recordParams.species"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ t.* FROM (
                      SELECT  MAX(ga.source_id)  AS source_id, 
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.species = $$species$$
                      GROUP BY ga.gene_id,ga.project_id
		) t
                ]]>
            </sql>
        </sqlQuery>



        <sqlQuery name="DeprecatedGenes" isCacheable="false" includeProjects="GiardiaDB,EuPathDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, ApidbTuning.GeneAttributes ga
                    where ga.source_id = c.source_id
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="Genes" isCacheable="false" includeProjects="GiardiaDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, ApidbTuning.GeneAttributes ga
                    where ga.source_id = c.source_id
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>


<!--    deprecated....now using a subset of filters provided in comp sites for easier maintenance
        ....  still needed for those componet sites that do not hvave filters       -->

 <sqlQuery name="ApiGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, ApidbTuning.GeneAttributes ga
                    where ga.source_id = c.source_id
                    and ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>



      <sqlQuery name="ApiProjectInstances" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.Project"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c 
                    WHERE c.project_id = $$Project$$
                ]]>
            </sql>
        </sqlQuery>


 <sqlQuery name="ApiGiardiaGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.deprecated_genes"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT c.source_id, c.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, ApidbTuning.GeneAttributes ga
                    where ga.source_id = c.source_id 
                    and c.project_id = 'GiardiaDB' 
                    and ga.is_deprecated = $$deprecated_genes$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="BooleanExpansion" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT gb.source_id, gb.project_id, c.wdk_weight
                    FROM $$gene_answer$$ c, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = c.source_id
                    AND gb.gene_id = ga.gene_id
                ]]>
            </sql>
        </sqlQuery>



   <sqlQuery name="OrganismGeneInstances" isCacheable="false">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="wdk_weight"/>
            <column name="project_id"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, apidbtuning.geneattributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                      AND ga.is_deprecated = 0 
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="TriTrypGenes" isCacheable="false" includeProjects="TriTrypDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="ToxoGenes" isCacheable="false" includeProjects="ToxoDB,EuPathDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                ]]>
            </sql>
        </sqlQuery>




<!-- These are the organism names in ApidbTuning.GeneAttributes -->
<!-- This cannot be used until all component sites have the orthomcl group info in ApidbTuning.GeneAttributes -->
<!-- I think grouping by project_id works for a component site but does not work for the portal -->

 <sqlQuery name="PortalDistinctGenes" isCacheable="false" includeProjects="EuPathDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
              SELECT orthoreps.source_id,ga2.project_id, orthoreps.wdk_weight
              FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 
                                                'Plasmodium falciparum 3D7',           1, 
                                                'Plasmodium berghei strain ANKA',      2, 
                                                'Plasmodium chabaudi chabaudi',        3,
                                                'Plasmodium knowlesi strain H',        4,
                                                'Plasmodium vivax SaI-1',              5,  
                                                'Plasmodium yoelii yoelii str. 17XNL', 6, 

                                                'Trypanosoma brucei TREU927',         11, 
                                                'Leishmania braziliensis',            12,
                                                'Leishmania infantum',                13,
                                                'Leishmania major strain Friedlin',                   14,
                                                'Trypanosoma cruzi strain CL Brener', 15,

                                                'Cryptosporidium parvum Iowa II', 21, 
                                                'Cryptosporidium hominis',        22,
                                                'Cryptosporidium muris',          23,
                                                'Cryptosporidium parvum',         24,

                                                'Toxoplasma gondii GT1',  31, 
                                                'Toxoplasma gondii RH',   32, 
                                                'Toxoplasma gondii ME49', 33, 
                                                'Toxoplasma gondii VEG',  34, 
                                                'Neospora caninum',       35, 

                                                'Giardia lamblia ATCC 50803', 41, 

                                                'Trichomonas vaginalis G3',   51
                                  )
                                                    ) AS source_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga 
                      WHERE ga.source_id = ca.source_id
                      GROUP BY ga.orthomcl_name  ) orthoreps, ApidbTuning.GeneAttributes ga2

               WHERE orthoreps.source_id = ga2.source_id
          ) t
                ]]>
            </sql>
        </sqlQuery>



        <sqlQuery name="AllTgResults" isCacheable="false" includeProjects="ToxoDB,EuPathDB">
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                    SELECT ga.source_id, ga.project_id, ca.wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like 'Toxoplasma gondii%'
                ]]>
            </sql>
        </sqlQuery>



        <sqlQuery name="TgStrainGenes" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
          SELECT /*+ NO_MERGE(t) */ t.* FROM (
                    SELECT  MAX(ga.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3,
                                                'Toxoplasma gondii RH', 4)) AS source_id,
                            ga.project_id, max(ca.wdk_weight) as wdk_weight
                      FROM $$gene_answer$$ ca, ApidbTuning.GeneAttributes ga
                      WHERE ga.source_id = ca.source_id
                      AND ga.organism like $$organism$$
                      GROUP BY ga.gene_id,ga.project_id
          ) t
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgStrainIntersect" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.organism_b"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                  SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(c.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id
                  FROM 
                    (SELECT gb.source_id, gb.project_id, ga.organism,ga.gene_id
                    FROM $$gene_answer$$ cb, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism = $$organism$$
                    AND gb.gene_id = ga.gene_id
                      INTERSECT
                    SELECT gb.source_id, gb.project_id, gb.organism,gb.gene_id
                    FROM $$gene_answer$$ cc, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$organism_b$$
                    AND gb.gene_id = ga.gene_id ) c
                  group by c.gene_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgStrainMinus" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.organism_b"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                  SELECT  MAX(d.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(d.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            d.project_id as project_id
                      FROM 
                  (SELECT c.source_id, c.project_id,c.organism, c.gene_id
                  FROM  (
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cb, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism = $$organism$$
                    AND gb.gene_id = ga.gene_id
                     MINUS
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cc, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$organism_b$$
                    AND gb.gene_id = ga.gene_id ) c
                  WHERE c.organism = $$organism$$) d
                  GROUP BY d.gene_id,d.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgAllMinus" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                    SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(c.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            c.project_id
                      FROM 
                      ( SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cb, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cb.source_id
                    AND ga.organism like 'Toxoplasma%'
                    AND gb.gene_id = ga.gene_id
                     MINUS
                    SELECT gb.source_id, gb.project_id, gb.organism, gb.gene_id
                    FROM $$gene_answer$$ cc, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$organism$$
                    AND gb.gene_id = ga.gene_id ) c
                    group by c.gene_id,c.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="DetailsTgAllIntersect" isCacheable="false" includeProjects="ToxoDB">
            <paramRef ref="recordParams.organism"/>
            <paramRef ref="recordParams.gene_answer"/>
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="wdk_weight"/>
            <sql>
                <![CDATA[
                SELECT /*+ NO_MERGE(t) */ ca.source_id, ca.project_id, ca.wdk_weight
                FROM (
                    SELECT  MAX(c.source_id) KEEP (DENSE_RANK FIRST ORDER BY 
                            DECODE(ga.organism, 'Toxoplasma gondii ME49', 1, 
                                                'Toxoplasma gondii GT1', 2,
                                                'Toxoplasma gondii VEG', 3)) AS source_id,
                            c.project_id
                      FROM ( SELECT gb.source_id, gb.project_id, gb.organism
                    FROM $$gene_answer$$ cb, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cb.source_id
                    AND gb.gene_id = ga.gene_id
                     INTERSECT
                    SELECT gb.source_id, gb.project_id, gb.organism
                    FROM $$gene_answer$$ cc, ApidbTuning.GeneAttributes ga, ApidbTuning.GeneAttributes gb
                    WHERE ga.source_id = cc.source_id
                    AND ga.organism = $$organism$$
                    AND gb.gene_id = ga.gene_id ) c
                    group by c.gene_id,c.project_id) t,
                  ($$gene_answer$$) ca
                WHERE t.source_id = ca.source_id
                  AND t.project_id = ca.project_id
                ]]>
            </sql>
        </sqlQuery>


        <!-- this is not a filter query, it is the query used for basket function -->
        <sqlQuery name="AllGeneRecords" isCacheable="false">
            <column name="source_id"/>
            <column name="project_id"/>
            <sql>
                <![CDATA[ 
                SELECT ga.source_id, ga.project_id
                FROM ApidbTuning.GeneAttributes ga
                ]]>
            </sql>
        </sqlQuery>

    </querySet>

</wdkModel>
