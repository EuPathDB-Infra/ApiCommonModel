<wdkModel>

  <recordClassSet name="DataSourceRecordClasses" includeProjects="PlasmoDB,TriTrypDB,InitDB,FungiDB">

   <recordClass name="DataSourceRecordClass" type="DataSource">


     <testParamValues includeProjects="PlasmoDB">
         <paramValue name="data_source_name">Pfalciparum_chromosomes_RSRC</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
     </testParamValues>

     <testParamValues includeProjects="TriTrypDB">
         <paramValue name="data_source_name">??</paramValue>
         <paramValue name="project_id">TriTrypDB</paramValue>
      </testParamValues>


      <!-- primary key definition -->
      <primaryKeyAttribute name="primary_key"
                           displayName="Data Source Id">
          <columnRef>data_source_name</columnRef>
          <columnRef>project_id</columnRef>
          <text>
              <![CDATA[
                   $$data_source_name$$
               ]]>
           </text>                
      </primaryKeyAttribute>


      <!-- =============================================================== -->
      <!--   Reporters -->  
      <!-- =============================================================== -->

      <!-- =============================================================== -->
      <!--   Filters -->
      <!-- =============================================================== -->


      <!-- =================================================================== -->
      <!--  Text Attributes  ++++++++-->
      <!-- =================================================================== -->
       <attributeQueryRef ref="DataSourceAttributes.All" includeProjects="PlasmoDB,TriTrypDB,InitDB,FungiDB">
         <columnAttribute name="display_name" displayName="Data Source" inReportMaker="false"/>
         <columnAttribute name="version" displayName="Version" inReportMaker="false"/>
         <columnAttribute name="public_url" displayName="URL" inReportMaker="false"/>
         <columnAttribute name="categories" displayName="Categories" inReportMaker="false"/>
         <columnAttribute name="organisms" displayName="Organisms" inReportMaker="false"/>
         <columnAttribute name="description" displayName="Description" inReportMaker="false"/>
         <columnAttribute name="contact" displayName="Contact" inReportMaker="false"/>
         <columnAttribute name="email" displayName="Email" inReportMaker="false"/>
         <columnAttribute name="institution" displayName="Institution" inReportMaker="false"/>
       </attributeQueryRef>

     <!-- =================================================================== -->
     <!-- Tables ++++++++-->
     <!-- =================================================================== -->

        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- Publications -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <table name="Publications" includeProjects="PlasmoDB,TriTrypDB,InitDB,FungiDB"
               displayName="Associated publications"
               queryRef="DataSourceTables.Publications">
            <columnAttribute name="pmid" displayName="Pubmed ID"/>
            <columnAttribute name="doi" displayName="DOI"/>
            <columnAttribute name="citation" displayName="Citation"/>
        </table>  

        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- References -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <table name="References" includeProjects="PlasmoDB,TriTrypDB,InitDB,FungiDB"
               displayName="References"
               queryRef="DataSourceTables.References">
            <columnAttribute name="record_type"/>
            <columnAttribute name="target_type"/>
            <columnAttribute name="target_name"/>
        </table>  

      </recordClass>
    </recordClassSet>


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Attribute queries -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <querySet name="DataSourceAttributes" queryType="attribute">

      <defaultTestParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">AU087658</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

       <testRowCountSql includeProjects="EuPathDB">
	 SELECT count(*) FROM apidb.DataSource
       </testRowCountSql>

      <sqlQuery name="All" includeProjects="PlasmoDB, TriTrypDB,InitDB,FungiDB">
        <column name="data_source_name"/>
        <column name="project_id"/>
        <column name="display_name"/>
        <column name="version"/>
        <column name="public_url"/>
        <column name="categories"/>
        <column name="organisms"/>
        <column name="description"/>
        <column name="contact"/>
        <column name="email"/>
        <column name="institution"/>
            <sql>
            <![CDATA[
            SELECT name as data_source_name, project_id,
                   version, public_url, categories, organisms, description,
                   contact, email, institution
            FROM   ApiDB.DataSource
            WHERE  project_id = '@PROJECT_ID@'  

            ]]>
            </sql>
      </sqlQuery>

    </querySet>

      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Table queries -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <querySet name="DataSourceTables" queryType="table">

      <defaultTestParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">AU087658</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

      <sqlQuery name="Publications"  isCacheable='true' includeProjects="PlasmoDB, TriTrypDB,InitDB,FungiDB">
            <column name="data_source_name"/>
            <column name="project_id"/>
            <column name="pmid"/>
            <column name="doi"/>
            <column name="citation"/>
            <sql>
            <![CDATA[
            SELECT ds.name as data_source_name, '@PROJECT_ID@' as project_id,
                   dsp.pmid, dsp.doi, dsp.citation
            FROM   ApiDB.DataSource ds,  ApiDB.DataSourcePublication dsp
            WHERE  ds.data_source_id = dsp.data_source_id
              AND  ds.project_id = '@PROJECT_ID@'  

            ]]>
            </sql>
        </sqlQuery>

      <sqlQuery name="References"  isCacheable='true' includeProjects="PlasmoDB, TriTrypDB,InitDB,FungiDB">
            <column name="data_source_name"/>
            <column name="project_id"/>
            <column name="record_class"/>
            <column name="type"/>
            <column name="name"/>
            <sql>
            <![CDATA[
            SELECT ds.name as data_source_name, '@PROJECT_ID@' as project_id,
                   dsr.record_class, dsr.type, dsr.name
            FROM   ApiDB.DataSource ds,  ApiDB.DataSourceReference dsr
            WHERE  ds.data_source_id = dsr.data_source_id
            ]]>
            </sql>
        </sqlQuery>

    </querySet>

</wdkModel>
