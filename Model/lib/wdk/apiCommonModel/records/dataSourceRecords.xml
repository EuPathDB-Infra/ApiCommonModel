<wdkModel>

  <recordClassSet name="DataSourceRecordClasses" includeProjects="InitDB,PiroplasmaDB">

   <recordClass name="DataSourceRecordClass" type="DataSource">

      <!-- primary key definition -->
      <primaryKeyAttribute name="primary_key"
                           displayName="Data Source Id">
          <columnRef>data_source_name</columnRef>
          <columnRef>project_id</columnRef>
          <text>
              <![CDATA[
                   $$data_source_name$$
               ]]>
           </text>                
      </primaryKeyAttribute>


      <!-- =============================================================== -->
      <!--   Reporters -->  
      <!-- =============================================================== -->

          <reporter name="tabular" displayName="Summary - tab delimited"
                    implementation="org.gusdb.wdk.model.report.TabularReporter"/>

      <!-- =============================================================== -->
      <!--   Filters -->
      <!-- =============================================================== -->


      <!-- =================================================================== -->
      <!--  Text Attributes  ++++++++-->
      <!-- =================================================================== -->
       <attributeQueryRef ref="DataSourceAttributes.All" includeProjects="InitDB,PiroplasmaDB">

         <columnAttribute name="display_name" displayName="Data Source" inReportMaker="false"/>
         <columnAttribute name="version" displayName="Version" inReportMaker="false"/>
         <columnAttribute name="public_url" displayName="URL" inReportMaker="false"/>
         <columnAttribute name="categories" displayName="Categories" inReportMaker="false"/>
         <columnAttribute name="organism" displayName="Organism" inReportMaker="false"/>
         <columnAttribute name="description" displayName="Description" inReportMaker="false"/>
         <columnAttribute name="contact" displayName="Contact" inReportMaker="false"/>
         <columnAttribute name="institution" displayName="Institution" inReportMaker="false"/>
       </attributeQueryRef>

     <!-- =================================================================== -->
     <!-- Tables ++++++++-->
     <!-- =================================================================== -->

        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- Publications -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <table name="Publications" includeProjects="InitDB,PiroplasmaDB"
               displayName="Associated publications"
               queryRef="DataSourceTables.Publications">
            <columnAttribute name="pmid" displayName="Pubmed ID"/>
            <columnAttribute name="doi" displayName="DOI"/>
            <columnAttribute name="citation" displayName="Citation"/>
        </table>  

        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- References -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <table name="References" includeProjects="InitDB,PiroplasmaDB"
               displayName="References"
               queryRef="DataSourceTables.References">
            <columnAttribute name="record_type"/>
            <columnAttribute name="target_type"/>
            <columnAttribute name="target_name"/>
        </table>  

      </recordClass>
    </recordClassSet>


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Attribute queries -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <querySet name="DataSourceAttributes" queryType="attribute" doNotTest="true">

      <testRowCountSql includeProjects="EuPathDB">
	 SELECT count(*) FROM apidb.DataSource
       </testRowCountSql>

      <sqlQuery name="All" includeProjects="InitDB,PiroplasmaDB" isCacheable="false">
        <column name="data_source_name"/>
        <column name="project_id"/>
        <column name="display_name"/>
        <column name="version"/>
        <column name="public_url"/>
        <column name="categories"/>
        <column name="organism"/>
        <column name="description"/>
        <column name="contact"/>
        <column name="institution"/>
            <sql>
            <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, ds.project_id, 
                   ds.version, ds.organism, 
                   dsi.display_name, dsi.public_url, dsi.categories, 
                   dsi.description, dsi.contact, dsi.institution
            FROM   ApiDB.DataSource ds, apidb.DataSourceInfo dsi
            WHERE  ds.project_id = '@PROJECT_ID@'  
              AND  ds.data_source_id = dsi.data_source_id
            ]]>
            </sql>
      </sqlQuery>

    </querySet>

      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Table queries -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <querySet name="DataSourceTables" queryType="table">

      <sqlQuery name="Publications"  isCacheable='false' includeProjects="InitDB,PiroplasmaDB">
            <column name="data_source_name"/>
            <column name="project_id"/>
            <column name="pmid"/>
            <column name="doi"/>
            <column name="citation"/>
            <sql>
            <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, ds.project_id,
                   dsp.pmid, dsp.doi, dsp.citation
            FROM   ApiDB.DataSource ds, apidb.DataSourceInfo dsi, ApiDB.DataSourceInfoPublication dsp
            WHERE  ds.data_source_id = dsi.data_source_id
              AND  dsi.data_source_id = dsp.data_source_id
              AND  ds.project_id = '@PROJECT_ID@'  

            ]]>
            </sql>
        </sqlQuery>

      <sqlQuery name="References"  isCacheable='false' includeProjects="InitDB,PiroplasmaDB">
            <column name="data_source_name"/>
            <column name="project_id"/>
            <column name="record_type"/>
            <column name="target_type"/>
            <column name="target_name"/>
            <sql>
            <![CDATA[
            SELECT DISTINCT ds.name as data_source_name, ds.project_id,
                   dsr.record_type, dsr.target_type, dsr.target_name
            FROM   ApiDB.DataSource ds, apidb.DataSourceInfo dsi, ApiDB.DataSourceInfoReference dsr
            WHERE  ds.data_source_id = dsi.data_source_id
              AND  dsi.data_source_id = dsr.data_source_id
              AND  ds.project_id = '@PROJECT_ID@' 
            ]]>
            </sql>
        </sqlQuery>

    </querySet>

</wdkModel>
