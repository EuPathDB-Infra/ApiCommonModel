<wdkModel>
    <querySet name="SequenceTables" queryType="table">

            <defaultTestParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">Pf3D7_11</paramValue>
               <paramValue name="project_id">PlasmoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrIII</paramValue>
               <paramValue name="project_id">ToxoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="CryptoDB">
               <paramValue name="source_id">AAEE01000001</paramValue>
               <paramValue name="project_id">CryptoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="GiardiaDB">
               <paramValue name="source_id">CH991779</paramValue>
               <paramValue name="project_id">GiardiaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="TrichDB">
               <paramValue name="source_id">DS113177</paramValue>
               <paramValue name="project_id">TrichDB</paramValue>
            </defaultTestParamValues>
            <!-- TODO revisit source_id --> 
            <defaultTestParamValues includeProjects="TriTrypDB">
               <paramValue name="source_id">LmjF.36</paramValue>
               <paramValue name="project_id">TriTrypDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="AmoebaDB">
               <paramValue name="source_id">DS571186</paramValue>
               <paramValue name="project_id">AmoebaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="MicrosporidiaDB">
               <paramValue name="source_id">NC_003230</paramValue>
               <paramValue name="project_id">MicrosporidiaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="PiroplasmaDB">
               <paramValue name="source_id">AAXT01000006</paramValue>
               <paramValue name="project_id">PiroplasmaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="InitDB">
               <paramValue name="source_id"></paramValue>
               <paramValue name="project_id"></paramValue>
            </defaultTestParamValues>


        <sqlQuery name="SequencePieces"
               isCacheable="false">

            <testParamValues minRows="0" includeProjects="TrichDB,CryptoDB,TriTrypDB,AmoebaDB,MicrosporidiaDB,PiroplasmaDB"/>
            <testParamValues includeProjects="PlasmoDB">
                <paramValue name="source_id">CM000442</paramValue>
            </testParamValues>

            <column name="source_id" />
            <column name="project_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="piece_source_id" />
            <column name="piece_min" />
            <column name="piece_max" />
            <column name="piece_strand" />
            <sql>
            <![CDATA[
          SELECT * FROM (
            select vs.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            UNION
            select es.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            )
            order by source_id, sequence_order
             ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="Aliases"
               isCacheable="false">

            <testParamValues minRows="0" includeProjects="MicrosporidiaDB,AmoebaDB,CryptoDB,TrichDB,PiroplasmaDB"/>
	    <testParamValues includeProjects="ToxoDB">
	      <paramValue name="source_id">DS984994</paramValue>
	    </testParamValues>
	    <testParamValues includeProjects="PlasmoDB">
	      <paramValue name="source_id">AAKM01000027</paramValue>
	    </testParamValues>
	    <testParamValues includeProjects="TriTrypDB">
	      <paramValue name="source_id">Tcruzi_12139</paramValue>
	    </testParamValues>
            <column name="source_id" />
            <column name="project_id" />
            <column name="seq_id" />

            <sql>
            <![CDATA[
            SELECT sa.source_id, '@PROJECT_ID@' AS project_id, upper(si.id) as seq_id
            FROM ApidbTuning.SequenceAttributes sa, ApidbTuning.SequenceId si
            WHERE si.sequence = sa.source_id AND NOT lower(si.sequence) = si.id 
             ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="Centromere"
               isCacheable="false">

           <testParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">Pf3D7_05</paramValue>
            </testParamValues>
            <testParamValues minRows="0" includeProjects="ToxoDB,TrichDB,GiardiaDB,CryptoDB,TriTrypDB,AmoebaDB,MicrosporidiaDB,PiroplasmaDB"/>

            <column name="source_id" />
            <column name="project_id" />
            <column name="start_min" />
            <column name="end_max" />
            <sql>
            <![CDATA[
            SELECT ens.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   nl.start_min, nl.end_max
            FROM dots.NaSequence ens, dots.Miscellaneous m,
                 dots.NaLocation nl, sres.SequenceOntology so
            WHERE ens.na_sequence_id = m.na_sequence_id
              AND m.na_feature_id = nl.na_feature_id
              AND m.sequence_ontology_id = so.sequence_ontology_id
              AND so.term_name = 'centromere'
             ]]>
           </sql>
        </sqlQuery>

    <sqlQuery name="SequenceGffDbxrefs"  excludeProjects="EuPathDB" 
            isCacheable="false">
            <testParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrIa</paramValue>
            </testParamValues>

        <column name="source_id" />
        <column name="project_id" />
        <column name="gff_dbxref"/>
        <sqlParamValue name="brcName" includeProjects="PlasmoDB">ApiDB_PlasmoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="CryptoDB">ApiDB_CryptoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="ToxoDB">ApiDB_ToxoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="GiardiaDB,TrichDB,TriTrypDB,AmoebaDB,MicrosporidiaDB,InitDB,PiroplasmaDB">ApiDB</sqlParamValue>
        <sql>
          <![CDATA[
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id,
                   'taxon:' || t.ncbi_tax_id AS gff_dbxref
            FROM dots.NaSequence ens, sres.Taxon t
            WHERE ens.taxon_id = t.taxon_id
/*           UNION
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id, so.so_id AS gff_dbxref
            FROM dots.NaSequence ens, sres.SequenceOntology so
            WHERE ens.sequence_ontology_id = so.sequence_ontology_id
*/           UNION
            SELECT ens.source_id,  '@PROJECT_ID@' AS project_id,
                   'GenBank:' || dr.primary_identifier AS gff_dbxref
            FROM dots.NaSequence ens, dots.dbrefNaSequence drns,
                 sres.DbRef dr, sres.ExternalDatabaseRelease edr,
                 sres.ExternalDatabase ed
            WHERE ens.na_sequence_id = drns.na_sequence_id
              AND drns.db_ref_id = dr.db_ref_id
              AND dr.external_database_release_id
                  = edr.external_database_release_id
              AND edr.external_database_id = ed.external_database_id
              AND ed.name = 'GenBank'
           UNION
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id,
                   '&&brcName&&:' || ens.source_id AS gff_dbxref
            FROM dots.NaSequence ens
          ]]>
        </sql>
    </sqlQuery>


       <sqlQuery name="GeneDeprecation" includeProjects="GiardiaDB">
	    <testParamValues includeProjects="GiardiaDB">
	      <paramValue name="source_id">GL50803_10871</paramValue>
	      <paramValue name="project_id">GiardiaDB</paramValue>
	    </testParamValues>

            <column name="source_id"/>
            <column name="project_id"/>
            <column name="action"/>
            <column name="action_date"/>
            <column name="reason"/>
            <sql>
            SELECT gd.*, '@PROJECT_ID@' as project_id
            FROM apidb.geneDeprecation gd, ApidbTuning.GeneAttributes ga 
            WHERE ga.source_id = gd.source_id
            </sql>
        </sqlQuery>

      <sqlQuery name="GenomeSequencingAndAnnotation" includeProjects="PiroplasmaDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="name"/>
            <column name="description"/>
            <column name="public_url"/>
            <column name="institution"/>
            <sql>
       select sa.source_id, sa.project_id, ed.name,i.description, i.public_url, i.institution 
        from apidb.datasourceinfo i, apidb.datasource d, SRES.externaldatabase ed, SRES.externaldatabaserelease er, ApidbTuning.SequenceAttributes sa
        where d.data_source_id = i.data_source_id
         and ed.external_database_id = er.external_database_id
         and er.external_database_release_id = d.external_database_release_id
         and lower(i.categories) like '%genome%'
           </sql>
        </sqlQuery>

      <sqlQuery name="Repeats" excludeProjects="EuPathDB,GiardiaDB,PiroplasmaDB,MicrosporidiaDB,ToxoDB,TrichDB">
	    <testParamValues includeProjects="TriTrypDB">
	      <paramValue name="source_id">Tb927_11_01_v4</paramValue>
	    </testParamValues>

            <column name="source_id"/>
            <column name="project_id"/>
            <column name="note"/>
            <column name="feature_key"/>
            <column name="start_min"/>
            <column name="end_max"/>
            <sql>
            select fl.sequence_source_id as source_id,
                   fl.project_id,
                   c.comment_string as note,
                   so.term_name as feature_key, 
                   fl.start_min, 
                   fl.end_max
            from ApidbTuning.FeatureLocation fl, sres.sequenceontology so, dots.nafeaturecomment c
            where feature_type = 'Repeats'
            and so.sequence_ontology_id = fl.sequence_ontology_id
            and fl.na_feature_id = c.na_feature_id (+)
           </sql>
        </sqlQuery>


      <sqlQuery name="TandemRepeats" excludeProjects="EuPathDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="note"/>
            <column name="feature_key"/>
            <column name="start_min"/>
            <column name="end_max"/>
            <sql>
            select fl.sequence_source_id as source_id,
                   fl.project_id,
                   'repeat_region' as feature_key, 
                   fl.start_min, 
                   fl.end_max,
                   'tandem repeat:  ' || tr.consensus as note
            from ApidbTuning.FeatureLocation fl, DOTS.tandemrepeatfeature tr
            where feature_type = 'TandemRepeatFeature'
            and tr.na_feature_id = fl.na_feature_id
           </sql>
        </sqlQuery>


      <sqlQuery name="LowComplexity" excludeProjects="EuPathDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="note"/>
            <column name="feature_key"/>
            <column name="start_min"/>
            <column name="end_max"/>
            <sql>
            select fl.sequence_source_id as source_id,
                   fl.project_id,
                   'misc_feature' as feature_key, 
                   fl.start_min, 
                   fl.end_max,
                  'low complexity region:  ' || upper(lc.name) as note
            from ApidbTuning.FeatureLocation fl, DOTS.LOWCOMPLEXITYNAFEATURE lc
            where fl.feature_type = 'LowComplexityNAFeature'
            and lc.na_feature_id = fl.na_feature_id
           </sql>
        </sqlQuery>


  </querySet>

</wdkModel>
