<wdkModel>
    <querySet name="PathwayAttributes" queryType="attribute" isCacheable="false" excludeProjects="EuPathDB">

      <defaultTestParamValues>
         <paramValue name="source_id">ec00626</paramValue>
          <paramValue name="project_id">@PROJECT_ID@</paramValue>
      </defaultTestParamValues>

       <testRowCountSql>
	 SELECT count(*)
         FROM sres.pathway p
         WHERE source_id NOT IN ('ec01100','ec01110','ec01120')
       </testRowCountSql>

        <sqlQuery name="Bfmv">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="pathway_source"/>
            <column name="description"  />
            <column name="total_enzyme_count"  />
            <column name="total_compound_count"  />
            <column name="url"  />
            <sql>
            <![CDATA[
		  SELECT p.source_id, '@PROJECT_ID@' as project_id,
                      p.name AS  description, 
                      enz.total_enzyme_count, cpd.total_compound_count, p.url, 
                      replace(replace(ed.name, 'Pathways_',''), '_RSRC','') AS pathway_source
                FROM  sres.pathway p,
                   sres.externalDatabase ed, sres.externalDatabaseRelease edr,
                   (SELECT count(*) AS total_compound_count, pathway_id 
                     FROM sres.pathwayNode pn, SRES.ontologyterm ot
                     WHERE pn.pathway_node_type_id = ot.ontology_term_id
                     AND ot.name ='molecular entity' 
                     GROUP BY pathway_id) cpd,
                   (SELECT count(*) AS total_enzyme_count, pathway_id 
                     FROM sres.pathwayNode pn, SRES.ontologyterm ot
                     WHERE pn.pathway_node_type_id = ot.ontology_term_id
                     AND ot.name ='enzyme'
                     GROUP BY pathway_id) enz
                WHERE ed.external_database_id = edr.external_database_id 
                and edr.external_database_release_id = p.external_database_release_id
                and cpd.pathway_id = p.pathway_id
                and enz.pathway_id = p.pathway_id
        ]]>
           </sql>
        </sqlQuery>

    </querySet>
</wdkModel>
