<wdkModel>
    <querySet name="PathwayAttributes" queryType="attribute" isCacheable="false" excludeProjects="EuPathDB">

      <defaultTestParamValues>
         <paramValue name="source_id">ec00626</paramValue>
          <paramValue name="project_id">@PROJECT_ID@</paramValue>
      </defaultTestParamValues>

       <testRowCountSql>
	 SELECT count(*)
         FROM apidb.networkContext n
         WHERE n.network_context_id in (select network_context_id from apidb.networkRelContext)
         AND n.name NOT IN ('ec01100','ec01110','ec01120')
       </testRowCountSql>

        <sqlQuery name="Bfmv">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="pathway_source"/>
            <column name="description"  />
            <column name="ext_source"  />
            <column name="image_id"  />
            <column name="total_enzyme_count"  />
            <column name="total_compound_count"  />
            <column name="url"  />
            <sql>
            <![CDATA[
                SELECT distinct n.name as source_id, n.name ||'.gif' as image_id, '@PROJECT_ID@' as project_id,
                       n.description as  description, nc.name as ext_source, 
                       count(distinct ec.network_node_id) as total_enzyme_count,
                       count(distinct cpd.network_node_id) as total_compound_count, p.url, 
                       replace(net.name, 'Metabolic Pathways - ') as pathway_source
                FROM   Apidb.NetworkContext nc, ApiDB.NetworkContext n, ApiDB.NetworkRelationship nr,
                       (Select network_node_id From ApiDB.NetworkNode where NODE_TYPE_ID = 1) ec, 
                       (Select network_node_id From ApiDB.NetworkNode where NODE_TYPE_ID = 2) cpd, 
                       ApiDB.NetworkRelContextLink nrcl, ApiDB.NetworkRelContext nrc, ApiDB.Pathway p, ApiDB.Network net
                WHERE  nrc.network_context_id = n.network_context_id
                AND    nrcl.network_rel_context_id = nrc.network_rel_context_id
                AND    nrc.network_context_id = nc.network_context_id
                AND    nrc.network_relationship_id = nr.network_relationship_id
                AND    (nr.associated_node_id = ec.network_node_id OR nr.node_id = ec.network_node_id)
                AND    (nr.associated_node_id = cpd.network_node_id OR nr.node_id = cpd.network_node_id)
                AND    n.name = p.source_id
                AND   n.name not in ('ec01100','ec01110','ec01120')
                AND  net.network_id = nrcl.network_id
                GROUP BY net.name, nc.name, n.name, n.description, p.url
        ]]>
           </sql>
        </sqlQuery>

    </querySet>
</wdkModel>
