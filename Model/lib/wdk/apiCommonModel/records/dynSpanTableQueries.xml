<wdkModel>
    <querySet name="DynSpanTables" queryType="table">


        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- genes -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="Genes"
               isCacheable="false">

            <column name="source_id" />
            <column name="project_id" />
            <column name="gene_source_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="strand"  />
            <column name="product"  />

            <sql>
            <![CDATA[
 
             select ids.source_id,ids.project_id,ga.source_id as gene_source_id,ga.start_min,ga.end_max,ga.strand,ga.product 
               from 
                      (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,2) as end_max,
                             case when regexp_substr(source_id, '[^:]+', 1, 3) = '0' then '+'
   				       when regexp_substr(source_id, '[^:]+', 1, 3) = '1' then '-'
   				       else 'Unknown' end as strand
                         FROM (##WDK_ID_SQL##)
                       ) ids,          
                       apidb.geneattributes ga
              where   ga.sequence_id = ids.seq_source_id AND
                      ga.start_min <= ids.end_max AND
                         ga.end_max >= ids.start_min
             order by start_min

             ]]>
           </sql>
        </sqlQuery>




  </querySet>

</wdkModel>
