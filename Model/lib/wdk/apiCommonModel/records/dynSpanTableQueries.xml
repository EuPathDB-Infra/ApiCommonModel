<wdkModel>
    <querySet name="DynSpanTables" queryType="table">

        <sqlQuery name="SequencePieces"
               isCacheable="false">

            <column name="source_id" />
            <column name="project_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="piece_source_id" />
            <column name="piece_min" />
            <column name="piece_max" />
            <column name="piece_strand" />
            <sql>
            <![CDATA[
          SELECT * FROM (
            select vs.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            UNION
            select es.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            )
            order by source_id, sequence_order
             ]]>
           </sql>
        </sqlQuery>




  </querySet>

</wdkModel>
