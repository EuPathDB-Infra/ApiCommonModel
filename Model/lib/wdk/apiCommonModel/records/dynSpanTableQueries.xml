<wdkModel>
    <querySet name="DynSpanTables" queryType="table">


        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- genes -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="Genes"
               isCacheable="false">

            <column name="source_id" />
            <column name="project_id" />
            <column name="gene_source_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="strand"  />
            <column name="product"  />

            <sql>
            <![CDATA[
 
             select ids.source_id,ids.project_id,ga.source_id as gene_source_id,ga.start_min,ga.end_max,ga.strand,ga.product 
               from 
                      (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,2) as end_max,
                             case when regexp_substr(source_id, '[^:]+', 1, 3) = '0' then '+'
   				       when regexp_substr(source_id, '[^:]+', 1, 3) = '1' then '-'
   				       else 'Unknown' end as strand
                         FROM (##WDK_ID_SQL##)
                       ) ids,          
                       apidb.geneattributes ga
              where   ga.sequence_id = ids.seq_source_id AND
                      ga.start_min <= ids.end_max AND
                         ga.end_max >= ids.start_min
             order by start_min

             ]]>
           </sql>
        </sqlQuery>



         <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- ORFs -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="Orfs"
               isCacheable="false">

            <column name="source_id" />
            <column name="project_id" />
            <column name="orf_source_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="is_reversed"  />


            <sql>
            <![CDATA[
 
             select ids.source_id,ids.project_id,oa.source_id as orf_source_id,oa.start_min,oa.end_max,oa.is_reversed
               from 
                      (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,2) as end_max,
                             case when regexp_substr(source_id, '[^:]+', 1, 3) = '0' then '+'
   				       when regexp_substr(source_id, '[^:]+', 1, 3) = '1' then '-'
   				       else 'Unknown' end as strand
                         FROM (##WDK_ID_SQL##)
                       ) ids,          
                       apidb.orfattributes oa
              where   oa.nas_id = ids.seq_source_id AND
                      oa.start_min <= ids.end_max AND
                      oa.end_max >= ids.start_min
             order by start_min

             ]]>
           </sql>
        </sqlQuery>


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <!-- sage tags -->  
        <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="SageTags"
               isCacheable="false">

            <column name="source_id" />
            <column name="project_id" />
            <column name="stag_source_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="is_reversed"  />
            <column name="sequence"  />
            <column name="gene_count" />
            <column name="gene_source_id" />
            <column name="gene_product"  />

            <sql>
            <![CDATA[
 

               select ids.source_id,ids.project_id,sta.source_id as stag_source_id,sta.start_min,sta.end_max,sta.is_reversed,sta.sequence, sta.gene_count, sta.gene_source_id, sta.gene_product 
               from 
                      (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,2) as end_max,
                             case when regexp_substr(source_id, '[^:]+', 1, 3) = '0' then '+'
   				       when regexp_substr(source_id, '[^:]+', 1, 3) = '1' then '-'
   				       else 'Unknown' end as strand
                         FROM (##WDK_ID_SQL##)
                       ) ids,          
                       apidb.sagetagattributes sta
              where   sta.sequence_source_id = ids.seq_source_id AND
                      sta.start_min <= ids.end_max AND
                         sta.end_max >= ids.start_min
             order by start_min





            ]]>
           </sql>
        </sqlQuery>


  </querySet>

</wdkModel>
