<wdkModel>
    <querySet name="GeneAttributes" queryType="attribute">

     <!-- notes

       - all projects need a gene alias query (or, we have to break that out of the 
         <recordClass> element

     -->


            <defaultTestParamValues includeProjects="PlasmoDB,EuPathDB">
               <paramValue name="source_id">%%defaultGene%%</paramValue>
               <paramValue name="project_id">PlasmoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_021330</paramValue>
               <paramValue name="project_id">ToxoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="CryptoDB">
               <paramValue name="source_id">cgd3_1400</paramValue>
               <paramValue name="project_id">CryptoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="GiardiaDB">
               <paramValue name="source_id">%%defaultGene%%</paramValue>
               <paramValue name="project_id">GiardiaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="TrichDB">
               <paramValue name="source_id">%%defaultGene%%</paramValue>
               <paramValue name="project_id">TrichDB</paramValue>
            </defaultTestParamValues>

            <!--TODO revisit the source_id, its correct but is a random source_id-->
            <defaultTestParamValues includeProjects="TriTrypDB">
               <paramValue name="source_id">Tc00.1047053510185.10</paramValue>
               <paramValue name="project_id">TriTrypDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="AmoebaDB">
               <paramValue name="source_id">%%defaultGene%%</paramValue>
               <paramValue name="project_id">AmoebaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="MicrosporidiaDB">
               <paramValue name="source_id">ECU07_1760</paramValue>
               <paramValue name="project_id">MicrosporidiaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="PiroplasmaDB">
               <paramValue name="source_id">BBOV_IV003850</paramValue>
               <paramValue name="project_id">PiroplasmaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="FungiDB,InitDB">
               <paramValue name="source_id"></paramValue>
               <paramValue name="project_id"></paramValue>
            </defaultTestParamValues>

            <testRowCountSql excludeProjects="EuPathDB">
               select count(na_feature_id)
               from dots.GeneFeature
               where external_database_release_id in (
                 select distinct(dbr.external_database_release_id)
                 from ApidbTuning.GeneAttributes ga, sres.ExternalDatabase db,
                      sres.ExternalDatabaseRelease dbr
                 where db.name = ga.external_db_name
                   and dbr.version = ga.external_db_version
                   and dbr.external_database_id = db.external_database_id
                 )
            </testRowCountSql>

            <testRowCountSql includeProjects="EuPathDB">
               SELECT count(*) FROM ApidbTuning.GeneAttributes
            </testRowCountSql>

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- Gene alias -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="GeneAlias" includeProjects="ToxoDB,PlasmoDB,TriTrypDB" doNotTest="true">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="old_source_id"/>
            <column name="old_project_id"/>
            <sql includeProjects="PlasmoDB,TriTrypDB">
              <![CDATA[
                SELECT ga.source_id, 
                       '@PROJECT_ID@' AS project_id,
                       a.ID as old_source_id, '@PROJECT_ID@' AS old_project_id
                FROM ApidbTuning.GeneId a, ApidbTuning.GeneAttributes ga
                WHERE ga.source_id = a.gene
                  AND a.unique_mapping = 1
              ]]>
            </sql>
            <sql includeProjects="ToxoDB">
              <![CDATA[
                SELECT f.gene as source_id, '@PROJECT_ID@' AS project_id,
                       f.id as old_source_id, '@PROJECT_ID@' AS old_project_id
                FROM (SELECT gene AS id, gene
                      FROM ApidbTuning.GeneId
                      WHERE id = lower(gene)
                      UNION
                      SELECT id, gene
                      FROM ApidbTuning.GeneId
                      WHERE id <> lower(gene)) f
              ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- TrackNewAnnotation -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

<!--  the workshop (re) annotations have become the official annotations and this section is obsolete

        <sqlQuery name="TrackNewAnnotation" includeProjects="PlasmoDB">
           <testParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">PF11_0344</paramValue>
            </testParamValues>

            <column name="project_id"/>
            <column name="source_id" />
            <column name="annotation_status" />
            <column name="new_product" />
            <column name="new_go" />
            <column name="new_ec" />
            <column name="new_protein" />
            <column name="new_product_string"/>
            <sql>
               select '@PROJECT_ID@' as project_id, ga.source_id, tna.status as annotation_status, tna.new_product, tna.new_go, tna.new_ec, tna.new_protein, tna.product as new_product_string
               from Apidb.TRACKNEWANNOTATION tna, ApidbTuning.GeneAttributes ga WHERE ga.source_id = tna.source_id(+)
            </sql>
        </sqlQuery>
-->

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!--  new annotation at GeneDB -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <sqlQuery name="updated_annotation" includeProjects="TriTrypDB,PlasmoDB">
           <testParamValues includeProjects="TriTrypDB">
               <paramValue name="source_id">LbrM.08.0010</paramValue>
            </testParamValues>

            <column name="project_id"/>
            <column name="source_id" />
            <column name="updated_annotation" />
	    <sql>
            select ga.source_id, '@PROJECT_ID@' as project_id, ua.changed_gene as updated_annotation
            from apidbtuning.geneattributes ga,
                 ( select distinct gi.gene as changed_gene
                   from apidbtuning.annotationchange ac, apidbtuning.geneid gi
                   where upper(gi.id) = upper(ac.gene)
                 ) ua
            where ga.source_id = ua.changed_gene (+)
            </sql>
        </sqlQuery>


	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<!--  old IDs - as per previous release  -->  
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<sqlQuery name="old_ids" includeProjects="PlasmoDB">
	  <testParamValues>
	    <paramValue name="source_id">PF3D7_0203200</paramValue>
	  </testParamValues>

	  <column name="project_id"/>
	  <column name="source_id" />
	  <column name="old_ids" />
	  <sql>
	    SELECT '@PROJECT_ID@' as project_id, source_id, 
	      (SELECT apidb.tab_to_string(set(cast(collect(old_source_id order by old_source_id) as apidb.varchartab)), ', ') 
	       FROM apidbtuning.TrackOldAnnotation toa
               WHERE new_source_id =  source_id
               GROUP BY new_source_id
              ) as old_ids
	    FROM apidbtuning.geneAttributes
	  </sql>
	</sqlQuery>


        <sqlQuery name="Bfmv">
            <column name="project_id"  ignoreCase="true"/>
            <column name="lc_project_id"  ignoreCase="false"/>
            <column name="source_id"  ignoreCase="true"/>
            <column name="gene_type"  ignoreCase="true"/>
            <column name="product"  ignoreCase="true"/>
            <column name="start_min" />
            <column name="end_max" />
            <column name="start_min_text"  sortingColumn="start_min"/>
            <column name="end_max_text"  sortingColumn="end_max"/>
            <column name="transcript_length" />
            <column name="cds_length" />
            <column name="protein_length" />
            <column name="context_start" />
            <column name="context_end" />
            <column name="coding_start" />
            <column name="coding_end" />
            <column name="strand_plus_minus"  sortingColumn="strand"/>
            <column name="sequence_id"  ignoreCase="true"/>
            <column name="cyc_db"  sortingColumn="organism_full" excludeProjects="AmoebaDB,MicrosporidiaDB,FungiDB,InitDB,PiroplasmaDB"/>
            <column name="cyc_gene_id"  sortingColumn="source_id"/>
            <column name="tm_count" />
            <column name="so_id" />
            <column name="so_term_name" />
            <column name="so_term_definition" />
            <column name="ontology_name" />
            <column name="so_version" />
            <column name="anticodon" />
            <column name="molecular_weight" />
            <column name="isoelectric_point" />
            <column name="min_molecular_weight" />
            <column name="max_molecular_weight" />
            <column name="hydropathicity_gravy_score" />
            <column name="aromaticity_score" />
            <column name="external_db_name" />
            <column name="external_db_version" />
            <column name="ncbi_tax_id" />
            <column name="chromosome" sortingColumn="chromosome_order_num" />
            <column name="chromosome_order_num" />
            <column name="is_pseudo" />
            <column name="pseudo_string" />
            <column name="genus_species"  sortingColumn="organism_full"/>
            <column name="organism_full"  sortingColumn="organism_full"/> 
            <column name="organism_text"  sortingColumn="organism_full"/>
            <column name="project"  ignoreCase="true"/>
            <column name="exon_count" />
            <column name="strand" />
            <column name="ec_numbers_string" excludeProjects="MicrosporidiaDB"/>
            <column name="orthomcl_name"/>
            <column name="total_snps_all_strains"/>
            <column name="nonsynonymous_snps_all_strains"/>
            <column name="synonymous_snps_all_strains"/>
            <column name="nonsyn_syn_ratio_all_strains"/>
            <column name="signalp_scores" />
            <column name="signalp_peptide" />
            <column name="ortholog_number" />
            <column name="paralog_number" />
            <column name="ann_go_component" excludeProjects="GiardiaDB,MicrosporidiaDB"/>
            <column name="ann_go_process" excludeProjects="GiardiaDB,MicrosporidiaDB"/>
            <column name="ann_go_function" excludeProjects="GiardiaDB,MicrosporidiaDB"/>
            <column name="pred_go_component"/>
            <column name="pred_go_process"/>
            <column name="pred_go_function"/>
            <column name="genedb_organism"  includeProjects="PlasmoDB"/>
            <column name="der_min_level" includeProjects="PlasmoDB"/>
            <column name="der_max_level" includeProjects="PlasmoDB"/>
            <column name="der_min_timing" includeProjects="PlasmoDB"/>
            <column name="der_max_timing" includeProjects="PlasmoDB"/>
            <column name="der_max_pct" includeProjects="PlasmoDB"/>
            <column name="der_max_fold_induction" includeProjects="PlasmoDB"/>
            <column name="winz_min_level" includeProjects="PlasmoDB"/>
            <column name="winz_max_level" includeProjects="PlasmoDB"/>
            <column name="winz_min_timing" includeProjects="PlasmoDB"/>
            <column name="winz_max_timing" includeProjects="PlasmoDB"/>
            <column name="winz_max_pct" includeProjects="PlasmoDB"/>

            <column name="type3_type1_fold_change"  includeProjects="ToxoDB,EuPathDB"/>
            <column name="type3_type2_fold_change"  includeProjects="ToxoDB,EuPathDB"/>
            <column name="type2_type1_fold_change"   includeProjects="ToxoDB,EuPathDB"/>

            <column name="formatted_gene_id"  
                    sortingColumn="gene_id" includeProjects="ToxoDB,EuPathDB"/>
            <column name="gene_id" includeProjects="ToxoDB,EuPathDB"/>

            <column name="is_deprecated"  includeProjects="GiardiaDB"/>

            <sqlParamValue name="organismTexts" excludeProjects="GiardiaDB">
                SUBSTR(bfmv.organism, 1, 1) || '. ' || 
                      SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ', 1, 1) +1) as organism_text,
            </sqlParamValue>

            <sqlParamValue name="organismTexts" includeProjects="GiardiaDB">
                bfmv.organism as organism_text,
            </sqlParamValue>


             <sqlParamValue name="toxo_expression" includeProjects="ToxoDB,EuPathDB">
                <![CDATA[
                   bfmv.type3_type1_fold_change, bfmv.type3_type2_fold_change, 
                   bfmv.type2_type1_fold_change, gene_id,
                   CASE WHEN bfmv.organism like 'Toxo%' THEN 'TG_' || to_char(bfmv.gene_id)
                        ELSE to_char(bfmv.gene_id) END as formatted_gene_id,
                ]]>
            </sqlParamValue>
            <sqlParamValue name="toxo_expression" excludeProjects="ToxoDB,EuPathDB">
                <![CDATA[
                ]]>
            </sqlParamValue>

            <sqlParamValue name="is_deprecated" includeProjects="GiardiaDB">
                <![CDATA[
                DECODE(bfmv.is_deprecated, 0, 'No', 1, 'Yes') AS is_deprecated,
                ]]>
            </sqlParamValue>
            <sqlParamValue name="is_deprecated" excludeProjects="GiardiaDB">
                <![CDATA[
                ]]>
            </sqlParamValue>
            <sqlParamValue name="cyc_db" includeProjects="PlasmoDB,EuPathDB">
                <![CDATA[
                   DECODE(bfmv.organism,
                          'Plasmodium falciparum 3D7', 'PLASMO', null)
                ]]>
            </sqlParamValue>
            <sqlParamValue name="cyc_db" includeProjects="ToxoDB">
                <![CDATA[
                   'TOXO'
                ]]>
            </sqlParamValue>
 <!-- TODO : check this -->
            <sqlParamValue name="cyc_db" includeProjects="CryptoDB,GiardiaDB,TrichDB,TriTrypDB,AmoebaDB,MicrosporidiaDB,FungiDB,InitDB,PiroplasmaDB">
                <![CDATA[
                   DECODE(
                   substr(
                     bfmv.organism, 
                     instr(ltrim(bfmv.organism), ' ', 1, 1)+1, 
                     instr(ltrim(bfmv.organism)||' ', ' ', 1, 2) - instr(bfmv.organism, ' ', 1, 1) -1
                   ),
                  'parvum', 'cparvum', 'hominis')
                ]]>
            </sqlParamValue>
            <sqlParamValue name="genedb_organism" includeProjects="PlasmoDB">
                <![CDATA[
                   DECODE(bfmv.organism,
                          'Plasmodium falciparum 3D7', 'malaria',
                          'Plasmodium berghei strain ANKA', 'pberghei',
                          'Plasmodium chabaudi chabaudi', 'pchabaudi',
                          'Plasmodium knowlesi strain H', 'pknowlesi',
                          null) as genedb_organism,
                ]]>
            </sqlParamValue>
            <sqlParamValue name="genedb_organism" excludeProjects="PlasmoDB">
                <![CDATA[
                ]]>
            </sqlParamValue>

            <sql>
            <![CDATA[
            SELECT bfmv.source_id, bfmv.gene_type, bfmv.product, bfmv.project_id, lower(bfmv.project_id) as lc_project_id, bfmv.project_id as project,
                   start_min, end_max,
                   trim(to_char(bfmv.start_min,'999,999,999')) as start_min_text,
                   trim(to_char(bfmv.end_max,'999,999,999')) as end_max_text,
                   decode(strand,'forward','+','reverse','-',null) as strand_plus_minus,
                   bfmv.cds_length, bfmv.protein_length, bfmv.transcript_length,
                   bfmv.context_start,bfmv.context_end,
                   bfmv.coding_start,bfmv.coding_end,
                   bfmv.sequence_id, bfmv.organism as organism_full, bfmv.tm_count, bfmv.so_id,
                   bfmv.so_term_name, bfmv.so_term_definition,
                   bfmv.ontology_name, bfmv.so_version, bfmv.anticodon,
                   bfmv.molecular_weight, bfmv.isoelectric_point,
                   bfmv.min_molecular_weight, bfmv.max_molecular_weight,
                   bfmv.hydropathicity_gravy_score, bfmv.aromaticity_score,
                   bfmv.external_db_name, bfmv.external_db_version,
                   bfmv.exon_count, bfmv.ncbi_tax_id,
                   species AS genus_species,
                   &&organismTexts&&
                   &&cyc_db&& AS cyc_db,
                   &&genedb_organism&&
                   &&toxo_expression&&
                   UPPER(bfmv.source_id) AS cyc_gene_id,
                   bfmv.strand,bfmv.ec_numbers as ec_numbers_string, bfmv.orthomcl_name,
                   bfmv.annotated_go_component as ann_go_component,
                   bfmv.annotated_go_function as ann_go_function,
                   bfmv.annotated_go_process as ann_go_process,
                   bfmv.predicted_go_component as pred_go_component,
                   bfmv.predicted_go_function as pred_go_function,
                   &&is_deprecated&& 
                   bfmv.predicted_go_process as pred_go_process,
                   bfmv.derisi_max_level as der_max_level,
                   bfmv.derisi_min_level as der_min_level,
                   bfmv.derisi_min_timing as der_min_timing,
                   bfmv.derisi_max_timing as der_max_timing,
                   to_char(bfmv.derisi_max_fold_induction, '999.99') as der_max_fold_induction,
                   TO_CHAR(bfmv.derisi_max_pct, '999.9') as der_max_pct,
                   bfmv.winzeler_max_level as winz_max_level,
                   bfmv.winzeler_min_level as winz_min_level,
                   bfmv.winzeler_min_timing as winz_min_timing,
                   bfmv.winzeler_max_timing as winz_max_timing,
                   TO_CHAR(bfmv.winzeler_max_pct, '999.9') as winz_max_pct,
                   bfmv.total_snps as total_snps_all_strains,
                   bfmv.nonsynonymous_snps as nonsynonymous_snps_all_strains,
                   bfmv.nonsyn_syn_ratio as nonsyn_syn_ratio_all_strains,
                   bfmv.synonymous_snps as synonymous_snps_all_strains,
                   bfmv.signalp_scores,bfmv.signalp_peptide,
                   ortholog_number,paralog_number, 
                   CASE WHEN chromosome_order_num is null THEN 'Not Assigned' ELSE to_char(chromosome) END as chromosome,
                   /*CASE WHEN chromosome_order_num is null THEN 'Not Assigned' ELSE to_char(chromosome_order_num) END as*/ chromosome_order_num,
                   decode(is_pseudo,0,'gene',1,'pseudogene') as pseudo_string, 
                   decode(is_pseudo,0,'No',1,'Yes') as is_pseudo
            FROM ApidbTuning.GeneAttributes bfmv
            ]]>
            </sql>

<!-- note that moved following up into sqlParamValues .. delete when all works

            <sql includeProjects="CryptoDB,GiardiaDB,TrichDB">
            <![CDATA[
            SELECT bfmv.source_id, bfmv.gene_type, bfmv.product,bfmv.project_id,
                   start_min, end_max,
                   trim(to_char(bfmv.start_min,'999,999,999')) as start_min_text,
                   trim(to_char(bfmv.end_max,'999,999,999')) as end_max_text,
                   decode(strand,'forward','+','reverse','-',null) as strand_plus_minus,
                   bfmv.cds_length, bfmv.protein_length, bfmv.transcript_length,
                   bfmv.context_start, bfmv.context_end, bfmv.strand,
                   bfmv.sequence_id,
                   '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.&nbsp;' || 
                       SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ', 1, 1) +1) || '</i>' as organism,
                   bfmv.organism  as organism_full, 
                   bfmv.tm_count, bfmv.so_id,
                   bfmv.so_term_name, bfmv.so_term_definition,
                   bfmv.ontology_name, bfmv.so_version, bfmv.anticodon,
                   bfmv.molecular_weight, bfmv.isoelectric_point,
                   bfmv.min_molecular_weight, bfmv.max_molecular_weight,
                   bfmv.hydropathicity_gravy_score, bfmv.aromaticity_score,
                   bfmv.external_db_name, bfmv.external_db_version, 
                   bfmv.exon_count, bfmv.ncbi_tax_id,
                   SUBSTR(bfmv.organism, 1, INSTR(bfmv.organism || '  ', ' ', 1, 2) - 1) AS genus_species,
                   SUBSTR(bfmv.organism,
                          INSTR(bfmv.organism, ' ') + 1,
                          INSTR(bfmv.organism || '  ', ' ', 1, 2) - INSTR(bfmv.organism, ' ') - 1) AS species,
                   DECODE(
                   substr(
                     bfmv.organism, 
                     instr(ltrim(bfmv.organism), ' ', 1, 1)+1, 
                     instr(ltrim(bfmv.organism)||' ', ' ', 1, 2) - instr(bfmv.organism, ' ', 1, 1) -1
                   ),
                  'parvum', 'cparvum', 'hominis')
                   AS cyc_db,
                   UPPER(bfmv.source_id) AS cyc_gene_id,
                   bfmv.ec_numbers as ec_numbers_string,
                   bfmv.annotated_go_component as ann_go_component,
                   bfmv.annotated_go_function as ann_go_function,
                   bfmv.annotated_go_process as ann_go_process,
                   bfmv.predicted_go_component as pred_go_component,
                   bfmv.predicted_go_function as pred_go_function,
                   &&is_deprecated&&
                   bfmv.predicted_go_process as pred_go_process
            FROM ApidbTuning.GeneAttributes bfmv
            ]]>
            </sql>
            <sql includeProjects="EuPathDB">
            <![CDATA[
            SELECT bfmv.source_id, bfmv.gene_type, bfmv.product, bfmv.project_id,
                   start_min, end_max,
                   trim(to_char(bfmv.start_min,'999,999,999')) as start_min_text,
                   trim(to_char(bfmv.end_max,'999,999,999')) as end_max_text,
                   decode(strand,'forward','+','reverse','-',null) as strand_plus_minus,
                   bfmv.cds_length, bfmv.protein_length, bfmv.transcript_length,
                   bfmv.context_start, bfmv.context_end, 
                   bfmv.sequence_id, 
                   bfmv.organism  as organism_full, 
                   bfmv.tm_count, bfmv.so_id,
                   bfmv.so_term_name, bfmv.so_term_definition,
                   bfmv.ontology_name, bfmv.so_version, bfmv.anticodon,
                   bfmv.molecular_weight, bfmv.isoelectric_point,
                   bfmv.min_molecular_weight, bfmv.max_molecular_weight,
                   bfmv.hydropathicity_gravy_score, bfmv.aromaticity_score,
                   bfmv.external_db_name, bfmv.external_db_version,
                   bfmv.exon_count, bfmv.ncbi_tax_id,
                   SUBSTR(bfmv.organism, 1, INSTR(bfmv.organism || '  ', ' ', 1, 2) - 1) AS genus_species,
                   '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.&nbsp;' || 
                       SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ', 1, 1) +1) || '</i>' as organism,
                   SUBSTR(bfmv.organism,
                          INSTR(bfmv.organism, ' ') + 1,
                          INSTR(bfmv.organism || '  ', ' ', 1, 2) - INSTR(bfmv.organism, ' ') - 1) AS species,
                   DECODE(bfmv.organism,
                          'Plasmodium falciparum 3D7', 'PLASMO', null)
                   AS cyc_db,
                   UPPER(bfmv.source_id) AS cyc_gene_id,
                   bfmv.strand,bfmv.ec_numbers as ec_numbers_string,
                   bfmv.annotated_go_component as ann_go_component,
                   bfmv.annotated_go_function as ann_go_function,
                   bfmv.annotated_go_process as ann_go_process,
                   bfmv.predicted_go_component as pred_go_component,
                   bfmv.predicted_go_function as pred_go_function,
                   bfmv.predicted_go_process as pred_go_process,
                   bfmv.derisi_max_level as der_max_level,
                   bfmv.derisi_min_level as der_min_level,
                   bfmv.derisi_min_timing as der_min_timing,
                   bfmv.derisi_max_timing as der_max_timing,
                   bfmv.derisi_max_pct as der_max_pct,
                   bfmv.winzeler_max_level as winz_max_level,
                   bfmv.winzeler_min_level as winz_min_level,
                   bfmv.winzeler_min_timing as winz_min_timing,
                   bfmv.winzeler_max_timing as winz_max_timing,
                   bfmv.winzeler_max_pct as winz_max_pct
            FROM ApidbTuning.GeneAttributes bfmv
            ]]>
            </sql>
-->

        </sqlQuery>





       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- tritrypdb gene names -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="GeneNames" displayName="Name" includeProjects="TriTrypDB,PiroplasmaDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="gene_name"/>
            <sql>
            <![CDATA[
               select ga.source_id, ga.name as gene_name, ga.project_id
               from ApidbTuning.GeneAttributes ga
            ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- toxo release4 genes -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="ToxoRelease4Info" displayName="Release4 Info" includeProjects="ToxoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="old_source_id"/>
            <column name="same_protein"/>
            <sql>
            <![CDATA[
              select ga.source_id,ga.project_id,
              apidb.tab_to_string(set(CAST(COLLECT(toa.old_source_id) AS apidb.varchartab)),', ') as old_source_id,
              decode(min(toa.new_protein),1,'No',0,'Yes') as same_protein
              from apidb.TRACKOLDANNOTATION toa, ApidbTuning.GeneAttributes ga
              where toa.source_id(+) = ga.SOURCE_ID
              group by ga.source_id,ga.project_id
            ]]>
            </sql>
        </sqlQuery>

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- protein sequence  -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

        <sqlQuery name="ChromosomeMappingText" displayName="Chromosome" includeProjects="CryptoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="chromosomemappingtext"/>
            <sql>
            <![CDATA[SELECT ga.source_id,'@PROJECT_ID@' as project_id,
                            CASE WHEN ga.chromosome IS NOT NULL
                                 THEN '( ' || ga.chromosome || ' )'
                                 ELSE '' END AS chromosomemappingtext
                     FROM ApidbTuning.GeneAttributes ga
            ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- protein sequence new annotation  -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!--  the workshop (re) annotations have become the official annotations and this section is obsolete

        <sqlQuery name="NewAnnotationProteinSequence" displayName="New Annotation Protein Sequence" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="workshop_protein_sequence"/>
            <sql>
            <![CDATA[
            SELECT tna.source_id,
                   tas.sequence AS workshop_protein_sequence,'@PROJECT_ID@' as project_id
            FROM dots.genefeature gf, dots.Transcript t,
                 dots.TranslatedAaFeature taf, dots.TranslatedAaSequence tas,
                 apidb.TRACKNEWANNOTATION tna
            WHERE tna.new_source_id = gf.source_id
              AND t.parent_id(+) = gf.na_feature_id
              AND t.na_feature_id = taf.na_feature_id(+)
              AND taf.aa_sequence_id = tas.aa_sequence_id(+)
            ]]>
            </sql>>
        </sqlQuery
 -->




        <sqlQuery name="ProteinSequence">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="protein_sequence"/>
            <sql>
            <![CDATA[
            SELECT ga.source_id, ga.project_id, ps.sequence AS protein_sequence
            FROM   ApidbTuning.ProteinSequence ps, ApidbTuning.GeneAttributes ga
            WHERE ga.source_id = ps.source_id (+)
            ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="GeneDBUpdatedProductName" includeProjects="TriTrypDB,PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="new_product_name"/>
            <sql>
            <![CDATA[
          SELECT source_id, 
                 project_id,
                 RTRIM (xmlagg (xmlelement (c, genedb_product_name || ' ; ') order by genedb_product_name).extract ('//text()'), ' ; ' ) AS new_product_name                
       /*           The above line collates the product names into a string with ';' delimiter. This is for scenarios where there are more than one 
                    possible product names provided from GeneDB (due to alternate splicing etc.) In Oracle 11g this can be accomplished
                    simply by using LISTAGG, but this is not provided in lesser versions.
      */  FROM  (SELECT  distinct ga.source_id as source_id, '@PROJECT_ID@' as project_id,
                                  CASE WHEN c.product != ga.product THEN c.product ELSE null END as genedb_product_name
                 FROM    ApidbTuning.GeneAttributes ga,
                        (select distinct gi.gene, cgp.product from apidbtuning.geneid gi, apidbtuning.changedgeneproduct cgp where upper(gi.id) = upper(cgp.gene)) c
                 WHERE   ga.source_id = c.gene(+)
                 )
          GROUP BY project_id,source_id
            ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="NaSequenceDatabaseName" excludeProjects="EuPathDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="sequence_database_name"/>
            <sql>
            <![CDATA[
            select ga.source_id, sa.database_name as sequence_database_name, '@PROJECT_ID@' as project_id
            from ApidbTuning.GeneAttributes ga, ApidbTuning.SequenceAttributes sa
            where ga.sequence_id = sa.source_id
            ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- phylogenetic trees -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
        <sqlQuery name="PhylogeneticTree"
                       displayName="Phylogenetic Tree" includeProjects="GiardiaDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="phyTreeId"/>
            <sql>
            <![CDATA[
              select tree.source_id as phyTreeId,ga.source_id, '@PROJECT_ID@' as project_id
              from apidb.phylogenetictree tree, ApidbTuning.GeneAttributes ga
              where ga.source_id = tree.source_id(+)
            ]]>
            </sql>
        </sqlQuery>

       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- transcript sequence -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

<!--  the workshop (re) annotations have become the official annotations and this section is obsolete

        <sqlQuery name="NewAnnotationTranscriptSequence"
                       displayName="RNA Sequence" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="workshop_transcript_sequence"/>
            <sql>
            <![CDATA[
              select tna.source_id, s.sequence as workshop_transcript_sequence,'@PROJECT_ID@' as project_id
              from dots.genefeature gf, dots.transcript t, dots.splicednasequence s, apidb.TRACKNEWANNOTATION tna
              where tna.new_source_id = gf.source_id
                and t.parent_id = gf.na_feature_id
                and s.na_sequence_id = t.na_sequence_id
            ]]>
            </sql>
        </sqlQuery>
-->

        <sqlQuery name="TranscriptSequence">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="transcript_sequence"/>
            <sql>
            <![CDATA[
             SELECT source_id, project_id, sequence AS transcript_sequence
             FROM   ApidbTuning.TranscriptSequence
            ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- cds sequence -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

<!--  the workshop (re) annotations have become the official annotations and this section is obsolete

        <sqlQuery name="NewAnnotationCDS"
                       displayName="New Annotation RNA Sequence" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="workshop_cds"/>
            <sql>
            <![CDATA[
              SELECT tna.source_id,
                     SUBSTR(s.sequence,
                            tf.translation_start,
                            tf.translation_stop - tf.translation_start + 1)
                       AS workshop_cds,'@PROJECT_ID@' as project_id
              FROM dots.genefeature gf, dots.transcript t,
                   dots.splicednasequence s, dots.TranslatedAaFeature tf,
                   apidb.TRACKNEWANNOTATION tna
              WHERE tna.new_source_id = gf.source_id
                AND t.parent_id = gf.na_feature_id
                AND s.na_sequence_id = t.na_sequence_id
                AND t.na_feature_id = tf.na_feature_id(+)
            ]]>
            </sql>
        </sqlQuery>
-->


        <sqlQuery name="Attributions" includeProjects="PlasmoDB,PiroplasmaDB,FungiDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="dataAttribution"/>
            <sql>
            <![CDATA[
              SELECT ga.source_id, ga.project_id  as project_id, dsa.description as dataAttribution 
              FROM   ApiDBTuning.GeneAttributes ga, ApiDBTuning.DataSourceAttribution dsa, ApiDB.DataSource ds
              WHERE  dsa.data_source_id = ds.data_source_id
              AND    ds.name = ga.external_db_name
              AND    ds.name in ('pfalIT_primary_genome_RSRC','pchachabaudi_primary_genome_RSRC','pknoH_primary_genome_RSRC','pfal3D7_primary_genome_RSRC','pberANKA_primary_genome_RSRC','pyoe17XNL_primary_genome_RSRC','pvivSaI1_primary_genome_RSRC','BbovisT2Bo_genomes_RSRC','TannulataAnkara_genomes_RSRC','TparvaMuguga_genomes_RSRC')
            ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="CDS">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="cds"/>
            <sql>
            <![CDATA[
              SELECT ga.source_id, ga.project_id, cs.sequence AS cds
              FROM   ApidbTuning.CodingSequence cs, ApidbTuning.GeneAttributes ga
              WHERE ga.source_id = cs.source_id (+)
            ]]>
            </sql>
        </sqlQuery>


       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
       <!-- plasmo expression graphs -->  
       <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

       <sqlQuery name="ExpressionGraphs" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="graph_derisi_winzeler" />
            <column name="graph_winzeler" />
            <column name="graph_3d7" />
            <column name="graph_hb3" />
            <column name="graph_dd2" />
            <column name="graph_waters"/>
            <column name="graph_gametocyte"/>
            <column name="graph_cowman"/>
            <column name="graph_mexp128"/>
            <column name="graph_kappe"/>
            <column name="graph_daily"/>
            <column name="graph_newbold"/>
            <column name="graph_zb_pvivax"/>
            <column name="graph_pf_rna_seq"/>
            <column name="graph_westenberger"/>
            <column name="graph_su_cq"/>
            <column name="graph_cowman_sir2"/>
            <column name="graph_winzeler_py_mixed"/>
            <column name="graph_waters_dozi"/>
            <sql>
            <![CDATA[
           SELECT egs.source_id, 'PlasmoDB' as project_id,
                      NVL(MAX(graph_zb_pvivax), 0) AS graph_zb_pvivax,
                      NVL(MAX(graph_pf_rna_seq), 0) AS graph_pf_rna_seq,
                      NVL(MAX(graph_derisi_winzeler), 0) AS graph_derisi_winzeler,
                      NVL(MAX(graph_winzeler), 0) AS graph_winzeler,
                      NVL(MAX(graph_3d7), 0) AS graph_3d7,
                      NVL(MAX(graph_hb3), 0) AS graph_hb3,
                      NVL(MAX(graph_dd2), 0) AS graph_dd2,
                      NVL(MAX(graph_waters), 0) AS graph_waters,
                      NVL(MAX(graph_gametocyte), 0) AS graph_gametocyte,
                      NVL(MAX(graph_cowman), 0) AS graph_cowman,
                      NVL(MAX(graph_mexp128), 0) AS graph_mexp128,
                      NVL(MAX(graph_kappe), 0) AS graph_kappe,
                      NVL(MAX(graph_westenberger), 0) AS graph_westenberger,
                      NVL(MAX(graph_winzeler_py_mixed), 0) AS graph_winzeler_py_mixed,
                      NVL(MAX(graph_newbold), 0) AS graph_newbold,
                      NVL(MAX(graph_su_cq), 0) AS graph_su_cq,
                      NVL(MAX(graph_cowman_sir2), 0) AS graph_cowman_sir2,
                      NVL(MAX(graph_waters_dozi), 0) AS graph_waters_dozi,
                      NVL(MAX(graph_daily), 0) AS graph_daily
               FROM ApidbTuning.PlasmoExpressionGraphs egs, ApidbTuning.GeneAttributes ga
                where ga.source_id = egs.source_id (+)
               group by egs.source_id
            ]]>
            </sql>
        </sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Plasmo Expression Profile Stats -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    
    <!-- Microarray -->
    <!-- Derisi Expression Timing -->
    <sqlQuery name="DerisiExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="derisi_48hr_max_expr_timing"/>
        <column name="derisi_48hr_min_expr_timing"/>
        <column name="derisi_48hr_max_pct"/>
        <column name="derisi_48hr_max_fold_ind"/>
        <sql> 
         <![CDATA[
          SELECT distinct  ga.source_id as source_id,
                 expn.max_timing as derisi_48hr_max_expr_timing,
                 expn.min_timing as derisi_48hr_min_expr_timing, 
                 percentile.max_pct as derisi_48hr_max_pct,
                 expn.max_fold_induction as derisi_48hr_max_fold_ind, 
                'PlasmoDB' as project_id
          FROM       
              (SELECT * FROM (SELECT p.source_id as source_id,
                            p.time_of_max_expr as max_timing,
                            p.time_of_min_expr AS min_timing,
                            p.ind_ratio as max_fold_induction,
                            row_number() over (partition by p.source_id order by p.ind_ratio desc) row_number
                     FROM apidb.Profile p, apidb.ProfileSet ps
                     WHERE ps.name like 'DeRisi % Smoothed'
                       AND p.profile_set_id = ps.profile_set_id)
                     WHERE row_number = 1) expn,
              (SELECT p.source_id, max(p.max_percentile) as max_pct
                    FROM apidb.Profile p, apidb.ProfileSet ps
                    WHERE ps.name like 'DeRisi % Smoothed'
                    AND p.profile_set_id = ps.profile_set_id
                    GROUP BY p.source_id) percentile,
               apidbtuning.geneAttributes ga
               where ga.source_id = percentile.source_id(+)
               and ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <!-- Winzeler Expression Timing -->
    <sqlQuery name="WinzelerExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="spz_gam_max_expr_timing"/>
        <column name="spz_gam_min_expr_timing"/>
        <column name="spz_gam_max_pct"/>
        <column name="spz_gam_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as spz_gam_max_expr_timing, expn.min_timing as spz_gam_min_expr_timing, 
                 max_pct as spz_gam_max_pct, expn.max_fold_induction as spz_gam_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'winzeler_cc_sorbExp'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
WHERE ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <!-- Waters HP/HPE Timing -->
    <sqlQuery name="WatersExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="hp_hpe_max_expr_timing"/>
        <column name="hp_hpe_min_expr_timing"/>
        <column name="hp_hpe_max_pct"/>
        <column name="hp_hpe_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as hp_hpe_max_expr_timing, expn.min_timing as hp_hpe_min_expr_timing, 
                 max_pct as hp_hpe_max_pct, expn.max_fold_induction as hp_hpe_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Waters HP'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <!-- P vivax Patients Expression Timing -->
    <sqlQuery name="ZBPatientsExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="patients_max_expr_timing"/>
        <column name="patients_min_expr_timing"/>
        <column name="patients_max_pct"/>
        <column name="patients_max_fold_ind"/>
        <sql> 
         <![CDATA[
          SELECT distinct ga.source_id as source_id,
                 expn.max_timing as patients_max_expr_timing,
                 expn.min_timing as patients_min_expr_timing, 
                 percentile.max_pct as patients_max_pct,
                 expn.max_fold_induction as patients_max_fold_ind, 
                'PlasmoDB' as project_id
          FROM       
              (SELECT * FROM (SELECT p.source_id as source_id,
                            p.time_of_max_expr as max_timing,
                            p.time_of_min_expr AS min_timing,
                            p.ind_ratio as max_fold_induction,
                            row_number() over (partition by p.source_id order by p.ind_ratio desc) row_number
                     FROM apidb.Profile p, apidb.ProfileSet ps
                     WHERE ps.name like 'ZB Pvivax time series %'
                       AND p.profile_set_id = ps.profile_set_id)
                     WHERE row_number = 1) expn,
              (SELECT p.source_id, max(p.max_percentile) as max_pct
                    FROM apidb.Profile p, apidb.ProfileSet ps
                    WHERE ps.name like 'ZB Pvivax time series %'
                    AND p.profile_set_id = ps.profile_set_id
                    GROUP BY p.source_id) percentile,
               apidbtuning.geneAttributes ga
               where ga.source_id = percentile.source_id(+)
               and ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <!-- Winzeler Gametocytogenesis -->
    <sqlQuery name="GametocytogenesisExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="gcg_max_expr_timing"/>
        <column name="gcg_min_expr_timing"/>
        <column name="gcg_max_pct"/>
        <column name="gcg_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as gcg_max_expr_timing, expn.min_timing as gcg_min_expr_timing, 
                 max_pct as gcg_max_pct, expn.max_fold_induction as gcg_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = ' winzeler_3D7_gametocyte'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    
    <!-- RNASeq -->
    <!-- Newbold/Llinas -->
    <sqlQuery name="iRBCRnaSeqExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="irbc_rnaseq_max_expr_timing"/>
        <column name="irbc_rnaseq_min_expr_timing"/>
        <column name="irbc_rnaseq_max_pct"/>
        <column name="irbc_rnaseq_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as irbc_rnaseq_max_expr_timing, expn.min_timing as irbc_rnaseq_min_expr_timing, 
                 max_pct as irbc_rnaseq_max_pct, expn.max_fold_induction as irbc_rnaseq_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'P. falciparum Newbold mRNA Seq data'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

   <!-- Stunnenberg -->
    <sqlQuery name="RBCiRnaSeqExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="rbci_rnaseq_max_expr_timing"/>
        <column name="rbci_rnaseq_min_expr_timing"/>
        <column name="rbci_rnaseq_max_pct"/>
        <column name="rbci_rnaseq_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as rbci_rnaseq_max_expr_timing, expn.min_timing as rbci_rnaseq_min_expr_timing, 
                 max_pct as rbci_rnaseq_max_pct, expn.max_fold_induction as rbci_rnaseq_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'pfal3D7_Stunnenberg_pi_time_series_scaled'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

   <!-- Cortes -->
    <sqlQuery name="transVarTS_3D7A_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_3D7A_max_expr_timing"/>
        <column name="transVarTS_3D7A_min_expr_timing"/>
        <column name="transVarTS_3D7A_max_pct"/>
        <column name="transVarTS_3D7A_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_3D7A_max_expr_timing, expn.min_timing as transVarTS_3D7A_min_expr_timing, 
                 max_pct as transVarTS_3D7A_max_pct, expn.max_fold_induction as transVarTS_3D7A_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum 3d7a'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_3D7B_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_3D7B_max_expr_timing"/>
        <column name="transVarTS_3D7B_min_expr_timing"/>
        <column name="transVarTS_3D7B_max_pct"/>
        <column name="transVarTS_3D7B_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_3D7B_max_expr_timing, expn.min_timing as transVarTS_3D7B_min_expr_timing, 
                 max_pct as transVarTS_3D7B_max_pct, expn.max_fold_induction as transVarTS_3D7B_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum 3d7b'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_10G_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_10G_max_expr_timing"/>
        <column name="transVarTS_10G_min_expr_timing"/>
        <column name="transVarTS_10G_max_pct"/>
        <column name="transVarTS_10G_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_10G_max_expr_timing, expn.min_timing as transVarTS_10G_min_expr_timing, 
                 max_pct as transVarTS_10G_max_pct, expn.max_fold_induction as transVarTS_10G_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum 10g'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_1_2B_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_1_2B_max_expr_timing"/>
        <column name="transVarTS_1_2B_min_expr_timing"/>
        <column name="transVarTS_1_2B_max_pct"/>
        <column name="transVarTS_1_2B_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_1_2B_max_expr_timing, expn.min_timing as transVarTS_1_2B_min_expr_timing, 
                 max_pct as transVarTS_1_2B_max_pct, expn.max_fold_induction as transVarTS_1_2B_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum 1_2b'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_7G8_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_7G8_max_expr_timing"/>
        <column name="transVarTS_7G8_min_expr_timing"/>
        <column name="transVarTS_7G8_max_pct"/>
        <column name="transVarTS_7G8_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_7G8_max_expr_timing, expn.min_timing as transVarTS_7G8_min_expr_timing, 
                 max_pct as transVarTS_7G8_max_pct, expn.max_fold_induction as transVarTS_7G8_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum 7g8'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_AB10_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_AB10_max_expr_timing"/>
        <column name="transVarTS_AB10_min_expr_timing"/>
        <column name="transVarTS_AB10_max_pct"/>
        <column name="transVarTS_AB10_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_AB10_max_expr_timing, expn.min_timing as transVarTS_AB10_min_expr_timing, 
                 max_pct as transVarTS_AB10_max_pct, expn.max_fold_induction as transVarTS_AB10_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum ab10'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_AB6_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_AB6_max_expr_timing"/>
        <column name="transVarTS_AB6_min_expr_timing"/>
        <column name="transVarTS_AB6_max_pct"/>
        <column name="transVarTS_AB6_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_AB6_max_expr_timing, expn.min_timing as transVarTS_AB6_min_expr_timing, 
                 max_pct as transVarTS_AB6_max_pct, expn.max_fold_induction as transVarTS_AB6_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum ab6'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_BB8_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_BB8_max_expr_timing"/>
        <column name="transVarTS_BB8_min_expr_timing"/>
        <column name="transVarTS_BB8_max_pct"/>
        <column name="transVarTS_BB8_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_BB8_max_expr_timing, expn.min_timing as transVarTS_BB8_min_expr_timing, 
                 max_pct as transVarTS_BB8_max_pct, expn.max_fold_induction as transVarTS_BB8_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum bb8'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_BC4_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_BC4_max_expr_timing"/>
        <column name="transVarTS_BC4_min_expr_timing"/>
        <column name="transVarTS_BC4_max_pct"/>
        <column name="transVarTS_BC4_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_BC4_max_expr_timing, expn.min_timing as transVarTS_BC4_min_expr_timing, 
                 max_pct as transVarTS_BC4_max_pct, expn.max_fold_induction as transVarTS_BC4_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum bc4'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_D10_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_D10_max_expr_timing"/>
        <column name="transVarTS_D10_min_expr_timing"/>
        <column name="transVarTS_D10_max_pct"/>
        <column name="transVarTS_D10_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_D10_max_expr_timing, expn.min_timing as transVarTS_D10_min_expr_timing, 
                 max_pct as transVarTS_D10_max_pct, expn.max_fold_induction as transVarTS_D10_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum d10'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_E3_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_E3_max_expr_timing"/>
        <column name="transVarTS_E3_min_expr_timing"/>
        <column name="transVarTS_E3_max_pct"/>
        <column name="transVarTS_E3_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_E3_max_expr_timing, expn.min_timing as transVarTS_E3_min_expr_timing, 
                 max_pct as transVarTS_E3_max_pct, expn.max_fold_induction as transVarTS_E3_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum e3'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_F1_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_F1_max_expr_timing"/>
        <column name="transVarTS_F1_min_expr_timing"/>
        <column name="transVarTS_F1_max_pct"/>
        <column name="transVarTS_F1_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_F1_max_expr_timing, expn.min_timing as transVarTS_F1_min_expr_timing, 
                 max_pct as transVarTS_F1_max_pct, expn.max_fold_induction as transVarTS_F1_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum f1'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_G2_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_G2_max_expr_timing"/>
        <column name="transVarTS_G2_min_expr_timing"/>
        <column name="transVarTS_G2_max_pct"/>
        <column name="transVarTS_G2_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_G2_max_expr_timing, expn.min_timing as transVarTS_G2_min_expr_timing, 
                 max_pct as transVarTS_G2_max_pct, expn.max_fold_induction as transVarTS_G2_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum g2'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_G4_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_G4_max_expr_timing"/>
        <column name="transVarTS_G4_min_expr_timing"/>
        <column name="transVarTS_G4_max_pct"/>
        <column name="transVarTS_G4_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_G4_max_expr_timing, expn.min_timing as transVarTS_G4_min_expr_timing, 
                 max_pct as transVarTS_G4_max_pct, expn.max_fold_induction as transVarTS_G4_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum g4'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_HB3A_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_HB3A_max_expr_timing"/>
        <column name="transVarTS_HB3A_min_expr_timing"/>
        <column name="transVarTS_HB3A_max_pct"/>
        <column name="transVarTS_HB3A_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_HB3A_max_expr_timing, expn.min_timing as transVarTS_HB3A_min_expr_timing, 
                 max_pct as transVarTS_HB3A_max_pct, expn.max_fold_induction as transVarTS_HB3A_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum hb3a'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_HB3B_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_HB3B_max_expr_timing"/>
        <column name="transVarTS_HB3B_min_expr_timing"/>
        <column name="transVarTS_HB3B_max_pct"/>
        <column name="transVarTS_HB3B_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_HB3B_max_expr_timing, expn.min_timing as transVarTS_HB3B_min_expr_timing, 
                 max_pct as transVarTS_HB3B_max_pct, expn.max_fold_induction as transVarTS_HB3B_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum hb3b'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_KG7_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_KG7_max_expr_timing"/>
        <column name="transVarTS_KG7_min_expr_timing"/>
        <column name="transVarTS_KG7_max_pct"/>
        <column name="transVarTS_KG7_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_KG7_max_expr_timing, expn.min_timing as transVarTS_KG7_min_expr_timing, 
                 max_pct as transVarTS_KG7_max_pct, expn.max_fold_induction as transVarTS_KG7_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum kg7'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_LD10_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_LD10_max_expr_timing"/>
        <column name="transVarTS_LD10_min_expr_timing"/>
        <column name="transVarTS_LD10_max_pct"/>
        <column name="transVarTS_LD10_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_LD10_max_expr_timing, expn.min_timing as transVarTS_LD10_min_expr_timing, 
                 max_pct as transVarTS_LD10_max_pct, expn.max_fold_induction as transVarTS_LD10_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum ld10'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>
    <sqlQuery name="transVarTS_W41_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_W41_max_expr_timing"/>
        <column name="transVarTS_W41_min_expr_timing"/>
        <column name="transVarTS_W41_max_pct"/>
        <column name="transVarTS_W41_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_W41_max_expr_timing, expn.min_timing as transVarTS_W41_min_expr_timing, 
                 max_pct as transVarTS_W41_max_pct, expn.max_fold_induction as transVarTS_W41_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum w41'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>

    <sqlQuery name="transVarTS_WE5_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_WE5_max_expr_timing"/>
        <column name="transVarTS_WE5_min_expr_timing"/>
        <column name="transVarTS_WE5_max_pct"/>
        <column name="transVarTS_WE5_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_WE5_max_expr_timing, expn.min_timing as transVarTS_WE5_min_expr_timing, 
                 max_pct as transVarTS_WE5_max_pct, expn.max_fold_induction as transVarTS_WE5_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum we5'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>
    <sqlQuery name="transVarTS_ZF8_ExprStats" includeProjects="PlasmoDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="transVarTS_ZF8_max_expr_timing"/>
        <column name="transVarTS_ZF8_min_expr_timing"/>
        <column name="transVarTS_ZF8_max_pct"/>
        <column name="transVarTS_ZF8_max_fold_ind"/>
        <sql> 
         <![CDATA[
 SELECT distinct ga.source_id as source_id, expn.max_timing as transVarTS_ZF8_max_expr_timing, expn.min_timing as transVarTS_ZF8_min_expr_timing, 
                 max_pct as transVarTS_ZF8_max_pct, expn.max_fold_induction as transVarTS_ZF8_max_fold_ind, 'PlasmoDB' as project_id
FROM (SELECT p.source_id,
             p.max_percentile AS max_pct,
             p.time_of_max_expr AS max_timing,
             p.time_of_min_expr AS min_timing,
             p.ind_ratio as max_fold_induction
      FROM apidb.Profile p, apidb.ProfileSet ps
      WHERE ps.name = 'Profiles of transcriptional variation in Plasmodium falciparum zf8'
        AND p.profile_set_id = ps.profile_set_id) expn,
               apidbtuning.geneAttributes ga
               where ga.source_id = expn.source_id(+)
          ]]>
        </sql>
      </sqlQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- GFF sequence -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="GeneGffSequence" excludeProjects="EuPathDB">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="gff_transcript_sequence"/>
        <sql>
          <![CDATA[
            select gf.source_id AS source_id, '@PROJECT_ID@' as project_id,
                   s.sequence as gff_transcript_sequence
            from ApidbTuning.GeneAttributes gf, 
                 DoTS.Transcript rna,
                 dots.splicednasequence s
            where gf.na_feature_id = rna.parent_id
                  and s.na_sequence_id = rna.na_sequence_id
          ]]>
        </sql>
      </sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- GFF attributes (other than sequence) -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="GeneGffAttrs">
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="gff_seqid"/>
        <column name="gff_source"/>
        <column name="gff_type"/>
        <column name="gff_fstart"/>
        <column name="gff_fend"/>
        <column name="gff_score"/>
        <column name="gff_strand"/>
        <column name="gff_phase"/>
        <column name="gff_attr_id"/>
        <column name="gff_attr_web_id"/>
        <column name="gff_attr_name"/>
        <column name="gff_attr_description"/>
        <column name="gff_attr_locus_tag"/>
        <column name="gff_attr_size"/>
        <sql>
          <![CDATA[
            select ga.source_id, project_id  as project_id,
                   'apidb|' || ga.sequence_id as gff_seqid,
                   'ApiDB' as gff_source,
                   'gene' as gff_type,
                   least(ga.start_min, ga.end_max) as gff_fstart,
                   greatest(ga.start_min, ga.end_max) as gff_fend,
                   '.' as gff_score,
                   decode(ga.is_reversed, 1, '-', '+') as gff_strand,
                   '.' as gff_phase,
                   'apidb|' || ga.source_id as gff_attr_id,
                   ga.source_id as gff_attr_web_id,
                   ga.source_id as gff_attr_name,
                   case
                     when ga.is_deprecated = 1 then ga.product || ' (deprecated)'
                     else ga.product
                   end as gff_attr_description,
                   ga.source_id as gff_attr_locus_tag,
                   (greatest(ga.start_min, ga.end_max)
                   - least(ga.start_min, ga.end_max) + 1) as gff_attr_size
            from ApidbTuning.GeneAttributes ga
          ]]>
        </sql>
      </sqlQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Protein Id's and Linkouts -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="Protein_Linkout" includeProjects="CryptoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="protein_id" />
            <column name="linkout" />
            <sql>
            <![CDATA[           
            SELECT 
                  g.source_id,'@PROJECT_ID@' as project_id,
                  DECODE (
                       protein_id, null, 
                           '', 
                           'Genbank Protein Record ' ||
                           '(<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?val=' ||
                            protein_id         || 
                            '">' || 
                            protein_id         ||
                            '</a>)'
                       )
                  as linkout, 
                  t.protein_id
            FROM  dots.transcript t, ApidbTuning.GeneAttributes g
            WHERE g.na_feature_id = t.parent_id(+)
            ]]>
            </sql>
        </sqlQuery>

<!--
        <sqlQuery name="SGC_3D_Struct" includeProjects="CryptoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="pdb_id"/>
            <sql>
              <![CDATA[
            SELECT distinct gf.source_id, '@PROJECT_ID@' as project_id, xx.pdb_id
            FROM ApidbTuning.GeneAttributes gf,
             (SELECT drnf.na_feature_id, dr.primary_identifier AS pdb_id
              FROM dots.DbRefNaFeature drnf,
                 sres.DbRef dr, sres.ExternalDatabaseRelease edr,
                 sres.ExternalDatabase ed
              WHERE drnf.db_ref_id = dr.db_ref_id
                AND dr.external_database_release_id = edr.external_database_release_id
                AND edr.external_database_id = ed.external_database_id
                AND ed.name = 'Structural Genomics Consortium 3D Structures') xx                      
            WHERE gf.na_feature_id = xx.na_feature_id(+)             
            ORDER BY pdb_id
              ]]>
            </sql>
        </sqlQuery>

-->

        <sqlQuery name="Translation" includeProjects="CryptoDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="translation" />
            <sql>
            <!-- UPPER(source_id) is a workaround to some unresolved bug where
                 the translation doesn't get returned via webservices
                 (UPPER removed until new sql munger updated to handle it) -->
            <!-- The sql weirdness is to force a single row result set of null
                 values when there is no translation (as is the case for 
                 non-protein coding genes) - the WDK doesn't allow an empty result.    -->
            <![CDATA[  
              SELECT g.source_id, '@PROJECT_ID@' as project_id,
                          tas.sequence as translation
              FROM    ApidbTuning.GeneAttributes g,
                    dots.translatedaasequence tas, 
                    dots.translatedaafeature taf, 
                    dots.transcript t
              WHERE g.na_feature_id = t.parent_id        
              AND taf.na_feature_id(+) = t.na_feature_id
              AND taf.aa_sequence_id = tas.aa_sequence_id(+) 
           
            ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="GeneticCode" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="genetic_code" />
            <column name="mitochondrial_genetic_code" />
            <column name="sequence_so_term" />
            <sql>
            SELECT g.source_id, '@PROJECT_ID@' as project_id,
                   gc.ncbi_genetic_code_id as genetic_code,
                   mgc.ncbi_genetic_code_id as mitochondrial_genetic_code,
                   so.term_name as sequence_so_term
            FROM ApidbTuning.GeneAttributes g,
                 ApidbTuning.SequenceAttributes sa,
                 sres.sequenceontology so,
                 sres.taxon t,
                 sres.geneticcode gc,
                 sres.geneticcode mgc
            WHERE sa.na_sequence_id = g.na_sequence_id
              AND so.so_id = sa.so_id
              AND t.taxon_id = g.taxon_id
              AND gc.genetic_code_id = t.genetic_code_id
              AND mgc.genetic_code_id = t.mitochondrial_genetic_code_id
           </sql>
        </sqlQuery>




        <!-- need to include the legacy plasmo stuff that is not included in profilegraphdescrip table -->
        <sqlQuery name="HasExpressionSection" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="hasExpression" />
            <sql>
            <![CDATA[  
            select ga.source_id, ga.project_id, 
                   case when ga.species in ('Plasmodium berghei', 'Plasmodium vivax', 'Plasmodium yoelii') then 1
                        when nvl(d.species, 0) = '0' then 0 
                        else 1 end as hasExpression
            from (select species from apidbtuning.profilegraphdescrip where type = 'expression') d, apidbtuning.geneattributes ga
            where ga.species = d.species (+)
            ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="HasPhenotypeSection" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="hasPhenotype" />
            <sql>
            <![CDATA[  
            select ga.source_id, ga.project_id, 
                   case when nvl(d.species, 0) = '0' then 0 
                        else 1 end as hasPhenotype
            from (select species from apidbtuning.profilegraphdescrip where type = 'phenotype') d, apidbtuning.geneattributes ga
            where ga.species = d.species (+)
            ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="HasPdbSimilarity" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="hasPdbSimilarity" />
            <sql>
            <![CDATA[  
            select distinct ga.source_id, ga.project_id,  
                   case when nvl(pdb.source_id, 0) = '0' then 0 
                         else 1 end as hasPdbSimilarity
            from apidbtuning.geneattributes ga,
                 (select * 
                  from apidbtuning.pdbsimilarity 
                  where to_binary_double(pvalue_mant || 'e' || pvalue_exp) < to_binary_double(10 || 'e' || -20)) pdb
            where ga.source_id = pdb.source_id (+)
            ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="HasSsgcid" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="hasSsgcid" />
            <sql>
            <![CDATA[  
               with sbri as (select distinct
                                    substr(eupathdb, instr(eupathdb, ':') + 1) as source_id,
                                    decode(substr(eupathdb, 1, instr(eupathdb, ':') - 1),
                                           'TritrypDB', 'TriTrypDB',
                                           substr(eupathdb, 1, instr(eupathdb, ':') - 1))
                                    as project_id
                             from ApidbTuning.Ssgcid),
                    sbri_genes as (select distinct 1 as hasSsgcid, gi.gene as source_id, sbri.project_id
                                   from sbri, ApidbTuning.GeneId gi
                                   where sbri.source_id = gi.id)
               select ga.source_id, ga.project_id, nvl(sg.hasSsgcid, 0) as hasSsgcid
               from sbri_genes sg, ApidbTuning.GeneAttributes ga
               where ga.source_id = sg.source_id(+)
                 and ga.project_id = sg.project_id(+)
            ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="GTracks" excludeProjects="EuPathDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="gtracks" />
            <sql>
            <![CDATA[  
            select ga.source_id, ga.project_id, gto.gtracks
            from apidbtuning.gbrowsetracksorganism gto, apidbtuning.geneattributes ga
            where ga.organism = gto.organism
            ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="GeneDBNewIdTemp" includeProjects="TriTrypDB,PlasmoDB">
            <column name="source_id" />
            <column name="project_id"/>
            <column name="genedb_new_id" />
            <sql>
            <![CDATA[  
            select ga.source_id, ga.project_id, genedb.id as genedb_new_id
            from apidbtuning.geneattributes ga,
                 (select gi.id, gi.gene
                  from apidbtuning.geneid gi
                  where gi.database_name in ('GeneDB ids','TcruziEsmeraldoLike_geneDB_NewID_dbxref_RSRC','TcruziNonEsmeraldoLike_geneDB_NewID_dbxref_RSRC')
                  and gi.unique_mapping = 1 
                 ) genedb
            where ga.source_id = genedb.gene (+)
            ]]>
           </sql>
        </sqlQuery>

    </querySet>

</wdkModel>
