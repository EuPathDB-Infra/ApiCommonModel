<wdkModel>
    <querySet name="OrganismAttributes" queryType="attribute" isCacheable="false">

      <defaultTestParamValues includeProjects="AmoebaDB">
	<paramValue name="source_id">edisSAW760</paramValue>
	<paramValue name="project_id">AmoebaDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="CryptoDB">
	<paramValue name="source_id">cmurRN66</paramValue>
	<paramValue name="project_id">CryptoDB</paramValue>
      </defaultTestParamValues>
      
      <defaultTestParamValues includeProjects="GiardiaDB">
	<paramValue name="source_id">gassAWB</paramValue>
	<paramValue name="project_id">GiardiaDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="MicrosporidiaDB">
	<paramValue name="source_id">ecunEC1</paramValue>
	<paramValue name="project_id">MicrosporidiaDB</paramValue>
      </defaultTestParamValues>
      
      <defaultTestParamValues includeProjects="PiroplasmaDB">
	<paramValue name="source_id">tannAnkara</paramValue>
	<paramValue name="project_id">PiroplasmaDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="PlasmoDB">
	<paramValue name="source_id">pfal3D7</paramValue>
	<paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>
      
      <defaultTestParamValues includeProjects="ToxoDB">
	<paramValue name="source_id">tgonME49</paramValue>
	<paramValue name="project_id">ToxoDB</paramValue>
      </defaultTestParamValues>
      
      <defaultTestParamValues includeProjects="TriTrypDB">
	<paramValue name="source_id">lmajFriedlin</paramValue>
	<paramValue name="project_id">TriTrypDB</paramValue>
      </defaultTestParamValues>
            
      <testRowCountSql excludeProjects="EuPathDB">
	select count(*) from apidb.organism
      </testRowCountSql>

       <sqlQuery name="organismAttrs">
          <column name="project_id" ignoreCase="true"/>
          <column name="source_id" ignoreCase="true"/> 
          <column name="data_source" ignoreCase="true"/>
          <column name="database_version" ignoreCase="true"/>
          <column name="genus" ignoreCase="true"/>
          <column name="species" ignoreCase="true"/>
          <column name="strain" ignoreCase="true"/>
          <column name="megabps" ignoreCase="true"/>
          <column name="ncbi_tax_id" ignoreCase="true"/>
          <column name="genecount" ignoreCase="true"/>
          <column name="pseudogenecount" ignoreCase="true"/>
          <column name="codinggenecount" ignoreCase="true"/>
          <column name="othergenecount" ignoreCase="true"/>
          <column name="arraygenecount" ignoreCase="true"/>
          <column name="ecnumbercount" ignoreCase="true"/>
          <column name="sagetagcount" ignoreCase="true"/>
          <column name="rnaseqcount" ignoreCase="true"/>
          <column name="snpcount" ignoreCase="true"/>
          <column name="estcount" ignoreCase="true"/>
          <column name="isolatecount" ignoreCase="true"/>
          <column name="chipchipgenecount" ignoreCase="true"/>
          <column name="rtpcrcount" ignoreCase="true"/>
          <column name="orthologcount" ignoreCase="true"/>
          <column name="tfbscount" ignoreCase="true"/>
          <column name="gocount" ignoreCase="true"/>
          <column name="proteomicscount" ignoreCase="true"/>
          <column name="communitycount" ignoreCase="true"/>
          <column name="organism_name" ignoreCase="true"/>
          <column name="isOrganellar_flag" ignoreCase="true"/>
          <column name="array_flag"/>
          <column name="chipchip_flag"/>
          <column name="rnaseq_flag"/>
          <column name="sagetag_flag"/>
          <column name="est_flag"/>
          <column name="snp_flag"/>
          <column name="hasHTSIsolate_flag"/>
          <column name="proteomics_flag"/> 
          <column name="is_annotated_genome"/> 
          <column name="orgNameDownload"/> 
          <sql>
          SELECT a.*, substr(genus, 1, 1) || species || strain as orgNameDownload
          FROM
          (
            SELECT source_id,
                   project_id,
                   regexp_substr(oa.organism_name, '\w{1,}') as genus,
                   trim(regexp_substr(oa.organism_name, '\s\w{1,}')) as species,
                   organism_name,
                   oa.megabps,
                   decode(genome_source, 'gb', 'GenBank', 'jkissinger', 'Kissinger Lab', genome_source) as data_source,
                   decode(oa.ncbi_tax_id, 0, null, oa.ncbi_tax_id) as ncbi_tax_id,
                   database_version,
                   oa.strain_abbrev as strain,
                   decode(oa.genecount, 0, null, oa.genecount) as genecount, 
                   oa.pseudogenecount,
                   oa.codinggenecount,
                   oa.othergenecount,
                   oa.arraygenecount,
                   oa.ecnumbercount,
                   oa.isolatecount,
                   oa.sagetagcount,
                   oa.rnaseqcount,
                   oa.snpcount,
                   oa.chipchipgenecount,
                   oa.rtpcrcount,
                   oa.estcount,
                   oa.orthologcount,
                   oa.gocount,
                   oa.tfbscount,
                   oa.proteomicscount,
                   oa.communitycount,
                   decode(oa.isOrganellar, 0, 'none','yes') as isOrganellar_flag,
                   decode(oa.arraygenecount, 0, 'none','yes') as array_flag,
                   decode(oa.chipchipgenecount, 0, 'none','yes') as chipchip_flag,
                   decode(oa.rnaseqcount, 0, 'none','yes') as rnaseq_flag,
                   decode(oa.sagetagcount, 0, 'none','yes') as sagetag_flag,
                   decode(oa.estcount, 0, 'none','yes') as est_flag,
                   decode(oa.snpcount, 0, 'none','yes') as snp_flag,
                   decode(oa.hasHTSIsolate, 0, 'none','yes') as hasHTSIsolate_flag,
                   decode(oa.proteomicscount, 0, 'none','yes') as proteomics_flag,
                   oa.is_annotated_genome
            FROM   apidbtuning.organismAttributes oa 
            ) a
          </sql>
      </sqlQuery>



        <sqlQuery name="IsPublished">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="is_published"/>
            <sql>
            <![CDATA[
               SELECT o.source_id, o.project_id,
                      CASE WHEN (p.dataset_presenter_id in
                             (SELECT dataset_presenter_id FROM apidbtuning.datasetpublication WHERE pmid IS NOT NULL ) )
                      THEN 1 ELSE 0 END AS is_published
               FROM APIDBTUNING.datasetnametaxon dt,
                    apidbtuning.organismattributes o,
                    apidb.datasource ds,
                    apidbtuning.datasetpresenter p
               WHERE o.component_taxon_id  = dt.taxon_id
                AND dt.name       = ds.name
                AND ds.type       = 'genome'
                AND dt.dataset_presenter_id = p.dataset_presenter_id
             ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="ReleasePolicy">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="release_policy"/>
            <sql>
            <![CDATA[
               SELECT o.source_id, o.project_id, p.release_policy
               FROM apidbtuning.datasetnametaxon dt,
                    apidbtuning.organismattributes o,
                    apidb.datasource ds,
                    apidbtuning.datasetpresenter p
               WHERE o.component_taxon_id  = dt.taxon_id
                AND dt.name       = ds.name
                AND ds.type       = 'genome'
                AND dt.dataset_presenter_id = p.dataset_presenter_id
             ]]>
           </sql>
        </sqlQuery>

    </querySet>
</wdkModel>
