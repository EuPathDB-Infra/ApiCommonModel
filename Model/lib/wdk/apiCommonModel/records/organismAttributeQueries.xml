<wdkModel>
    <querySet name="OrganismAttributes" queryType="attribute" isCacheable="false">


       <sqlQuery name="organismAttrs">
          <column name="project_id" ignoreCase="true"/>
          <column name="source_id" ignoreCase="true"/> 
          <column name="data_source" ignoreCase="true"/>
          <column name="database_version" ignoreCase="true"/>
          <column name="genus" ignoreCase="true"/>
          <column name="species" ignoreCase="true"/>
          <column name="strain" ignoreCase="true"/>
          <column name="megabps" ignoreCase="true"/>
          <column name="ncbi_tax_id" ignoreCase="true"/>
          <column name="genecount" ignoreCase="true"/>
          <column name="pseudogenecount" ignoreCase="true"/>
          <column name="codinggenecount" ignoreCase="true"/>
          <column name="othergenecount" ignoreCase="true"/>
          <column name="arraygenecount" ignoreCase="true"/>
          <column name="ecnumbercount" ignoreCase="true"/>
          <column name="sagetagcount" ignoreCase="true"/>
          <column name="rnaseqcount" ignoreCase="true"/>
          <column name="snpcount" ignoreCase="true"/>
          <column name="estcount" ignoreCase="true"/>
          <column name="chipchipgenecount" ignoreCase="true"/>
          <column name="rtpcrcount" ignoreCase="true"/>
          <column name="orthologcount" ignoreCase="true"/>
          <column name="tfbscount" ignoreCase="true"/>
          <column name="gocount" ignoreCase="true"/>
          <column name="proteomicscount" ignoreCase="true"/>
          <column name="communitycount" ignoreCase="true"/>
          <column name="organism_name" ignoreCase="true"/>
          <column name="isOrganellar_flag" ignoreCase="true"/>
          <column name="chipchipCSS"/>
          <column name="rnaseqCSS"/>
          <column name="sagetagCSS"/>
          <column name="estCSS"/>
          <column name="hasSNP_flag"/>
          <column name="hasIsolate_flag"/>
          <column name="hasHTSIsolate_flag"/>
          <column name="hasProteomics_flag"/> 
          <column name="rtpcrCSS"/> 
          <column name="orthologCSS"/> 
          <column name="communityCSS"/> 
          <column name="is_annotated_genome"/> 
          <sql>
            SELECT source_id,
                   project_id,
                   regexp_substr(oa.organism_name, '\w{1,}') as genus,
                   regexp_substr(oa.organism_name, '\s\w{1,}') as species,
                   organism_name,
                   oa.megabps,
                   genome_source as data_source,
                   decode(oa.ncbi_tax_id, 0, null, oa.ncbi_tax_id) as ncbi_tax_id,
                   database_version,
                   oa.strain_abbrev as strain,
                   decode(oa.genecount, 0, null, oa.genecount) as genecount, 
                   oa.pseudogenecount,
                   oa.codinggenecount,
                   oa.othergenecount,
                   decode(oa.arraygenecount, 0, null, oa.arraygenecount) as arraygenecount, 
                   oa.ecnumbercount,
                   oa.sagetagcount,
                   oa.rnaseqcount,
                   oa.snpcount,
                   oa.chipchipgenecount,
                   oa.rtpcrcount,
                   oa.estcount,
                   oa.orthologcount,
                   oa.gocount,
                   oa.tfbscount,
                   oa.proteomicscount,
                   oa.communitycount,
                   decode(oa.isOrganellar, 0, 'none','inline') as isOrganellar_flag,
                   decode(oa.chipchipgenecount, 0, 'none','inline') as chipchipCSS,
                   decode(oa.rnaseqcount, 0, 'none','inline') as rnaseqCSS,
                   decode(oa.sagetagcount, 0, 'none','inline') as sagetagCSS,
                   decode(oa.estcount, 0, 'none','inline') as estCSS,
                   decode(oa.hasSNP, 0, 'none','inline') as hasSNP_flag,
                   decode(oa.hasIsolate, 0, 'none','inline') as hasIsolate_flag,
                   decode(oa.hasHTSIsolate, 0, 'none','inline') as hasHTSIsolate_flag,
                   decode(oa.hasProteomics, 0, 'none','inline') as hasProteomics_flag,
                   decode(oa.rtpcrcount, 0, 'none','inline') as rtpcrCSS,
                   decode(oa.orthologcount, 0, 'none','inline') as orthologCSS,
                   decode(oa.communitycount, 0, 'none','inline') as communityCSS,
                   oa.is_annotated_genome
            FROM   apidbtuning.organismAttributes oa 
          </sql>
      </sqlQuery>



        <sqlQuery name="IsPublished">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="is_published"/>
            <sql>
            <![CDATA[
               SELECT o.source_id, o.project_id,
                      CASE WHEN (p.dataset_presenter_id in
                             (SELECT dataset_presenter_id FROM apidbtuning.datasetpublication WHERE pmid IS NOT NULL ) )
                      THEN 1 ELSE 0 END AS is_published
               FROM APIDBTUNING.datasetnametaxon dt,
                    apidbtuning.organismattributes o,
                    apidb.datasource ds,
                    apidbtuning.datasetpresenter p
               WHERE o.component_taxon_id  = dt.taxon_id
                AND dt.name       = ds.name
                AND ds.type       = 'genome'
                AND dt.dataset_presenter_id = p.dataset_presenter_id
             ]]>
           </sql>
        </sqlQuery>


        <sqlQuery name="ReleasePolicy">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="release_policy"/>
            <sql>
            <![CDATA[
               SELECT o.source_id, o.project_id, p.release_policy
               FROM apidbtuning.datasetnametaxon dt,
                    apidbtuning.organismattributes o,
                    apidb.datasource ds,
                    apidbtuning.datasetpresenter p
               WHERE o.component_taxon_id  = dt.taxon_id
                AND dt.name       = ds.name
                AND ds.type       = 'genome'
                AND dt.dataset_presenter_id = p.dataset_presenter_id
             ]]>
           </sql>
        </sqlQuery>

    </querySet>
</wdkModel>
