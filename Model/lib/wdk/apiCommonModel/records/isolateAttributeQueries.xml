<wdkModel>
    <querySet name="IsolateAttributes" queryType="attribute" includeProjects="CryptoDB,PlasmoDB,ToxoDB,EuPathDB,GiardiaDB">
    
      <defaultTestParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">FJ490884</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="CryptoDB">
         <paramValue name="source_id">AY168847</paramValue>
         <paramValue name="project_id">CryptoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="ToxoDB">
         <paramValue name="source_id">EF639858</paramValue>
         <paramValue name="project_id">ToxoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="GiardiaDB,EuPathDB">
         <paramValue name="source_id">AF176672</paramValue>
         <paramValue name="project_id">GiardiaDB</paramValue>
      </defaultTestParamValues>

      <testRowCountSql excludeProjects="EuPathDB">
           select count(*) from dots.isolatesource
      </testRowCountSql>

       <testRowCountSql includeProjects="EuPathDB">
	 SELECT count(*) FROM apidb.IsolateAttributes
       </testRowCountSql>

       <sqlQuery name="Attributes">
            <column name="project_id"/>
            <column name="source_id"/> 
            <column name="organism" /> 
            <column name="strain" /> 
            <column name="specific_host" /> 
            <column name="description"/> 
            <column name="isolation_source" /> 
            <column name="pcr_primers"/> 
            <column name="country"/> 
            <column name="data_type"/> 
            <column name="note"/> 
            <column name="product"/> 
            <column name="collected_by"/> 
            <column name="is_reference"/> 
            <column name="length"/> 
            <column name="external_db_name"/> 
            <column name="external_db_version"/> 
            <sql>
               SELECT iso.source_id, 
                      iso.project_id, 
                      iso.organism,
                      iso.strain,
                      iso.specific_host,
                      iso.isolation_source,
                      iso.description,
                      iso.pcr_primers,
                      iso.country,
                      iso.note,
                      iso.collected_by,
                      iso.product,
                      iso.length, 
                      decode(iso.is_reference, 0, 'No', 1, 'Yes', 'No') is_reference,
                      iso.data_type,
                      iso.external_db_name,
                      iso.external_db_version
                FROM   ApiDB.IsolateAttributes iso
           </sql>
      </sqlQuery>

        <sqlQuery name="LinkOut">
            <column name="source_id" />
            <column name="project_id" />
            <column name="linkout" />
            <sql>
            <![CDATA[
            SELECT source_id, '@PROJECT_ID@' as project_id,
            CASE 
             WHEN data_type='Sequencing Typed' THEN 
               '<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?db=nuccore&' || 'id=' || source_id || '" target=_blank>NCBI</a>'
             ELSE ''
            END as linkout
            FROM   ApiDB.IsolateAttributes
            ]]>
            </sql>
        </sqlQuery>

      <sqlQuery name="ProteinSequenceCount" includeProjects="CryptoDB,PlasmoDB,ToxoDB,EuPathDB,GiardiaDB">
            <column name="project_id"/>
            <column name="source_id"/> 
            <column name="protein_sequence_count"/>
            <sql>
            select a.source_id, a.project_id, count(*) as protein_sequence_count
            from (SELECT i.source_id, '@PROJECT_ID@' as project_id
                  From (select etn.source_id, tas.sequence as protein_sequence
                        FROM   DoTS.TranslatedAAFeature taf, DoTS.Transcript trp, 
                               DoTS.TranslatedAASequence tas, DoTS.IsolateFeature gf,
                               DOTS.NALocation l, DoTS.ExternalNASequence etn
                        WHERE trp.na_feature_id = taf.na_feature_id
                        AND tas.aa_sequence_id = taf.aa_sequence_id
                        AND trp.parent_id = gf.na_feature_id
                        AND etn.na_sequence_id = gf.na_sequence_id
                        AND l.na_feature_id = gf.na_feature_id
                        ) p right join apidb.isolateattributes i
                        on i.source_id = p.source_id
                  ) a
            group by a.source_id, a.project_id
           </sql>
      </sqlQuery>


      <sqlQuery name="NucleicAcidSequence" includeProjects="CryptoDB,EuPathDB,ToxoDB,PlasmoDB,GiardiaDB">
            <column name="project_id"/>
            <column name="source_id"/> 
            <column name="sequence"/>
            <sql>
           select i.source_id, '@PROJECT_ID@' as project_id,
                  s.sequence
           from apidb.isolateattributes i, apidb.isolatesequence s
            where i.source_id = s.source_id
           </sql>
      </sqlQuery>

    </querySet>
</wdkModel>
