<wdkModel>


    <querySet name="DynSpanAttributes" queryType="attribute">


        <sqlQuery name="Bfmv">
            <column name="source_id" ignoreCase="true"/>
            <column name="project_id" ignoreCase="true"/>
            <column name="seq_source_id"/>
            <column name="start_min"/>
            <column name="end_max"/>
            <column name="strand"/>
            <column name="length"/>
            <column name="organism"/>
            <!-- the source_id is in such form: MAL14:1271-984493:(+|-) -->
           <sql>
            <![CDATA[
                SELECT ids.source_id, ids.project_id, ids.seq_source_id, 
                       ids.start_min, ids.end_max, ids.strand,
                       (ids.end_max - ids.start_min + 1) AS length,
                       sa.organism
                FROM (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 2) as end_max,
                             regexp_substr(source_id, '[^:]+', 1, 3) as strand
                      FROM ##WDK_ID_SQL##) ids, 
                     apidb.SequenceAttributes sa
                WHERE ids.seq_source_id = sa.source_id
             ]]>
           </sql>
        </sqlQuery>


        <!--
         <sqlQuery name="Organism">
            <column name="source_id" ignoreCase="true"/>
            <column name="project_id" ignoreCase="true"/>
            <column name="organism" ignoreCase="true"/>  

           <sql>
            <![CDATA[
                SELECT 'Pf3D7_05:10-100' as source_id, 
                       'PlasmoDB' as project_id, 
                       'Plasmodium falciparum' as organism 
                FROM dual

             ]]>
           </sql>
        </sqlQuery>
        -->
        


<!--
                SELECT bfmv.source_id, bfmv.project_id, bfmv.length, bfmv.organism
                  FROM apidb.SequenceAttributes bfmv
                WHERE bfmv.source_id = regexp_substr('Pf3D7_05:10-100', '[^:]+', 1, 1)
-->

 <sqlQuery name="GeneCount">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="gene_count"/>
            <sql>
            <![CDATA[
           select sa.source_id, sa.project_id, nvl(the_count, 0) as gene_count
           from apidb.sequenceAttributes sa,
             (select sa.source_id, sa.project_id, count(*) as the_count
              from apidb.sequenceAttributes sa, apidb.geneAttributes ga
              where ga.sequence_id = sa.source_id
              group by sa.source_id, sa.project_id) gc
           where sa.source_id = gc.source_id(+)
             ]]>
           </sql>
        </sqlQuery>



  </querySet>


</wdkModel>
