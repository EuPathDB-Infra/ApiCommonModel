<wdkModel>


    <querySet name="DynSpanAttributes" queryType="attribute">


        <sqlQuery name="Bfmv">
            <column name="source_id" ignoreCase="true"/>
            <column name="project_id" ignoreCase="true"/>
            <column name="seq_source_id"/>
            <column name="start_min"/>
            <column name="end_max"/>
            <column name="strand"/>
            <column name="length"/>
            <column name="organism"/>
            <!-- the source_id is in such form: MAL14:1271-984493:0 for poditive strand or 1 for negative strand -->
           <sql>
            <![CDATA[
                SELECT ids.source_id, ids.project_id, ids.seq_source_id, 
                       ids.start_min, ids.end_max, ids.strand,
                       (ids.end_max - ids.start_min + 1) AS length,
                       sa.organism
                FROM (SELECT source_id, project_id,
                             regexp_substr(source_id, '[^:]+', 1, 1) as seq_source_id,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,1) as start_min,
                             regexp_substr(regexp_substr(source_id, '[^:]+', 1, 2), '[^\-]+', 1,2) as end_max,
                             case when regexp_substr(source_id, '[^:]+', 1, 3) = '0' then '+'
   				       when regexp_substr(source_id, '[^:]+', 1, 3) = '1' then '-'
   				       else 'Unknown' end as strand
                      FROM (##WDK_ID_SQL##)) ids, 
                     apidb.SequenceAttributes sa
                WHERE ids.seq_source_id = sa.source_id
             ]]>
           </sql>
        </sqlQuery>



  </querySet>


</wdkModel>
