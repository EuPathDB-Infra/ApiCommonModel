<wdkModel>

  <querySet name="PathwayTables" queryType="table">

      <defaultTestParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">Pf3D7_08_v3-5-1196699-1193850</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

      <sqlQuery name="CompoundsFromMetabolicPathways" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="compound"/>
            <column name="enzyme"/>
            <column name="reaction"/>
            <column name="name"/>
            <column name="pathway"/>
            <column name="source"/>
            <sql>
            <![CDATA[
select case when nn1.node_type_id = 2 then nn1.display_label
            when nn2.node_type_id = 2 then nn2.display_label
            else 'None' end as compound,
       case when nn1.node_type_id = 1 then nn1.display_label
            when nn2.node_type_id = 1 then nn2.display_label
            else 'None' end as enzyme,
       nrt.display_name as reaction,'@PROJECT_ID@' as project_id, nc.description as source,
       n.description ||' ('||n.name||')' as pathway, n.name as name, n.name as source_id
from   apidb.networkrelationship nr, apidb.networkrelationshiptype nrt, ApiDB.NetworkRelContext nrc,
       apidb.Network n, ApiDB.NetworkRelContextLink nrl, apidb.networknode nn1 ,apidb.networknode nn2,
       ApiDB.NetworkContext nc
Where  nr.node_id = nn1.network_node_id
and    nr.associated_node_id = nn2.network_node_id
and    nrc.network_relationship_id = nr.network_relationship_id
and    nrt.network_relationship_type_id = nrc.network_relationship_type_id
and    nrl.network_rel_context_id = nrc.network_rel_context_id
and    nrl.network_id = n.network_id
and    nrc.network_context_id = nc.network_context_id
            ]]>
           </sql>
        </sqlQuery>



      <sqlQuery name="ECNumberOrganismMap" includeProjects="PlasmoDB">
            <column name="source_id"/>
            <column name="project_id"/>
            <column name="ec_number"/>
            <column name="x1"/>
            <column name="y1"/>
            <column name="x2"/>
            <column name="y2"/>
            <column name="organisms"/>
            <column name="genes"/>

            <sql>
            <![CDATA[
               SELECT DISTINCT p.source_id as source_id, '@PROJECT_ID@' as project_id, ec.ec_number,
                       (pn.x - (pn.width/2)) as x1, (pn.y - (pn.height/2)) as y1,
                       (pn.x + (pn.width/2)) as x2, (pn.y + (pn.height/2)) as y2,
                       apidb.tab_to_string(set(cast(COLLECT(ga.organism) AS apidb.varchartab)), ', ') as organisms,
                       apidb.tab_to_string(set(cast(COLLECT(ga.source_id) AS apidb.varchartab)), ', ') as genes
                FROM    ApidbTuning.GenomicSequence gs,
                       dots.Transcript t, dots.translatedAaFeature taf,apidb.pathway p, apidb.pathwaynode pn,
                       dots.aaSequenceEnzymeClass asec, sres.enzymeClass ec,ApidbTuning.GeneAttributes ga
                WHERE  gs.na_sequence_id = ga.na_sequence_id
                AND    ga.na_feature_id = t.parent_id
                AND    t.na_feature_id = taf.na_feature_id
                AND    taf.aa_sequence_id = asec.aa_sequence_id
                AND    asec.enzyme_class_id = ec.enzyme_class_id
                AND    p.pathway_id = pn.parent_id
                AND    ec.ec_number = pn.display_label
                group by p.source_id, ec.ec_number, pn.x, pn.y,pn.width, pn.height
            ]]>
           </sql>
        </sqlQuery>


 </querySet>
</wdkModel>



