<wdkModel>
  <querySet name="CompoundTables" queryType="table"  includeProjects="PlasmoDB,EuPathDB">

    <sqlQuery name="Properties">
            <column name="project_id"/>
            <column name="source_id"  />
            <column name="property"  />
            <column name="type"  />
            <column name="value"  />
           <sql>
            <![CDATA[
	       SELECT '@PROJECT_ID@' AS project_id, compound_id as source_id, property, 
	              CASE WHEN type IS NULL THEN '' ELSE type END AS type,
		      CASE WHEN property ='Molecular Formula'
		           THEN REGEXP_REPLACE(value,'(\d)','<sub>\1</sub>')
			   ELSE value END AS value
	       FROM apidb.PubChemCompound
	       ORDER BY property
            ]]>
            </sql>
    </sqlQuery>



    <sqlQuery name="SubstanceProps">
            <column name="project_id"/>
            <column name="source_id"  />
            <column name="substance_id"  />
            <column name="property"  />
            <column name="value"  />
           <sql>
            <![CDATA[
	      SELECT '@PROJECT_ID@' as project_id, s1.value as source_id,
	              s2.property, s1.substance_id,
		      CASE WHEN (s2.property='KEGG') 
		      THEN '<a href="http://www.genome.jp/dbget-bin/www_bget?cpd:' || s2.value || '">' || s2.value || '</a>'
		      ELSE  s2.value END AS value
	      FROM APIDB.pubchemsubstance s1, APIDB.pubchemsubstance s2
	      WHERE s1.property = 'CID'
	      AND s1.substance_id = s2.substance_id
	      AND NOT s2.property = 'CID'
	      ORDER BY s1.substance_id, s2.property
        ]]>
           </sql>
    </sqlQuery>



    <sqlQuery name="CompoundsFromMetabolicPathways">
      <column name="source_id"  />
      <column name="project_id"/>
      <column name="compound"/>
      <column name="enzyme"/>
      <column name="reaction"/>
      <column name="name"/>
      <column name="pathway"/>
      <column name="source"/>
      <column name="gene_id"/>
      <sql>
       SELECT ga.source_id  as gene_id, compound, enzyme, reaction, pathway, source, 
	      pc.name, pubchem_compound_id AS source_id, '@PROJECT_ID@' AS project_id
         FROM dots.Transcript t, dots.translatedAaFeature taf, sres.enzymeClass ec, 
              dots.aaSequenceEnzymeClass asec, ApidbTuning.GeneAttributes ga,
              apidbtuning.PathwayCompounds pc
        WHERE ga.na_feature_id = t.parent_id
          AND t.na_feature_id = taf.na_feature_id
          AND taf.aa_sequence_id = asec.aa_sequence_id
          AND asec.enzyme_class_id = ec.enzyme_class_id
          AND pc.enzyme = ec.ec_number
       ORDER BY ga.source_id, pathway
	    </sql>
        </sqlQuery>

    <sqlQuery name="RelatedCompounds">
      <column name="source_id"  />
      <column name="project_id"/>
      <column name="subst_id"/>
      <column name="type"/>
      <column name="related_id"/>
      <sql>
	SELECT s1.value as source_id, '@PROJECT_ID@' AS project_id,
                        s1.substance_id as subst_id, s2.type, s2.value as related_id
	  FROM  APIDB.pubchemsubstance s1,  APIDB.pubchemsubstance s2
	 WHERE s1.substance_id = s2.substance_id
	   AND s1.property='CID' 
	   AND s1.type = 'standardized'
	   AND s2.property='CID'
	   AND not s1.value = s2.value
	    </sql>
        </sqlQuery>

    </querySet>
</wdkModel>
