<wdkModel>
  <querySet name="CompoundTables" queryType="table"  includeProjects="PlasmoDB">

        <sqlQuery name="Properties">
            <column name="project_id"/>
            <column name="source_id"  />
            <column name="property"  />
            <column name="type"  />
            <column name="value"  />
           <sql>
            <![CDATA[
	       SELECT '@PROJECT_ID@' AS project_id, compound_id as source_id, property, 
	              CASE WHEN type IS NULL THEN '' ELSE type END AS type,
		      CASE WHEN property ='Molecular Formula'
		           THEN REGEXP_REPLACE(value,'(\d)','<sub>\1</sub>')
			   ELSE value END AS value
	       FROM apidb.PubChemCompound
	       ORDER BY property
            ]]>
            </sql>
        </sqlQuery>



        <sqlQuery name="SubstanceProps">
            <column name="project_id"/>
            <column name="source_id"  />
            <column name="property"  />
            <column name="value"  />
           <sql>
            <![CDATA[
	      SELECT '@PROJECT_ID@' as project_id, s1.value as source_id,
	              s2.property, 
		      CASE WHEN (s2.property='KEGG') 
		      THEN '<a href="http://www.genome.jp/dbget-bin/www_bget?cpd:' || s2.value || '">' || s2.value || '</a>'
		      ELSE  s2.value END AS value
	      FROM APIDB.pubchemsubstance s1, APIDB.pubchemsubstance s2
	      WHERE s1.property = 'CID'
	      AND s1.substance_id = s2.substance_id
	      AND NOT s2.property = 'CID'
	      ORDER BY s2.property
        ]]>
           </sql>
        </sqlQuery>



      <sqlQuery name="CompoundsFromMetabolicPathways">
            <column name="source_id"  />
            <column name="project_id"/>
            <column name="compound"/>
            <column name="enzyme"/>
            <column name="reaction"/>
            <column name="name"/>
            <column name="pathway"/>
            <column name="source"/>
            <column name="gene_id"/>
            <sql>
SELECT CASE WHEN nn1.node_type_id = 2 THEN nn1.display_label
            WHEN nn2.node_type_id = 2 THEN nn2.display_label 
            ELSE 'None' end as compound,
       CASE WHEN nn1.node_type_id = 1 THEN nn1.display_label
            WHEN nn2.node_type_id = 1 THEN nn2.display_label 
            ELSE 'None' end as enzyme,
       nrt.display_name AS reaction, nc.description AS source, s1.value  as source_id, 
       ga.source_id AS gene_id, n.description ||' ('||n.name||')' AS pathway, n.name AS name,
       '@PROJECT_ID@' AS project_id
FROM   apidb.networkrelationship nr, apidb.networkrelationshiptype nrt, ApiDB.NetworkRelContext nrc,
       apidb.Network n, ApiDB.NetworkRelContextLink nrl, apidb.networknode nn1 ,apidb.networknode nn2,
       dots.Transcript t, dots.translatedAaFeature taf, sres.enzymeClass ec,ApiDB.NetworkContext nc,
       dots.aaSequenceEnzymeClass asec, ApidbTuning.GeneAttributes ga,
       APIDB.pubchemsubstance s1, APIDB.pubchemsubstance s2
WHERE  nr.node_id = nn1.network_node_id
AND    nr.associated_node_id = nn2.network_node_id
AND    nrc.network_relationship_id = nr.network_relationship_id
AND    nrt.network_relationship_type_id = nrc.network_relationship_type_id
AND    nrl.network_rel_context_id = nrc.network_rel_context_id
AND    nrl.network_id = n.network_id
AND    nrc.network_context_id = nc.network_context_id
AND    ga.na_feature_id = t.parent_id
AND    t.na_feature_id = taf.na_feature_id
AND    taf.aa_sequence_id = asec.aa_sequence_id
AND    asec.enzyme_class_id = ec.enzyme_class_id
AND    (nn1.display_label = ec.ec_number OR nn2.display_label = ec.ec_number)
AND    s1.property = 'CID'
AND    s1.substance_id = s2.substance_id
AND    s2.property ='KEGG' 
AND    (s2.value = nn1.display_label OR s2.value = nn2.display_label)
	    </sql>
        </sqlQuery>


    </querySet>
</wdkModel>
