<wdkModel>

  <!-- notes

    why does bfmv have 3D7 Allele in toxo (old model has this)

  -->

    <recordClassSet name="SnpRecordClasses" includeProjects="ToxoDB,PlasmoDB,EuPathDB,CryptoDB,AmoebaDB,TriTrypDB">

        <recordClass name="SnpRecordClass" displayName="SNP">


      <testParamValues includeProjects="PlasmoDB,EuPathDB">
         <paramValue name="source_id">CombinedSNP.MAL11.5220</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="ToxoDB">
         <paramValue name="source_id">SNP_TGME49_chrVI_485196</paramValue>
         <paramValue name="project_id">ToxoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="CryptoDB">
         <paramValue name="source_id">chr3-2_66329</paramValue>
         <paramValue name="project_id">CryptoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="TriTrypDB">
         <paramValue name="source_id">NGS_SNP.Tb927_01_v4.36382</paramValue>
         <paramValue name="project_id">TriTrypDB</paramValue>
      </testParamValues>

            <!-- primary key definition -->
            <primaryKeyAttribute name="primary_key"
                                 displayName="SNP Id">
                <columnRef>source_id</columnRef>
                <columnRef>project_id</columnRef>
                <text>
                    <![CDATA[
                    $$source_id$$
                    ]]>
                </text>                
            </primaryKeyAttribute>

      <!-- =============================================================== -->
      <!--  Default summary attributes and sorting attributes -->  
      <!-- =============================================================== -->
      <attributesList excludeProjects="EuPathDB"
             summary="snp_location,gene_source_id,major_allele, minor_allele,major_allele_frequency, minor_allele_frequency"
              />

      <attributesList includeProjects="EuPathDB"
             summary="organism_text, snp_location,gene_source_id,major_allele, minor_allele,major_allele_frequency, minor_allele_frequency"
              sorting="organism_text asc,snp_location asc" /> 

          <!-- =============================================================== -->
          <!--   Reporters -->  
          <!-- =============================================================== -->

          <reporter name="tabular" displayName="Tab delimited (Excel): choose from columns"
                      implementation="org.gusdb.wdk.model.report.TabularReporter" />
          <reporter name="fullRecord" displayName="Text: choose from columns and/or tables" excludeProjects="EuPathDB" 
                      implementation="org.gusdb.wdk.model.report.FullRecordReporter" />
           <reporter name="xml" displayName="XML: choose from columns and/or tables"  excludeProjects="EuPathDB" 
                    implementation="org.gusdb.wdk.model.report.XMLReporter" />
          <reporter name="json" displayName="json: choose from columns and/or tables"  excludeProjects="EuPathDB" 
                    implementation="org.gusdb.wdk.model.report.JSONReporter" />

        
      <!-- =============================================================== -->
      <!--   Filters -->
      <!-- =============================================================== -->


      <answerFilterLayout name="eupath_project" visible="true"
                             fileName="eupath_project_filter.jsp" 
                            displayName="Filter results by component website" includeProjects="EuPathDB">
            <instanceRef ref="all_results" />
            <instanceRef ref="crypto_snps" />
            <instanceRef ref="giardia_snps" />
            <instanceRef ref="plasmo_snps" />
            <instanceRef ref="toxo_snps" />
            <instanceRef ref="trich_snps" />
            <instanceRef ref="tritryp_snps" />
            <instanceRef ref="amoeba_snps" />
            <instanceRef ref="micro_snps" />
      </answerFilterLayout>



      <answerFilter queryRef="SnpTables.AllResults"   includeProjects="EuPathDB">
                  <instance name="all_results" displayName="All Results" default="true">
                    <description>
                        <![CDATA[
                            All results
                        ]]>
                    </description>
                </instance>

      </answerFilter>

      <answerFilter queryRef="SnpTables.ApiProjectSnps"
                          includeProjects="EuPathDB">

               <instance name="crypto_snps" displayName="CryptoDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in CryptoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">CryptoDB</paramValue>
                </instance>
               <instance name="giardia_snps" displayName="GiardiaDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in GiardiaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">GiardiaDB</paramValue>
                </instance>
               <instance name="plasmo_snps" displayName="PlasmoDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in PlasmoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">PlasmoDB</paramValue>
                </instance>
               <instance name="toxo_snps" displayName="ToxoDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in ToxoDB.
                        ]]>
                    </description>
                    <paramValue name="Project">ToxoDB</paramValue>
                </instance>
               <instance name="trich_snps" displayName="TrichDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in TrichDB.
                        ]]>
                    </description>
                    <paramValue name="Project">TrichDB</paramValue>
                </instance>
               <instance name="tritryp_snps" displayName="TriTrypDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in TriTrypDB.
                        ]]>
                    </description>
                    <paramValue name="Project">TriTrypDB</paramValue>
                </instance>
               <instance name="amoeba_snps" displayName="AmoebaDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in AmoebaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">AmoebaDB</paramValue>
                </instance>
               <instance name="micro_snps" displayName="MicrosporidiaDB" >
                    <description>
                        <![CDATA[
                            Number of SNPs in MicrosporidiaDB.
                        ]]>
                    </description>
                    <paramValue name="Project">MicrosporidiaDB</paramValue>
                </instance>
      </answerFilter>


           <!-- =================================================================== -->
           <!--  Attributes  ++++++++-->
           <!-- =================================================================== -->

              <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
              <!-- BFMV attributes -->  
              <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->


            <attributeQueryRef ref="SnpAttributes.PrimaryKey">
              <columnAttribute name="project_id" internal="true" inReportMaker="false" sortable="false"/>
              <columnAttribute name="source_id" internal="true" inReportMaker="false" sortable="false"/>
            </attributeQueryRef>

            <attributeQueryRef ref="SnpAttributes.Bfmv">

              <columnAttribute displayName="Type" name="type" internal="true" inReportMaker="false" sortable="false"/>

              <columnAttribute displayName="Dataset" name="dataset"
                               internal="true" inReportMaker="false" sortable="false"/>

              <columnAttribute displayName="Chromosome" name="seq_source_id" internal="true" inReportMaker="false" sortable="false"/>
              <columnAttribute displayName="start_min_text" name="start_min_text" internal="true" sortable="false"/>
              <textAttribute name="snp_location" displayName="Location" sortable="false" >
                <text>
                  <![CDATA[
                  $$seq_source_id$$: $$start_min_text$$ 
                  ]]>
                </text>
              </textAttribute>
              <columnAttribute displayName="Chromosome" name="chromosome_order_num" internal="true" sortable="false"/>
              <columnAttribute displayName="Position" name="start_min" internal="true" sortable="false"/>
              <columnAttribute displayName="Reference Strain" name="reference_strain" internal="true" inReportMaker="false" sortable="false"/>
              <columnAttribute displayName="Reference NA" name="reference_na" internal="true" inReportMaker="false" sortable="false"/>
              <columnAttribute displayName="Reference AA" name="reference_aa" internal="true" inReportMaker="false" sortable="false"/>
              <columnAttribute displayName="Left Flank" name="lflank" excludeProjects="EuPathDB" sortable="false"/>
              <columnAttribute displayName="Reference Allele" name="allele" align="center"  excludeProjects="EuPathDB" sortable="false"/>
              <columnAttribute displayName="Right Flank" name="rflank"  excludeProjects="EuPathDB" sortable="false"/>
              <columnAttribute inReportMaker="true" displayName="Gene ID"
                               name="gene_source_id" internal="true" sortable="false"/>
               <linkAttribute inReportMaker="false" displayName="Gene ID"
                              name="linkedGeneId" sortable="false" >
                 <displayText>
                    <![CDATA[ $$gene_source_id$$ ]]>
                 </displayText>
                 <url>
                    <![CDATA[
                       showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=@PROJECT_ID@&primary_key=$$gene_source_id$$
                        ]]>
                 </url>
              </linkAttribute>
              <columnAttribute displayName="Gene strand" name="gene_strand" sortable="false"/>
              <columnAttribute displayName="Coding" name="is_coding" align="center" sortable="false"/>
              <columnAttribute displayName="Position in CDS" name="position_in_CDS" align="center" sortable="false"/>
              <columnAttribute displayName="Position in protein" name="position_in_protein" align="center" sortable="false"/>
              <columnAttribute displayName="Non-synonymous" name="has_nonsynonymous_allele" align="center" sortable="false"/>
              <columnAttribute displayName="Left Flank (gene strand)" name="lflank_gene_strand" sortable="false"/>
              <columnAttribute displayName="Reference Allele (gene strand)" name="allele_gene_strand" align="center" sortable="false"/>
              <columnAttribute displayName="Right Flank (gene strand)" name="rflank_gene_strand" sortable="false"/>
              <columnAttribute displayName="Major Allele Frequency" name="major_allele_frequency" align="center" sortable="false"/>
              <columnAttribute displayName="Minor Allele Frequency" name="minor_allele_frequency" align="center" sortable="false"/>
              <columnAttribute displayName="Strain Count" name="strain_count" align="center" sortable="false"/>
              <columnAttribute displayName="Major Allele" name="major_allele" align="center" sortable="false"/>
              <columnAttribute displayName="Minor Allele" name="minor_allele" align="center" sortable="false"/>
              <columnAttribute displayName="Major Product" name="major_product" align="center" sortable="false"/>
              <columnAttribute displayName="Minor Product" name="minor_product" align="center" sortable="false"/>
              <columnAttribute displayName="Major Strains" name="major_strains" sortable="false"/>
              <columnAttribute displayName="Minor Strains" name="minor_strains" sortable="false"/>
              <columnAttribute displayName="Organism" name="organism_text" internal="true" inReportMaker="true" sortable="false"/>
              <columnAttribute displayName="Organism" name="formatted_organism" inReportMaker="false" internal="false" sortable="false"/>
              <columnAttribute displayName="NCBI Taxon ID" name="ncbi_tax_id" internal="true" inReportMaker="false" sortable="false"/>
            </attributeQueryRef>

          <textAttribute name="organism" displayName="Organism" internal="true" inReportMaker="true" help="The biological sample used to sequence this genome" sortable="false" >
                <display><![CDATA[ <i>$$organism_text$$</i>  ]]></display>
                <text><![CDATA[ $$organism_text$$  ]]></text>
            </textAttribute>

      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Isolate summary attributes -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

<!--
      <attributeQueryRef ref="SnpAttributes.isolateSummary" includeProjects="PlasmoDB">
         <columnAttribute name="iso_major_allele" displayName="Isolate Major Allele" internal="true"/>
         <columnAttribute name="iso_major_percent" displayName="Isolate Major Allele Percent" internal="true"/>
         <columnAttribute name="iso_minor_allele" displayName="Isolate Minor Allele" internal="true"/>
         <columnAttribute name="iso_minor_percent" displayName="Isolate Minor Allele Percent" internal="true"/>
         <columnAttribute name="iso_number_strains" displayName="Number of Genotyped Isolates" internal="true"/>
      </attributeQueryRef>

-->
          <!-- =================================================================== -->
          <!--  Text Attributes  ++++++++-->
          <!-- =================================================================== -->


            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
            <!-- overview -->  
            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
         <textAttribute name="snp_overview" displayName="SNP Genomic Overview" inReportMaker="false" internal="true"
                        truncateTo="4000">
               <text>
                    <![CDATA[
                    <table>
                    <tr><td width="220"><b>Location:</b></td><td>$$seq_source_id$$: $$start_min_text$$</td></tr>
                    <tr><td width="220"><b>Reference:</b></td><td>Strain: $$reference_strain$$, Allele: $$reference_na$$ </td></tr>
                    <tr><td width="220"><b>Strain Count:</b></td><td>$$strain_count$$</td></tr>
                    <tr><td width="220"><b>Major Allele:</b></td><td>$$major_allele$$ ($$major_allele_frequency$$), Product: $$major_product$$ </td></tr>
                    <tr><td width="220"><b>Minor Allele:</b></td><td>$$minor_allele$$ ($$minor_allele_frequency$$), Product: $$minor_product$$ </td></tr>
		    <tr><td width="220"><b>Left Flank:</b></td><td><font class="fixed">$$lflank$$</font></td></tr>
		    <tr><td width="220"><b>Right Flank:</b></td><td><font class="fixed">$$rflank$$</font></td></tr>
                    <tr><td width="220"><b>Dataset:</b></td><td>$$dataset$$</td></tr>
                    </table>
                ]]>
               </text>
           </textAttribute>

            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
            <!-- gene context -->  
            <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
           <textAttribute name="gene_context" displayName="Gene Context" inReportMaker="false"
                          truncateTo="4000" >
               <text>
                    <![CDATA[
                    <table>
                    <tr><td width="220"><b>Gene ID:</b></td><td><a href="showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=@PROJECT_ID@&primary_key=$$gene_source_id$$">$$gene_source_id$$</a></td></tr>
                    <tr><td width="220"><b>Gene Strand:</b></td><td>$$gene_strand$$</td></tr>
                    <tr><td width="220"><b>Coding?:</b></td><td>$$is_coding$$</td></tr>
                    <tr><td width="220"><b>Position in CDS:</b></td><td>$$position_in_CDS$$</td></tr>
                    <tr><td width="220"><b>Position in Protein:</b></td><td>$$position_in_protein$$</td></tr>
		    <tr><td width="220"><b>Left Flank (Gene Strand):</b></td><td><font class="fixed">$$lflank_gene_strand$$</font></td></tr>
		    <tr><td width="220"><b>$$reference_strain$$ Allele (Gene Strand):</b></td><td> <font class="fixed">$$allele_gene_strand$$</font></td></tr>
		    <tr><td width="220"><b>Right Flank (Gene Strand):</b></td><td><font class="fixed">$$rflank_gene_strand$$</font></td></tr>
                    </table>
                ]]>
               </text>
           </textAttribute>

       <!-- =================================================================== -->
       <!-- Tables ++++++++-->
       <!-- =================================================================== -->

          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
          <!-- sequencing strains table -->  
          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

          <table name="Strains" excludeProjects="TriTrypDB,AmoebaDB,TrichDB,GiardiaDB,EuPathDB" 
                 displayName="Strains (Sequence Typed Isolates)"
                 queryRef="SnpTables.Strains">
              <columnAttribute displayName="Strain" name="strain"/>
              <columnAttribute displayName="Type" name="phenotype"/>
              <columnAttribute displayName="Allele" name="allele" align="center"/>
              <columnAttribute displayName="Allele (gene strand)" name="allele_gene_strand" align="center"/>
              <columnAttribute displayName="Product" name="product" align="center"/>
          </table>

          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
          <!-- hts strains table -->  
          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

          <table name="HTSStrains" excludeProjects="TrichDB,GiardiaDB,EuPathDB" 
                 displayName="Strains"
                 queryRef="SnpTables.HTSStrainsTable">
              <linkAttribute inReportMaker="false" displayName="" name="snpcheckbox">
                 <displayText>
                    <![CDATA[ <input type="checkbox" name="selectedFields" value="$$strain$$"> ]]>
                 </displayText>
                 <url>
                    <![CDATA[ javascript:void(0) ]]>
                 </url>
              </linkAttribute>

              <columnAttribute inReportMaker="false" name="isolate_source_id" internal="true" includeProjects="PlasmoDB,CryptoDB,ToxoDB,AmoebaDB,TriTrypDB"/>
              <columnAttribute displayName="Strain" name="strain"  internal="true" includeProjects="PlasmoDB,CryptoDB,ToxoDB,AmoebaDB,TriTrypDB"/>
              <columnAttribute displayName="Haplogroup" name="haplogroup"  includeProjects="ToxoDB"/>

              <linkAttribute inReportMaker="false" displayName="Strain" includeProjects="PlasmoDB,CryptoDB,ToxoDB,AmoebaDB,TriTrypDB"
                             name="isolate_link">
                 <displayText>
                    <![CDATA[ $$strain$$ ]]>
                 </displayText>
                 <url>
                    <![CDATA[
                       showRecord.do?name=IsolateRecordClasses.IsolateRecordClass&project_id=@PROJECT_ID@&primary_key=$$isolate_source_id$$
                        ]]>
                 </url>
              </linkAttribute>


              <columnAttribute displayName="Type" name="phenotype"/>
              <columnAttribute displayName="Allele" name="allele" align="center"/>
              <columnAttribute displayName="Allele (gene strand)" name="allele_gene_strand" align="center"/>
              <columnAttribute displayName="Product" name="product" align="center"/>
              <columnAttribute displayName="HTS Coverage" name="coverage" align="center"/>
              <columnAttribute displayName="HTS P Value" name="pvalue" align="center"/>
              <columnAttribute displayName="HTS Allele Percent" name="allele_percent" align="center"/>
              <columnAttribute inReportMaker="false" name="view_align" internal="true"/>
              <columnAttribute inReportMaker="false" name="has_align" internal="true"/>
              <linkAttribute inReportMaker="false" displayName="HTS View Alignment"
                             name="view_gbrowse_link">
                 <displayText>
                    <![CDATA[ $$has_align$$ ]]>
                 </displayText>
                 <url>
                    <![CDATA[
                     /cgi-bin/gbrowse/$$view_align$$
                        ]]>
                 </url>
              </linkAttribute>
          </table>

          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
          <!-- isolates table -->  
          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

          <table name="Isolates" includeProjects="PlasmoDB" 
                 displayName="Strains (Isolate Chip Assays)"
                 queryRef="SnpTables.isolates">
              <columnAttribute name="isolate_id" internal="true" displayName="Isolate ID"/>
              <linkAttribute inReportMaker="false" displayName="Isolate ID"
                             name="linkedIsolteSourceId">
                 <displayText>
                    <![CDATA[ $$isolate_id$$ ]]>
                 </displayText>
                 <url>
                    <![CDATA[
                       showRecord.do?name=IsolateRecordClasses.IsolateRecordClass&project_id=@PROJECT_ID@&primary_key=$$isolate_id$$
                        ]]>
                 </url>
              </linkAttribute>
              <columnAttribute displayName="Assay Type" name="assay_type"/>
              <columnAttribute displayName="Country" name="country"/>
              <columnAttribute displayName="Strain" name="strain"/>
              <columnAttribute displayName="Allele" name="allele" align="center"/>
          </table>

          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
          <!-- isolate allele freq table -->  
          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

          <table name="IsolatesAlleleFrequency" includeProjects="PlasmoDB" 
                 displayName="Allele Frequency (Isolate Chip Assays)"
                 queryRef="SnpTables.isolatesAlleleFrequency">
              <columnAttribute name="allele" displayName="Allele"/>
              <columnAttribute name="frequency" displayName="Frequency"/>
          </table>

          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
          <!--  Providers table -->  
          <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

          <table name="Providers_other_SNPs" excludeProjects="TrichDB,GiardiaDB,EuPathDB" 
                 displayName="Other SNPs at this location including combined SNPs"
                 queryRef="SnpTables.Providers">
              <columnAttribute name="source_id_link" internal="true" displayName="SNP ID"/>
              <linkAttribute inReportMaker="false" displayName="SNP ID"
                             name="linkedSourceId">
                 <displayText>
                    <![CDATA[ $$source_id_link$$ ]]>
                 </displayText>
                 <url>
                    <![CDATA[
                       showRecord.do?name=SnpRecordClasses.SnpRecordClass&project_id=@PROJECT_ID@&primary_key=$$source_id_link$$
                        ]]>
                 </url>
              </linkAttribute>
              <columnAttribute displayName="Provider" name="name"/>
          </table>


        </recordClass>

    </recordClassSet>
</wdkModel>

