<dataPlotter>

  <query name="transcription_summary_profiles">
  <![CDATA[ 
                select distinct p.profile_set_name,
                    dsp.display_name || decode(p.profile_set_suffix, null, '', ' - ' || p.profile_set_suffix) || ', ' || dsp.short_attribution as display_name,
                    dsp.dataset_presenter_id as presenter_id, 
                    ds.order_num
                from apidbTuning.Profile p,
                     apidbTuning.ProfileSamples ps,
                     study.ProtocolAppNode pan,
                     apidbTuning.DatasetPresenter dsp,
                     (select *
                      from apidbTuning.DatasetProperty
                      where property = 'switchStrandsProfiles') dprop,
                     (select '' as dataset_name, 1 as order_num from dual
        -- TEMPLATE_ANCHOR transcriptionSummaryGraph
                     ) ds
                where p.dataset_type = 'transcript_expression' 
                and p.dataset_subtype = 'rnaseq' 
                and p.profile_type = 'values' 
                and p.source_id = '$id'
                and ((dprop.value = 'false'
                      and pan.name like '%firststrand%')
                     or (dprop.value = 'true'
                         and pan.name like '%secondstrand%')
                     or pan.name like '%unstranded%')
                and p.profile_set_name not like '%nonunique%'
                and p.profile_set_name = ps.study_name
                and ps.protocol_app_node_id = pan.protocol_app_node_id
                and p.dataset_name = dsp.name
                and dsp.name = ds.dataset_name
                and dsp.dataset_presenter_id = dprop.dataset_presenter_id(+)
                order by ds.order_num
  ]]>
    </query>

</dataPlotter>
