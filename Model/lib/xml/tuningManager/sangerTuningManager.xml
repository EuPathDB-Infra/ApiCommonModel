<?xml version="1.0" encoding="UTF-8"?>
<tuningConfig>

  <tuningTable name="AnnotationChange" alwaysUpdate="true">
    <ancillaryTable name="ReviewedComment"/>
    <program commandLine="buildAnnotationChangeTT"/>
  </tuningTable>

  <tuningTable name="ChangedGeneProduct" alwaysUpdate="true">
    <internalDependency name="AnnotationChange"/>
    <sql>
      <![CDATA[
        create table ChangedGeneProduct&1 nologging as
        select * from (
        select ga.source_id as gene, 
        CASE WHEN ga.product != ac.product THEN ac.product ELSE null END as product,
        CASE WHEN ga.name != ac.name THEN ac.name ELSE null END as name
        from (
        select gene,
        max(product) keep (dense_rank last order by change_date) as product,
        max(name) keep (dense_rank last order by change_date) as name
        from apidbtuning.AnnotationChange ac
        where gene is not null
        group by gene) ac, apidbtuning.geneattributes ga
        where ac.gene = ga.source_id)
        where product is not null or name is not null
      ]]>
    </sql>
    <sql>
      <![CDATA[
        create unique index cgp_ix&1 on ChangedGeneProduct&1 (gene)
      ]]>
    </sql>
  </tuningTable>

  <tuningTable name="Plasmogem" alwaysUpdate="true">
    <program commandLine="buildPlasmogemTT"/>
  </tuningTable>

</tuningConfig>
