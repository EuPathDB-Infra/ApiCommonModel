<?xml version="1.0" encoding="UTF-8"?>
<tuningConfig>

  <tuningTable name="AnnotationChange" alwaysUpdate="true">
    <program commandLine="buildAnnotationChangeTT"/>
  </tuningTable>

  <tuningTable name="ChangedGeneProduct">
    <internalDependency name="AnnotationChange"/>
    <sql>
      <![CDATA[
        create table ChangedGeneProduct&1 nologging as
        select gene, product, name,
               case
                 when name is null then product
                 else substr(product || ' (' || name || ')', 1, 200)
               end as search_string
        from (select gene,
                     max(product) keep (dense_rank last order by change_date) as product,
                     max(name) keep (dense_rank last order by change_date) as name
              from AnnotationChange
              where gene is not null
              group by gene)
      ]]>
    </sql>
    <sql>
      <![CDATA[
        create unique index cgp_ix&1 on ChangedGeneProduct&1 (gene)
      ]]>
    </sql>
    <sql>
      <![CDATA[
        create index annotation_change_ix&1 on ChangedGeneProduct&1 (search_string)
        indextype is ctxsys.context
        parameters('DATASTORE CTXSYS.DEFAULT_DATASTORE SYNC (ON COMMIT)')
      ]]>
    </sql>
  </tuningTable>

  <tuningTable name="Plasmogem" alwaysUpdate="true">
    <program commandLine="buildPlasmogemTT"/>
  </tuningTable>

</tuningConfig>
