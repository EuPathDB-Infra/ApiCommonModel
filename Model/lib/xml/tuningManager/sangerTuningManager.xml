<?xml version="1.0" encoding="UTF-8"?>
<tuningConfig>

  <tuningTable name="AnnotationChange" alwaysUpdate="true">
    <ancillaryTable name="ReviewedComment"/>
    <program commandLine="buildAnnotationChangeTT"/>
  </tuningTable>

  <tuningTable name="ChangedGeneProduct" alwaysUpdate="true">
    <internalDependency name="AnnotationChange"/>
    <sql>
      <![CDATA[
        create table ChangedGeneProduct&1 nologging as
        select distinct *
        from (select ga.source_id as gene, 
                     case when ga.product != ac.product then ac.product else null end as product,
                     case when ga.name != ac.name then ac.name else null end as name
              from apidbtuning.geneattributes ga,
                   (select gene,
                           max(product) keep (dense_rank last order by change_date) as product,
                           max(name) keep (dense_rank last order by change_date) as name
                    from apidbtuning.AnnotationChange ac
                    where gene is not null
                    group by gene) ac
              where ac.gene = ga.source_id)
        where product is not null or name is not null
      ]]>
    </sql>
    <sql>
      <![CDATA[
        create unique index cgp_ix&1 on ChangedGeneProduct&1 (gene)
      ]]>
    </sql>
  </tuningTable>

  <tuningTable name="Plasmogem" alwaysUpdate="true">
    <program commandLine="buildPlasmogemTT"/>
  </tuningTable>

</tuningConfig>
