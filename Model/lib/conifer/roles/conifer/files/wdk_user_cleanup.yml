---
# Conifer site configuration for UserDB cleanup routines.
# https://ci.apidb.org/job/wdk_user_cleanup/
# 

# Dynamic lookups
host_data: "{{ lookup('colfile',
    '{} src=https://cbilsvn.pmacs.upenn.edu/svn/apidb/websiteconf/master_configuration_set'.format(hostname)
  ) }}"

appdb_shortname: "{{ host_data['appDb_name'] }}"
appdb_login: "{{ host_data['appDb_login'] }}"
appdb_password: "{{ lookup('euparc',
  'attr=password xpath=database/user[@login=\"{}\"]'.format(appdb_login)
  )
}}"

acctdb_shortname: "{{ host_data['acctDb_name'] }}"
acctdb_login: "{{ host_data['acctDb_login'] }}"
acctdb_password: "{{ lookup('euparc',
  'attr=password xpath=database/user[@login=\"{}\"]'.format(acctdb_login)
  )
}}"

userdb_shortname: "{{ host_data['userDb_name'] }}"
userdb_login: "{{ host_data['userDb_login'] }}"
userdb_password: "{{ lookup('euparc',
  'attr=password xpath=database/user[@login=\"{}\"]'.format(userdb_login)
  )
}}"

# Apply looked up values to WDK configuration
modelconfig_accountDb_connectionUrl: 'jdbc:oracle:oci:@{{ acctdb_shortname }}'
modelconfig_accountDb_login: '{{ acctdb_login }}'
modelconfig_accountDb_password: '{{ acctdb_password }}'
modelconfig_accountDb_platform: Oracle

modelconfig_appDb_connectionUrl: 'jdbc:oracle:oci:@{{ appdb_shortname }}'
modelconfig_appDb_login: '{{ appdb_login }}'
modelconfig_appDb_password: '{{ appdb_password }}'
modelconfig_appDb_platform: Oracle

modelconfig_userDb_login: '{{ userdb_login }}'
modelconfig_userDb_password: '{{ userdb_password }}'
modelconfig_userDb_connectionUrl: 'jdbc:oracle:oci:@{{ userdb_shortname }}'
modelconfig_userDb_platform: Oracle

# Miscellaneous bogus values to satisfy WDK model sanity checks
_topleveldomain: ''
modelconfig_modelName: apiCommonModel
modelconfig_webServiceUrl: local
modelconfig_webAppUrl: ''
modelconfig_smtpServer: ''
modelconfig_supportEmail: ''
modelconfig_wdkTempDir: /var/tmp/wdk
modelconfig_appDb_userDbLink: ''
modelconfig_appDb_acctDbLink: ''
modelconfig_userDb_userSchema: foosh
modelconfig_accountDb_accountSchema: ''
modelconfig_emailSubject: ''
modelconfig_emailContent: ''
