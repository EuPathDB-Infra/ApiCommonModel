#!/usr/bin/perl

use strict;
use Switch;

usage() unless scalar(@ARGV) == 4;

my ($orderedStepsFile, $librariesFile, $brokenStepsOutputFile, $brokenFilesOutputFile) = @ARGV;

my %runnable2libraries;
open(L, $librariesFile) || die "Can't open libraries file '$librariesFile'\n";
my $runnable;
while (<L>) {
  chomp;
  if (/^(\S+)/) {
    $runnable = $1;
    $runnable2libraries{$runnable} = [];
  } else {
    $library = substr($_, 2);
    push(@{$runnable2libraries{$runnable}}, $library);
  }
}
close(L);




sub usage {
die "
Find steps and files that are broken.

Usage: gus4FindBroken ordered_steps_and_runnables runnables_to_libraries offline_steps_output_file broken_files_output_file

Where:
  -ordered_steps_and_runnables: output from gus4FindOrderedRunnables
  -runnables_to_libraries:      output from gus4FindLibraries
  -offline_steps_output_file:   an output fie that contains all broken steps (ordered by test flow run order)
  -broken_files_output_file:    an output file that shows all broken runnable and library files (also ordered)

";
}
